<div class="search-button-container">
  <div class="brid-crump">
    <div class="text">
      <span> Home > </span>All Firms
    </div>
  </div>
  <div class="buttons-section">
    <button (click)="togglePopup()" class="button-style">
      <i style="font-size: 1.2rem;" class="bi bi-funnel-fill"></i>
      <span class="button-text">Filter</span>
    </button>  
    <!-- <button (click)="togglePopup()" class="button-style">
      <i class="bi bi-funnel-fill"></i> Filter
    </button> -->
    <div class="sort-dropdown">
     <!-- <button class="button-style" (click)="toggleSortDropdown()">
        <i class="bi bi-filter"></i> Sort <i class="bi bi-caret-down-fill"></i>
      </button> -->
      <button class="button-style" (click)="toggleSortDropdown()">
        <i class="bi bi-filter"></i>
        <span class="button-text">Sort</span>
        <i  class="bi bi-caret-down-fill"></i>
      </button>    
      <div class="dropdown-menu" *ngIf="isSortDropdownOpen">
        <ul>
          <li (click)="onSortOptionSelected('AtoZ')">A → Z</li>
          <li (click)="onSortOptionSelected('ZtoA')">Z → A</li>
          <li (click)="onSortOptionSelected('newFirms')">Newest</li>
          <li (click)="onSortOptionSelected('oldFirms')">Oldest</li>
        </ul>
      </div>
    </div>
    <!-- <button type="button" (click)="resetFilters()" class="button-style">
      <i class="bi bi-arrow-counterclockwise"></i>Reset Filter
    </button> -->
    <button type="button" (click)="resetFilters()" class="button-style">
      <i class="bi bi-arrow-counterclockwise"></i>
      <span class="button-text">Reset Filter</span>
    </button>
    <!-- <button (click)="navigateToNewfirm()" class="addnew-button button-style">
      <i class="bi bi-plus"></i> Add New Firm
    </button> -->
    <button (click)="navigateToNewfirm()" class="addnew-button button-style">
      <i class="bi bi-plus"></i>
      <span class="button-text">Add New Firm</span>
    </button>
  </div>
</div>

<!-- Search Popup -->
<div class="popup-overlay" *ngIf="showPopup" (click)="togglePopup()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h3>Firms Search</h3>
      <button class="close-button" (click)="togglePopup()"><i class="bi bi-x-circle close-icon"></i></button>
    </div>

    <div class="popup-content">
      <div class="search-firms-inputs" style="display: flex; justify-content: space-between;">

        <div class="dropdown-column">
          <!-- Firm Name (Dropdown) -->
          <div class="input-field">
            <label for="firmName">Firm Name</label>
            <div class="select-wrapper">
              <select name="firmName" id="firmName" [(ngModel)]="firmName">
                <option value="all">All</option>
                <option *ngFor="let firm of firms" [value]="firm.FirmName">
                  {{ firm.FirmName }}
                </option>
              </select>
            </div>
          </div>

          <!-- Firm Type (Checkboxes) -->
          <div class="input-field">
            <label for="firmType">Firm Type</label>
            <div class="checkbox-wrapper">
              <input type="checkbox" [(ngModel)]="firmType" (change)="toggleCategoryOptions('firmType')" /> All
            </div>
            <div *ngIf="toggleOptions.firmType" class="checkbox-options">
              <label><input type="checkbox" [(ngModel)]="checkboxes.authorized" value="1" /> Authorized</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.dnfbp" value="2" /> DNFBP</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.licensed" value="3" /> Licensed</label>
            </div>
          </div>

          <!-- QFC Number -->
          <div class="input-field">
            <label for="qfcNumber">QFC Number</label>
            <input name="qfcNumber" id="qfcNumber" type="text" [(ngModel)]="qfcNumber" />
          </div>

          <!-- Firm Status (Checkboxes) -->
          <div class="input-field">
            <label for="firmStatus">Firm Status</label>
            <div class="checkbox-wrapper">
              <input type="checkbox" [(ngModel)]="firmStatus" (change)="toggleCategoryOptions('firmStatus')" /> All
            </div>
            <div *ngIf="toggleOptions.firmStatus" class="checkbox-options">
              <label><input type="checkbox" [(ngModel)]="checkboxes.applicant" value="1" /> Applicant</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.applicationWithdrawn" value="2" /> Application
                Withdrawn</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.applicationRejected" value="3" /> Application
                Rejected</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.active" value="4" /> Active</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.inactive" value="5" /> Inactive</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.withdrawn" value="6" /> Withdrawn</label>
            </div>
          </div>

          <!-- License Status (Dropdown) -->
          <div class="input-field">
            <label for="licenseStatus">License Status</label>
            <div class="select-wrapper">
              <select name="licenseStatus" id="licenseStatus" [(ngModel)]="licenseStatus">
                <option value="all">All</option>
                <option *ngFor="let licstatus of licenseStatuses" [value]="licstatus">
                  {{ licstatus }}
                </option>
              </select>
            </div>
          </div>
           <!-- Prudential Category (Checkboxes) -->
           <div class="input-field">
            <label for="prudentialCategory">Prudential Category</label>
            <div class="checkbox-wrapper">
              <input type="checkbox" [(ngModel)]="prudentialCategory"
                (change)="toggleCategoryOptions('prudentialCategory')" /> All
            </div>
            <div *ngIf="toggleOptions.prudentialCategory" class="checkbox-options">
              <label><input type="checkbox" [(ngModel)]="checkboxes.piib1" value="1" /> PIIB 1</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.piib2" value="2" /> PIIB 2</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.piib3" value="3" /> PIIB 3</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.piib4" value="4" /> PIIB 4</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.piib5" value="5" /> PIIB 5</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.directInsurer" value="6" /> Direct Insurer</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.reinsurer" value="7" /> Reinsurer</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.insuranceIntermediary" value="8" /> Insurance
                Intermediary</label>
            </div>
          </div>
          <!-- Supervisor - Supervision (Dropdown) -->
          <div class="input-field">
            <label for="Supervisor">Supervisor - Supervision</label>
            <div class="select-wrapper">
              <select name="Supervisor" id="Supervisor" [(ngModel)]="supervisorSupervision">
                <option value="all">All</option>
                <option *ngFor="let supervisorSup of supervisorSupervisions" [value]="supervisorSup">
                  {{ supervisorSup }}
                </option>
              </select>
            </div>
          </div>
           <!-- Sectors (Checkboxes) -->
           <div class="input-field">
            <label for="sectors">Sectors</label>
            <div class="checkbox-wrapper">
              <input type="checkbox" [(ngModel)]="sectors" (change)="toggleCategoryOptions('sectors')" /> All
            </div>
            <div *ngIf="toggleOptions.sectors" class="checkbox-options">
              <label><input type="checkbox" [(ngModel)]="checkboxes.investmentManager" value="1" /> Investment
                Manager</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.insurer" value="2" /> Insurer</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.insuranceIntermediary" value="3" /> Insurance
                Intermediary</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.bank" value="4" /> Bank</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.advisor" value="5" /> Advisor</label>
              <label><input type="checkbox" [(ngModel)]="checkboxes.repOffice" value="6" /> Rep Office</label>
            </div>
          </div>
          <!-- Supervisor -  AML (Dropdown) -->
          <div class="input-field">
            <label for="amlSup">Supervisor - AML</label>
            <div class="select-wrapper">
              <select name="amlSup" id="amlSup" [(ngModel)]="amlSup">
                <option value="all">All</option>
                <option *ngFor="let amlSup of amlSupervisors" [value]="amlSup">
                  {{ amlSup }}
                </option>
              </select>
            </div>
          </div>
           <!-- Supervision Category (Checkboxes) -->
           <div class="input-field">
            <label for="supervisionCategory">Supervision Category</label>
             <div class="checkbox-wrapper">
               <input type="checkbox" [(ngModel)]="supervisionCategory" (change)="toggleCategoryOptions('supervisionCategory')" /> All
              </div>
            <div *ngIf="toggleOptions.supervisionCategory" class="checkbox-options">
            <label><input type="checkbox" [(ngModel)]="checkboxes.corporateBank" value="1" /> Corporate Bank</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.investmentManagerSupCat" value="2" /> Investment Manager</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.auditAndAccountingServices" value="3" /> Audit and Accounting Services</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.trustServices" value="4" /> Trust Services</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.singleFamilyOffice" value="5" /> Single Family Office</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.insuranceIntermediarySupCat" value="6" /> Insurance Intermediary</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.captiveInsurer" value="7" /> Captive Insurer</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.captiveManager" value="8" /> Captive Manager</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.investmentBank" value="9" /> Investment Bank</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.advisorSupCat" value="10"/> Advisor</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.legalServices" value="11"/> Legal Services</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.professionalServices" value="12"/> Professional Services</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.directInsurerSupCat" value="13"/> Direct Insurer</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.repOfficeSupCat" value="14"/> Rep Office</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.reinsurerSupCat" value="15"/> Reinsurer</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.wealthManager" value="16"/> Wealth Manager</label>
          </div>
        </div>
          <!-- Legal Status (Dropdown) -->
          <div class="input-field">
            <label for="amlSup">Legal Status</label>
            <div class="select-wrapper">
              <select name="amlSup" id="amlSup" [(ngModel)]="legalStatus">
                <option value="all">All</option>
                <option *ngFor="let legalStatus of legalStatuses" [value]="legalStatus">
                  {{ legalStatus }}
                </option>
              </select>
            </div>
          </div>
          <!-- Authorisation Category (Checkboxes) -->
          <div class="input-field">
            <label for="authorisationCategory">Authorisation Category</label>
             <div class="checkbox-wrapper">
               <input type="checkbox" [(ngModel)]="authorisationCategory" (change)="toggleCategoryOptions('authorisationCategory')" /> All
              </div>
            <div *ngIf="toggleOptions.authorisationCategory" class="checkbox-options">
            <label><input type="checkbox" [(ngModel)]="checkboxes.bank" value="1" />Bank</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.iBANK" value="2" /> IBANK</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.iNMA" value="3" />INMA</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.cAPI" value="4" />CAPI</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.iMEB" value="5" />IMEB</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.pINS" value="6" /> PINS</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.rEPO" value="7" />REPO</label>
            <label><input type="checkbox" [(ngModel)]="checkboxes.dMEX" value="8" />DMEX</label>
          </div>
        </div>           

          <!-- Authorisation Status (Dropdown) -->
          <div class="input-field">
            <label for="authorisationStatus">Authorisation Status</label>
            <div class="select-wrapper">
              <!-- Bind to a single selected value (authorisationStatus), not the entire array -->
              <select name="authorisationStatus" id="authorisationStatus" [(ngModel)]="authorisationStatus">
                <option value="all">All</option>
                <option *ngFor="let authstatus of authorisationStatuses" [value]="authstatus">
                  {{ authstatus }}
                </option>
              </select>
            </div>
          </div>
         <!--Relevant Person (Checkbox)-->
          <div class="input-field">
            <label for="relevantPerson">Relevant Person</label>
            <div class="checkbox-options">
              <input type="checkbox" [(ngModel)]="relevantPerson" value="1" /> 
             </div>
          </div>
         
        </div>

      </div>

      <!-- Alphabet Filter -->
      <div class="alphabet-filter">
        <span *ngFor="let letter of alphabet" (click)="getstartChar(letter)">
          {{ letter }}
        </span>
      </div>

      <!-- Buttons for Reset and Search -->
      <div class="input-search-buttons">
        <button type="button" (click)="resetFilters()" class="reset">Reset</button>
        <button type="button" (click)="searchFirms()" class="search">Search</button>
      </div>
    </div>
  </div>
</div>


<app-firm-list [isMainView]="true" [firms]="filteredFirms"></app-firm-list>