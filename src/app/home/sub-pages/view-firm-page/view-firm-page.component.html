<div *ngIf="isLoading" class="loader-overlay">
  <div class="loader"></div>
</div>
<div *ngIf="isUserAllowed" class="brid-crump">
  <div class="text"><span> Home > All Firms > </span> {{ titleSection }}</div>
</div>

<div *ngIf="isUserAllowed" class="page">
  <div class="menu" [ngStyle]="{ width: menuWidth }">
    <!-- <button (click)="toggleFulMenu()" class="menu-item menu-item-btn-ce"> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width1)" class="menu-icons bi bi-arrow-left-square-fill"></i>
    <!-- <p *ngIf="menuWidth.match('20%')">Close Menu</p> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-arrow-right-square-fill"></i>
    <!-- </button> -->

    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="1-item" (click)="toggleMenu(1)" [ngClass]="{ active: menuId === 1 }"
        (click)="switchTab(Page.Firm)">
        FIRM Details
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-info-square"></i>
      <div class="sub-menu" *ngIf="menuId === 1 && menuWidth.match(width1)">
        <a (click)="switchTab(Page.CoreDetail)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.CoreDetail }">
          Core Details
        </a>
        <a (click)="switchTab(Page.Scope)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Scope }">
          Scope
        </a>
        <a (click)="switchTab(Page.Controller)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.Controller }">
          Controllers
        </a>
        <a (click)="switchTab(Page.Auditor)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Auditor }">
          Auditors
        </a>
        <a (click)="switchTab(Page.Contatcs)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Contatcs }">
          Contacts
        </a>
      </div>
    </div>

    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(2)" [ngClass]="{ active: menuId === 2 }">
        Individuals
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-people"></i>
      <div class="sub-menu" *ngIf="menuId === 2 && menuWidth.match(width1)">
        <a (click)="switchTab(Page.Individual)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.Individual }">
          Individual Details
        </a>
      </div>
    </div>

    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(3)" [ngClass]="{ active: menuId === 3 }">
        Supervision
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-kanban"></i>
      <div class="sub-menu" *ngIf="menuId === 3 && menuWidth.match(width1)">
        <a (click)="switchTab(Page.ReportingSchedule)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.ReportingSchedule }">
          Reporting Schedule
        </a>
        <a (click)="switchTab(Page.ReturnsReview)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.ReturnsReview }">
          Return Review
        </a>
        <a (click)="switchTab(Page.Notices)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Notices }">
          Notices
        </a>
        <a (click)="switchTab(Page.LateAdminFee)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.LateAdminFee }">
          Admin Fee
        </a>
        <a (click)="switchTab(Page.RMP)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.RMP }">
          RMPs
        </a>
        <a (click)="switchTab(Page.Breach)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Breach }">
          Breaches
        </a>
        <a (click)="switchTab(Page.Waiver)" class="menu-sub-item" [ngClass]="{ active: activeTab === Page.Waiver }">
          Waivers
        </a>
        <a (click)="switchTab(Page.Enforcement)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.Enforcement }">
          Enf. Actions
        </a>
        <a (click)="switchTab(Page.RegisteredFunds)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.RegisteredFunds }">
          Reg. Funds
        </a>
        <a (click)="switchTab(Page.SupervisionJournal)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === Page.SupervisionJournal }">
          Journal
        </a>
      </div>
    </div>
  </div>

  <!-- Firm Section -->
  <section #firmSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Firm ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="form-section-title">
        <h2 class="edit-firm-header">
          <p>Firm Details</p>
        </h2>
      </div>
      <div class="inputs-row">
        <div class="input-field">
          <label for="firmName"> Firm Name </label>
          <input disabled name="firmName" id="firmName" type="text" value="{{ firmDetails?.FirmName }}" />
        </div>
        <div class="input-field">
          <label for="QFCNumber"> QFC Number </label>
          <input disabled name="QFCNumber" id="QFCNumber" type="text" value="{{ firmDetails?.QFCNum }}" />
        </div>
        <div class="input-field">
          <label for="code"> Code </label>
          <input disabled name="code" id="code" type="text" value="{{ firmDetails?.FirmCode }}" />
        </div>
        <div class="input-field">
          <label for="lagalStatus"> Legal Status </label>
          <input disabled name="lagalStatus" id="lagalStatus" type="text"
            value="{{ firmDetails?.LegalStatusTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="PrudentialCategory"> Prudential Category </label>
          <input disabled name="PrudentialCategory" id="PrudentialCategory" type="text"
            value="{{ firmDetails?.PrudentialCategoryTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="FinancialYearEnd"> Financial Year End </label>
          <input disabled name="financialYearEnd" id="financialYearEnd" type="text"
            value="{{ firmDetails?.FinYearEndTypeDesc }}" />
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set">
      <div class="form-section-title">
        <h2 class="edit-firm-header">Application Details</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="inputs-row">
        <div class="input-field">
          <label for="dateOfApplication"> Date of Application </label>
          <input disabled name="dateOfApplication" id="dateOfApplication" type="text" value="{{
              firmDetails?.AuthorisationStatusTypeID == 0
                ? (firmDetails?.FirmLicApplDate | date: 'dd/MMM/y')
                : (firmDetails?.FirmAuthApplDate | date: 'dd/MMM/y')
            }}" />
        </div>

        <div class="input-field">
          <label for="firmApplicationType"> Firm Application Type </label>
          <input type="text" disabled name="firmApplicationType" id="firmApplicationType"
            value="{{ appDetails.FirmApplTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="qfcLicenseStatus"> QFC License Status </label>
          <input disabled type="text" name="qfcLicenseStatus" id="qfcLicenseStatus"
            value="{{ firmDetails?.LicenseStatusTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="DateLicensed">
            {{ LicenseStatusTypeLabelDescFormatted }}
          </label>
          <input disabled name="DateLicensed" id="DateLicensed" type="text"
            value="{{ firmDetails?.LicenseApplStatusDate | date: 'dd/MMM/y' }}" />
        </div>

        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="authorisationStatus"> Authorisation Status </label>
          <input type="text" disabled name="authorisationStatus" id="authorisationStatus"
            value="{{ firmDetails?.AuthorisationStatusTypeDesc }}" />
        </div>
        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="dateApplication">
            {{ AuthorisationStatusTypeLabelDescFormatted }}
          </label>
          <input disabled name="dateApplication" id="dateApplication" type="text"
            value="{{ firmDetails?.AuthApplStatusDate | date: 'dd/MMM/y' }}" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="form-section-title">
        <h2 class="edit-firm-header">Operational Information</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="inputs-row">
        <div class="input-field">
          <label for="noOfStaffInQatar"> No. Of Staff In Qatar </label>
          <input disabled name="noOfStaffInQatar" id="noOfStaffInQatar" type="text"
            value="{{ firmOPDetails?.NumOfLocalStaff }}" />
        </div>

        <div class="input-field">
          <label for="staffTotal"> Staff total </label>
          <input disabled name="staffTotal" id="staffTotal" type="text" value="{{ firmOPDetails?.NumOfTotalStaff }}" />
        </div>

        <div class="input-field notes">
          <label for="notes"> Notes </label>
          <div contenteditable="false" [innerHTML]="getSanitizedNotes(firmOPDetails?.Notes)" class="resizable-textarea">
          </div>
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="section">
        <h2 class="history-row">
          RA Personal Assigned
          <button [disabled]="FIRMRA.length === 0" class="subbutton-open-history" (click)="getInactiveUsers()">
            <i class="bi bi-clock-history"></i>
            <span> Open History</span>
          </button>
        </h2>
        <table *ngIf="FIRMRA?.length > 0; else noSupervisors">
          <thead>
            <tr>
              <th>Function / Role</th>
              <th>Name</th>
              <th class="date-center">Date From</th>
              <th class="date-center">Date To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let RA of FIRMRA">
              <td style="text-align: left">{{ RA.firmUserAssnTypeDesc }}</td>
              <td style="text-align: left">{{ RA.name }}</td>
              <td class="date-center">
                {{ RA.firmUserAssnDateFrom | date: 'dd/MMM/yyyy' }}
              </td>
              <td class="date-center">
                {{ RA.firmUserAssnDateTo | date: 'dd/MMM/yyyy' }}
              </td>
            </tr>
          </tbody>
        </table>
        <!-- Display this message when there are no supervisors assigned -->
        <ng-template #noSupervisors>
          <p style="color: red">No supervisors assigned</p>
        </ng-template>
      </div>
    </div>
  </section>

  <!--Start Firm details sub section-->

  <!--Core Details-->
  <section #coreDetailSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.CoreDetail ? 'flex' : 'none'
    }">
    <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['firmDetailsSection'] }">
      <!--Error messages for firm details-->
      <div class="error-messages">
        <p *ngIf="errorMessages['FirmName']">{{ errorMessages['FirmName'] }}</p>
        <p *ngIf="errorMessages['LegalStatusTypeID']">
          {{ errorMessages['LegalStatusTypeID'] }}
        </p>
        <p *ngIf="errorMessages['DateOfIncorporation']">
          {{ errorMessages['DateOfIncorporation'] }}
        </p>
        <p *ngIf="errorMessages['DateOfApplication']">
          {{ errorMessages['DateOfApplication'] }}
        </p>
        <p *ngIf="errorMessages['LicensedDate']">
          {{ errorMessages['LicensedDate'] }}
        </p>
        <p *ngIf="errorMessages['AuthorisationDate']">
          {{ errorMessages['AuthorisationDate'] }}
        </p>
        <p *ngIf="errorMessages['QFCNum']">{{ errorMessages['QFCNum'] }}</p>
        <p *ngIf="errorMessages['FYearEndDate']">
          {{ errorMessages['FYearEndDate'] }}
        </p>
        <p *ngIf="errorMessages['AccStandDate']">
          {{ errorMessages['AccStandDate'] }}
        </p>
        <p *ngIf="errorMessages['PrevFirmNameEffectiveTo']">
          {{ errorMessages['PrevFirmNameEffectiveTo'] }}
        </p>
      </div>
      <div class="form-section-title">
        <h2 class="edit-firm-header">
          <p>Firm Details</p>
          <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
            (click)="toggleCollapse('firmDetailsSection')">
            {{ isCollapsed['firmDetailsSection'] ? '▲' : '▼' }}
          </button>
        </h2>

        <div style="display: flex; gap: 10px">
          <!-- loading flag for rendering buttons, hideSaveBtn..etc flag for supervisor access and other roles, getControlVisiblity function for role access endpoint -->
          <div class="btn" *ngIf="
              !loading && !hideEditBtn && getControlVisibility('imgBtnEdit')
            ">
            <button [disabled]="!getControlEnablement('imgBtnEdit')" class="edit-btn" (click)="editFirm()">
              <i class="bi bi-pen"></i>Edit
            </button>
          </div>

          <div class="btn" *ngIf="
              !loading && !hideSaveBtn && getControlVisibility('imgBtnSave')
            ">
            <button [disabled]="!getControlEnablement('imgBtnSave')" class="save-btn" (click)="saveFirm()">
              Save
            </button>
          </div>

          <div class="btn" *ngIf="
              !loading && !hideCancelBtn && getControlVisibility('imgBtnCancel')
            ">
            <button [disabled]="!getControlEnablement('imgBtnCancel')" class="cancel-btn" (click)="cancelEditFirm()">
              Cancel
            </button>
          </div>

          <div class="btn" *ngIf="
              !loading && !hideCreateBtn && getControlVisibility('imgBtnCreate')
            ">
            <button [disabled]="!getControlEnablement('imgBtnCreate')">
              Create
            </button>
          </div>

          <div class="btn" *ngIf="
              !loading && !hideReviseBtn && getControlVisibility('imgBtnRevise')
            ">
            <button [disabled]="!getControlEnablement('imgBtnRevise')">
              Revise
            </button>
          </div>

          <div class="btn" *ngIf="
              !loading && !hideDeleteBtn && getControlVisibility('imgBtnDelete')
            ">
            <button [disabled]="!getControlEnablement('imgBtnDelete')">
              Delete
            </button>
          </div>
        </div>
      </div>

      <div class="inputs-row">
        <div class="input-field">
          <label for="firmName">
            Firm Name
            <span [hidden]="!isEditModeCore" style="color: red">*</span>
          </label>
          <input [disabled]="!isEditModeCore" name="firmName" id="firmName" type="text"
            [(ngModel)]="firmDetails.FirmName" [ngClass]="{ 'error-border': errorMessages['FirmName'] }" />
        </div>

        <div class="input-field">
          <label for="qfcNumber"> QFC Number </label>
          <input [disabled]="!isEditModeCore" name="qfcNumber" id="qfcNumber" type="text"
            [(ngModel)]="firmDetails.QFCNum" [ngClass]="{ 'error-border': errorMessages['QFCNum'] }" />
        </div>

        <div class="input-field">
          <label for="code"> Code </label>
          <input [disabled]="!isEditModeCore" name="code" id="code" type="text" [(ngModel)]="firmDetails.FirmCode" />
        </div>

        <div class="input-field">
          <label for="legalStatus">
            Legal Status
            <span [hidden]="!isEditModeCore" style="color: red">*</span>
          </label>
          <select [ngClass]="{
              'select-background-edited': isEditModeCore,
              'error-border': errorMessages['LegalStatusTypeID']
            }" [disabled]="!isEditModeCore" id="legalStatus" (ngModelChange)="onLegalStatusChange($event)"
            [(ngModel)]="firmDetails.LegalStatusTypeID">
            <option value="0">Select</option>
            <option *ngFor="let option of allLegalStatus" [value]="option.LegalStatusTypeID">
              {{ option.LegalStatusTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="qfcTradingName"> QFC Trading Name </label>
          <input [disabled]="!isEditModeCore" name="qfcTradingName" id="qfcTradingName" type="text"
            [(ngModel)]="firmDetails.QFCTradingName" />
        </div>

        <div class="input-field">
          <label for="prevTradingNames"> Prev. Trading Name(s) </label>
          <input [disabled]="!isEditModeCore" name="prevTradingNames" id="prevTradingNames" type="text"
            [(ngModel)]="firmDetails.PrevTradingName" />
        </div>

        <div class="input-field">
          <label for="placeOfIncorporation"> Place of Incorporation </label>
          <input [disabled]="!isEditModeCore" name="placeOfIncorporation" id="placeOfIncorporation" type="text"
            [(ngModel)]="firmDetails.PlaceOfIncorporation" />
        </div>

        <div class="input-field">
          <label for="homeCountry"> Home Country </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="homeCountry" [(ngModel)]="firmDetails.CountyOfIncorporation">
            <option *ngFor="let option of allCountries" [value]="option.CountryID">
              {{ option?.CountryName }}
            </option>
          </select>
        </div>

        <div class="input-field" [hidden]="!isEditModeCore">
          <label for="isDateDifferent">
            Is Date of Incorporation different from Date of Licensing or
            Authorisation : <span style="color: red">*</span>
          </label>
          <div class="radio-wrapper">
            <input name="isIncorporationDateDifferent" id="yes" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="true" />
            Yes
            <input name="isIncorporationDateDifferent" id="no" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="false" />
            No
          </div>
        </div>

        <ng-container *ngIf="firmDetails.DifferentIncorporationDate || !isEditModeCore">
          <div class="input-field">
            <label for="incorporationDate"> Incorporation Date </label>
            <input [ngClass]="{
                'error-border': errorMessages['DateOfIncorporation']
              }" [disabled]="!isEditModeCore" name="incorporationDate" id="incorporationDate" type="text" #dateInputs
              [(ngModel)]="firmDetails.DateOfIncorporation" />
          </div>
        </ng-container>

        <div class="input-field">
          <label for="financialYearEnd" class="history-row">
            Financial Year End
            <button *ngIf="firmDetails?.FinYearEndTypeDesc" class="subbutton-open-history" (click)="getFYearHistory()">
              <i class="bi bi-clock-history"></i> <span> Open History</span>
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="financialYearEnd" [(ngModel)]="firmDetails.FinYearEndTypeID">
            <option *ngFor="let option of allFinYearEnd" [value]="option.FirmFinYearEndTypeID">
              {{ option.FirmFinYearEndTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="financialYearEndEffectiveFrom">
            Financial Year End Effective From
          </label>
          <input [disabled]="!isEditModeCore" name="financialYearEndEffectiveFrom" type="text" #dateInputs
            id="financialYearEndEffectiveFrom" [(ngModel)]="firmDetails.FirmFinYearEndEffectiveFrom"
            [ngClass]="{ 'error-border': errorMessages['FYearEndDate'] }" />
        </div>

        <div class="input-field">
          <label for="accountingStandards" class="history-row">
            Accounting Standards
            <button *ngIf="firmDetails?.FinAccStdTypeDesc" class="subbutton-open-history"
              (click)="getAccountingStandardHistory()">
              <i class="bi bi-clock-history"></i><span> Open History</span>
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="accountingStandards" [(ngModel)]="firmDetails.FinAccStdTypeID">
            <option *ngFor="let option of allFinAccStd" [value]="option.FinAccStdTypeID">
              {{ option.FinAccStdTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="accountingStandardsEffectiveFrom">
            Accounting Standards Effective From
          </label>
          <input [disabled]="!isEditModeCore" name="accountingStandardsEffectiveFrom"
            id="accountingStandardsEffectiveFrom" type="text" #dateInputs
            [(ngModel)]="firmDetails.FinAccStdTypeEffectiveFrom"
            [ngClass]="{ 'error-border': errorMessages['AccStandDate'] }" />
        </div>

        <div class="input-field">
          <label for="websiteLink"> Website Link </label>

          <input *ngIf="isEditModeCore" type="text" value="" [(ngModel)]="firmDetails.WebSiteAddress"
            id="websiteLink" />

          <a *ngIf="!isEditModeCore" id="websiteLink" [href]="firmDetails?.WebSiteAddress" target="_blank"
            rel="noopener noreferrer">
            {{ firmDetails?.WebSiteAddress }}
          </a>
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmName" class="history-row">
            Prev. Firm Name
            <button class="subbutton-open-history" (click)="getPrevFirmName()">
              <i class="bi bi-clock-history"></i> <span> Open History</span>
            </button>
          </label>
          <input [disabled]="!isEditModeCore" name="prevFirmName" id="prevFirmName" type="text"
            [(ngModel)]="firmNamesHistory[0].PrevFirmName" />
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmNameEffectiveTo">
            Prev. Firm Name Effective To
          </label>
          <input [disabled]="!isEditModeCore" name="prevFirmNameEffectiveTo" id="prevFirmNameEffectiveTo" type="text"
            #dateInputs [(ngModel)]="firmNamesHistory[0].DateEffectiveTo" [ngClass]="{
              'error-border': errorMessages['PrevFirmNameEffectiveTo']
            }" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['appDetailsSection'] }">
      <div class="form-section-title collapse-container">
        <div class="history-row">
          <h2 class="edit-firm-header">
            Application Details
            <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
              (click)="toggleCollapse('appDetailsSection')">
              {{ isCollapsed['appDetailsSection'] ? '▲' : '▼' }}
            </button>
            <button class="subbutton-open-history" (click)="getApplicationDetailsHistory()">
              <i class="bi bi-clock-history"></i> <span> Open History</span>
            </button>
          </h2>
        </div>
      </div>
      <div class="inputs-row app-details-tables" *ngIf="!isEditModeCore">
        <!-- Licensed Status Table -->
        <table class="aligned-table">
          <thead>
            <tr>
              <td class="app-details-table-header" colspan="6">
                Licensed Status
              </td>
            </tr>
            <tr>
              <th class="aligned-column">Applied On</th>
              <th class="aligned-column">Licensed On</th>
              <th class="aligned-column">Current Status</th>
              <th class="aligned-column">Current Status Effective Date</th>
              <th class="aligned-column">Last Modified By</th>
              <th class="aligned-column">Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                {{
                firmAppDetailsCurrentLicensed?.AppliedOn | date: 'dd/MMM/y'
                }}
              </td>
              <td>
                {{
                firmAppDetailsCurrentLicensed?.GrantedOn | date: 'dd/MMM/y'
                }}
              </td>
              <td>{{ firmAppDetailsCurrentLicensed?.RecentStatus }}</td>
              <td>
                {{
                firmAppDetailsCurrentLicensed?.RecentStatusDate
                | date: 'dd/MMM/y'
                }}
              </td>
              <td>{{ firmAppDetailsCurrentLicensed?.LastModifiedBy }}</td>
              <td>{{ firmAppDetailsCurrentLicensed?.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Authorisation Status Table -->
        <table class="aligned-table" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <thead>
            <tr>
              <td class="app-details-table-header" colspan="6">
                Authorisation Status
              </td>
            </tr>
            <tr>
              <th class="aligned-column">Applied On</th>
              <th class="aligned-column">Authorised On</th>
              <th class="aligned-column">Current Status</th>
              <th class="aligned-column">Current Status Effective Date</th>
              <th class="aligned-column">Last Modified By</th>
              <th class="aligned-column">Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                {{
                firmAppDetailsCurrentAuthorized?.AppliedOn | date: 'dd/MMM/y'
                }}
              </td>
              <td>
                {{
                firmAppDetailsCurrentAuthorized?.GrantedOn | date: 'dd/MMM/y'
                }}
              </td>
              <td>{{ firmAppDetailsCurrentAuthorized?.RecentStatus }}</td>
              <td>
                {{
                firmAppDetailsCurrentAuthorized?.RecentStatusDate
                | date: 'dd/MMM/y'
                }}
              </td>
              <td>{{ firmAppDetailsCurrentAuthorized?.LastModifiedBy }}</td>
              <td>{{ firmAppDetailsCurrentAuthorized?.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!--or (edit mode)-->
      <div class="inputs-row" *ngIf="isEditModeCore">
        <div class="input-field">
          <label for="dateOfApplication"> Date of Application </label>
          <input name="dateOfApplication" id="dateOfApplication" type="text" #dateInputs
            (ngModelChange)="onDateOfApplicationChange($event)" [(ngModel)]="dateOfApplication"
            [ngClass]="{ 'error-border': errorMessages['DateOfApplication'] }" />
        </div>
        <div class="input-field">
          <label for="firmApplicationType"> Firm Application Type </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" name="firmApplicationType"
            id="firmApplicationType" [(ngModel)]="selectedFirmTypeID"
            (ngModelChange)="onFirmApplicationTypeChange($event)">
            <option *ngFor="let firmType of allFirmTypes" [value]="firmType.FirmApplTypeID">
              {{ firmType.FirmApplTypeDesc }}
            </option>
          </select>
        </div>
        <div class="input-field">
          <label for="qfcLicenseStatus"> QFC License Status </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" name="qfcLicenseStatus"
            id="qfcLicenseStatus" [(ngModel)]="firmDetails.LicenseStatusTypeID"
            (ngModelChange)="onLicenseStatusChange($event)">
            <option *ngFor="let option of allQFCLicenseStatus" [value]="option.FirmApplStatusTypeID">
              {{ option.FirmApplStatusTypeDesc }}
            </option>
          </select>
        </div>
        <div class="input-field">
          <label for="DateLicensed">
            {{ LicenseStatusTypeLabelDescFormatted }}
          </label>
          <input name="DateLicensed" id="DateLicensed" type="text" #dateInputs
            [(ngModel)]="formattedLicenseApplStatusDate"
            [ngClass]="{ 'error-border': errorMessages['LicensedDate'] }" />
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="authorisationStatus"> Authorisation Status </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" name="authorisationStatus"
            id="authorisationStatus" [(ngModel)]="firmDetails.AuthorisationStatusTypeID"
            (ngModelChange)="onAuthorizedStatusChange($event)">
            <option *ngFor="let option of allAuthorisationStatus" [value]="option.FirmApplStatusTypeID">
              {{ option.FirmApplStatusTypeDesc }}
            </option>
          </select>
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="dateAuthorized">
            {{ AuthorisationStatusTypeLabelDescFormatted }}
          </label>
          <input name="dateAuthorized" id="dateAuthorized" type="text" #dateInputs
            [(ngModel)]="formattedAuthApplStatusDate"
            [ngClass]="{ 'error-border': errorMessages['AuthorisationDate'] }" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set" *ngIf="isEditModeCore && selectedFirmTypeID == 3"
      [ngClass]="{ collapsed: isCollapsed['pressReleaseSection'] }">
      <div class="error-messages">
        <p *ngIf="errorMessages['uploadDocument']">
          {{ errorMessages['uploadDocument'] }}
        </p>
      </div>
      <div class="form-section-title collapse-container">
        <h2 class="edit-firm-header">Press Releases</h2>
        <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
          (click)="toggleCollapse('pressReleaseSection')">
          {{ isCollapsed['pressReleaseSection'] ? '▲' : '▼' }}
        </button>
      </div>
      <div class="inputs-row">
        <div class="file-container">
          <div class="input-field">
            <label for="documentType"> Document Type </label>
            <select [disabled]="!isEditModeCore" [ngClass]="{ 'select-background-edited': isEditModeCore }"
              class="document-type-select" name="documentType" id="documentType">
              <option value="263">Press Releases</option>
            </select>
          </div>
          <div class="input-field">
            <label id="uploaded-documents">Uploaded documents go here</label>
          </div>
          <div class="input-field">
            <div class="btns-container">
              <div class="upload-container">
                <button class="choose-document-btn" (click)="selectDocument()">
                  Choose Document
                </button>
              </div>
              <button class="upload-document-btn" (click)="uploadDocument()">
                Upload the Document
              </button>
            </div>
          </div>
        </div>
        <div class="file-table-container">
          <table>
            <thead>
              <tr>
                <th>Document Type</th>
                <th>File Name</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Attachment</td>
                <td></td>
                <td>
                  <button style="display: none" class="delete-file">
                    Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!---->
    <div *ngIf="
        !isNullOrEmpty(firmDetails?.FirmApplicationDataComments) ||
        !isNullOrEmpty(firmDetails?.PublicRegisterComments)
      " class="inputs-field-set comments" [ngClass]="{ collapsed: isCollapsed['commentsSection'] }">
      <div class="form-section-title collapse-container">
        <h2 class="edit-firm-header">Comments</h2>
        <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
          (click)="toggleCollapse('commentsSection')">
          {{ isCollapsed['commentsSection'] ? '▲' : '▼' }}
        </button>
      </div>
      <div class="inputs-row">
        <div class="input-field">
          <label for="generalComments"> General Comments </label>
          <textarea [disabled]="!isEditModeCore" name="generalComments" id="generalComments"
            [(ngModel)]="firmDetails.FirmApplicationDataComments"></textarea>
        </div>
        <div class="input-field">
          <label for="publicRegisterComments"> Public Register Comments </label>
          <textarea [disabled]="!isEditModeCore" name="publicRegisterComments" id="publicRegisterComments"
            [(ngModel)]="firmDetails.PublicRegisterComments"></textarea>
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['addressesSection'] }">
      <!--Error messages for addresses-->
      <div class="error-messages">
        <p *ngIf="errorMessages['AddressTypeID']">
          {{ errorMessages['AddressTypeID'] }}
        </p>
        <p *ngIf="errorMessages['DuplicatedAddressTypeID']">
          {{ errorMessages['DuplicatedAddressTypeID'] }}
        </p>
      </div>
      <div class="display-flex space-between align-center border-bottom">
        <div class="form-section-title collapse-container">
          <h2 class="edit-firm-header">Addresses</h2>
          <button class="collapse-button" (click)="toggleCollapse('addressesSection')">
            {{ isCollapsed['addressesSection'] ? '▲' : '▼' }}
          </button>
        </div>
        <div class="add-address-container">
          <button *ngIf="isEditModeCore && canAddNewAddress" (click)="addNewAddress()"
            [hidden]="isCollapsed['addressesSection']" class="addAddressBtn">
            Add Address
          </button>
        </div>
      </div>
      <div class="inputs-row">
        <ng-container *ngFor="let address of filteredFirmAddresses; let i = index">
          <ng-container *ngIf="address.Valid === true">
            <div class="input-field" *ngIf="!isEditModeCore">
              <label for="addressType" class="history-row">
                Address Type
                <button *ngIf="address.PreviousRecords !== 0" class="subbutton-open-history"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">
                  <i class="bi bi-clock-history"></i><span> Open History</span>
                </button>
              </label>
              <input disabled name="addressType" id="addressType" type="text" value="{{ address?.AddressTypeDesc }}" />
            </div>
            <div *ngIf="isEditModeCore" class="del-address-container">
              <button (click)="removeAddress(i)" class="RmvAddressBtn bi-trash"></button>
            </div>
            <!-- address type on edit mode -->
            <div class="input-field" *ngIf="isEditModeCore">
              <label for="addressType" class="history-row">
                Address Type
                <button *ngIf="address.PreviousRecords !== 0 && address.AddressID" class="subbutton-open-history"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">
                  <i class="bi bi-clock-history"></i> <span>Open History</span>
                </button>
                
              </label>
              <select [disabled]="!!address.AddressID" [(ngModel)]="address.AddressTypeID"
                (change)="onAddressTypeChange($event, address)" [ngClass]="{
                  'error-border':
                    !address.AddressID && errorMessages['AddressTypeID'],
                  'select-background-edited': isEditModeCore
                }">
                <option value="0">Select</option>
                <option *ngFor="let option of allAddressTypes" [value]="option.AddressTypeID">
                  {{ option.AddressTypeDesc }}
                </option>
              </select>
            </div>

            <div class="input-field" *ngIf="
                isEditModeCore &&
                (!address.AddressID || address.AddressID === '')
              ">
              <label for="sameAsType"> Same As Type </label>
              <select [(ngModel)]="address.SameAsTypeID" (ngModelChange)="onSameAsTypeChange($event)" name="sameAsType"
                id="sameAsType" [ngClass]="{ 'select-background-edited': isEditModeCore }">
                <option value="0">Select</option>
                <option *ngFor="let type of existingAddresses" [value]="type.AddressTypeID">
                  {{ type.AddressTypeDesc }}
                </option>
              </select>
            </div>

            <div class="input-field">
              <label for="addressLine1"> Address Line 1 </label>
              <input type="text" [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="addressLine1" id="addressLine1" [(ngModel)]="address.AddressLine1" />
            </div>
            <div class="input-field">
              <label for="addressLine2"> Address Line 2 </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="addressLine2" id="addressLine2" type="text" [(ngModel)]="address.AddressLine2" />
            </div>
            <div class="input-field">
              <label for="addressLine3"> Address Line 3 </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="addressLine3" id="addressLine3" type="text" [(ngModel)]="address.AddressLine3" />
            </div>
            <div class="input-field">
              <label for="addressLine4"> Address Line 4 </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="addressLine4" id="addressLine4" type="text" [(ngModel)]="address.AddressLine4" />
            </div>
            <div class="input-field">
              <label for="city"> City </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="city" id="city" type="text" [(ngModel)]="address.City" />
            </div>
            <div class="input-field">
              <label for="state"> state/province </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="state" id="state" type="text" [(ngModel)]="address.Province" />
            </div>
            <div class="input-field" *ngIf="!isEditModeCore">
              <label for="country"> Country </label>
              <input disabled type="text" name="country" id="country" [(ngModel)]="address.CountryName" />
            </div>
            <!-- countries on edit mode-->
            <div class="input-field" *ngIf="isEditModeCore">
              <label for="country"> Country </label>
              <select [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " [(ngModel)]="address.CountryID" [ngClass]="{
                  'select-background-edited': isEditModeCore
                }">
                <option *ngFor="let option of allCountries" [value]="option.CountryID">
                  {{ option?.CountryName }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="zip"> Zip/Postal Code </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="zip" id="zip" type="text" [(ngModel)]="address.PostalCode" />
            </div>
            <div class="input-field">
              <label for="phone"> Phone </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="phone" id="phone" type="text" [(ngModel)]="address.PhoneNumber" />
            </div>
            <div class="input-field">
              <label for="fax"> Fax </label>
              <input [disabled]="
                  !isEditModeCore ||
                  (disableAddressFields && !address.AddressID)
                " name="fax" id="fax" type="text" [(ngModel)]="address.FaxNumber" />
            </div>
            <hr *ngIf="i < firmAddresses.length - 1" />
          </ng-container>
        </ng-container>
      </div>
    </div>
  </section>

  <!--Scope Section-->
  <section #scopeSection class="form-section edit-scope-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Scope ? 'flex' : 'none'
    }">
    <!--scope tabs-->
    <div class="scope-container">
      <div class="menu-container tab-container">
        <ul class="nav">
          <li>
            <a (click)="switchScopeTab('Licensed')" [class.active]="activeSection === 'Licensed'"><i
                class="bi bi-award"></i>Licensed</a>
          </li>
          <li *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
            <a (click)="switchScopeTab('Authorized')" [class.active]="activeSection === 'Authorized'"><i
                class="bi bi-shield-check"></i>Authorized</a>
          </li>
        </ul>
      </div>
    </div>
    <!--Licensed Section-->
    <div *ngIf="tabIndex === 0" class="licensed-section">
      <div class="licensed-body" [ngClass]="{
          collapsed:
            isCollapsed['LicensedSection'] &&
            firmDetails?.AuthorisationStatusTypeID > 0
        }">
        <div class="inputs-field-set scopeFor">
          <!--Error messages for firm details-->
          <div class="error-messages">
            <p *ngIf="errorMessages['ScopeEffectiveDate']">
              {{ errorMessages['ScopeEffectiveDate'] }}
            </p>
            <p *ngIf="errorMessages['ScopeAppliedDate']">
              {{ errorMessages['ScopeAppliedDate'] }}
            </p>
            <p *ngIf="errorMessages['ScopeEffectiveDateLessThanApplicationDate']">
              {{ errorMessages['ScopeEffectiveDateLessThanApplicationDate'] }}
            </p>
            <p *ngIf="errorMessages['ScopeAppliedDateLessThanFirmLicApplDate']">
              {{ errorMessages['ScopeAppliedDateLessThanFirmLicApplDate'] }}
            </p>
            <p *ngIf="errorMessages['ActivityTypeIDCORRECTION']">
              {{ errorMessages['ActivityTypeIDCORRECTION'] }}
            </p>
          </div>
          <div class="form-section-title">
            <h2 class="edit-firm-header">
              Scope > <span>{{ firmDetails?.FirmName }}</span>
            </h2>
            <div *ngIf="currentLicRevisionNumber === lastLicRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !hideEditBtn &&
                  getControlVisibility('imgBtnEdit') &&
                  ActivityLicensed[0].ScopeRevNum
                ">
                <button [disabled]="!getControlEnablement('imgBtnEdit')" class="edit-btn" (click)="editLicenseScope()">
                  <i class="bi bi-pen"></i>Edit
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !loading &&
                  !hideSaveBtn &&
                  getControlVisibility('imgBtnSave')
                ">
                <button [disabled]="!getControlEnablement('imgBtnSave')" class="save-btn" (click)="saveLicenseScope()">
                  Save
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !loading &&
                  !hideCancelBtn &&
                  getControlVisibility('imgBtnCancel')
                ">
                <button [disabled]="!getControlEnablement('imgBtnCancel')" class="cancel-btn"
                  (click)="cancelEditLicScope()">
                  Cancel
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !loading &&
                  !hideCreateBtn &&
                  getControlVisibility('imgBtnCreate') &&
                  !ActivityLicensed[0].ScopeRevNum
                ">
                <button [disabled]="!getControlEnablement('imgBtnCreate')">
                  Create
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !loading &&
                  !hideReviseBtn &&
                  getControlVisibility('imgBtnRevise') &&
                  showVaryBtn
                ">
                <button [disabled]="!getControlEnablement('imgBtnRevise')">
                  Revise
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 0 &&
                  !loading &&
                  !hideDeleteBtn &&
                  getControlVisibility('imgBtnDelete')
                ">
                <button [disabled]="!getControlEnablement('imgBtnDelete')">
                  Delete
                </button>
              </div>
            </div>
          </div>
          <div class="inputs-row">
            <div style="width: 100%" class="input-field">
              <label for="formReff"> Form Reference </label>
              <!-- <input [disabled]="isEditModeLicense" [ngModel]="documentDetails.FileName"
                                name="formReff" id="formReff" type="text" value="" /> -->
              <!-- <a *ngIf="!isEditModeLicense" id="websiteLink"
                href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{documentDetails.Column3}}" target="_blank"
                rel="noopener noreferrer">
                {{documentDetails?.FileName}}
              </a> -->
            </div>
            <div style="width: 100%" class="input-field">
              <label for="linkScope"> Link To Scope </label>
              <input *ngIf="isEditModeLicense" name="linkScope" id="linkScope" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeCertificateLink" />
              <a *ngIf="!isEditModeLicense" id="websiteLink" [href]="ActivityLicensed[0].ScopeCertificateLink"
                target="_blank" rel="noopener noreferrer">
                {{ ActivityLicensed[0]?.ScopeCertificateLink }}
              </a>
            </div>
            <div class="input-field">
              <label for="scopeRevNum"> Scope Revision Number </label>
              <input disabled name="scopeRevNum" id="scopeRevNum" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeRevNum" />
            </div>
            <div class="input-field">
              <!--label is changed based on scoperevnum-->
              <label for="q13AppDate" *ngIf="
                  ActivityLicensed[0]?.ScopeRevNum > 1 &&
                  ActivityLicensed[0]?.ScopeRevNum
                ">
                Q13 Application Date for revisions
              </label>
              <!--label is changed based on scoperevnum-->
              <label *ngIf="
                  !ActivityLicensed[0]?.ScopeRevNum ||
                  ActivityLicensed[0]?.ScopeRevNum <= 1
                ">Application Date</label>
              <input [disabled]="disableApplicationDate" name="appDate" id="appDate" #dateInputs type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeAppliedDate" />
            </div>
            <div class="input-field">
              <label for="licenseDate"> Licensed Date </label>
              <input disabled name="licenseDate" id="licenseDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeLicensedDate }}" />
            </div>
            <div class="input-field" *ngIf="
                (ActivityLicensed[0].ScopeRevNum !== null ||
                  ActivityLicensed[0].ScopeRevNum !== '') &&
                ActivityLicensed[0].ScopeRevNum > 1
              ">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="!isEditModeLicense" disabled name="effectiveDate" id="effectiveDate" type="text"
                #dateInputs [(ngModel)]="ActivityLicensed[0].ScopeEffectiveDate" [ngClass]="{
                  'error-border':
                    errorMessages['ScopeEffectiveDate'] ||
                    errorMessages['ScopeEffectiveDateLessThanApplicationDate']
                }" />
            </div>
            <div class="input-field">
              <label for="createdBy"> Created By </label>
              <input disabled name="createdBy" id="createdBy" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedByName }}" />
            </div>
            <div class="input-field">
              <label for="modBy"> Modified By </label>
              <input disabled name="modBy" id="modBy" type="text" value="{{ ActivityLicensed[0]?.ModifiedBy }}" />
            </div>
            <div class="input-field">
              <label for="modDate"> Modification Date </label>
              <input disabled name="modDate" id="modDate" type="text"
                value="{{ ActivityLicensed[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for="createdDate"> Creation Date </label>
              <input disabled name="createdDate" id="createdDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedDate }}" />
            </div>
            <div *ngIf="isEditModeLicense && !hideReviseBtn && showVaryBtn" class="vary-scope">
              <button (click)="varyLicenseScope()">Vary Scope</button>
            </div>
          </div>
          <div *ngIf="!isEditModeLicense && ActivityLicensed[0].ScopeRevNum >= 1" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getLicScopePreviousVersions(firmId, 2)">View Previous Version</a>
          </div>
        </div>
        <!---->
        <div class="inputs-field-set">
          <div class="form-section-title">
            <h2 class="edit-firm-header">Permitted Activities</h2>
          </div>

          <div class="scope-permitted-activity-header">
            <p>Activity</p>
          </div>

          <!-- View Mode License -->
          <div class="permitted-activity-body" *ngFor="let activityLic of ActivityLicensed">
            <ng-container *ngIf="!isEditModeLicense && activityLic.FirmScopeTypeID === 1">
              <p *ngIf="!isEditModeLicense">
                {{ activityLic?.ActivityTypeDesc }}
              </p>

              <strong>Activity Details: </strong>
              <div class="input-field fullwidth">
                <textarea disabled>{{
                  removeHtmlTags(activityLic?.FirmActivityDetails)
                }}</textarea>
                <!-- <div [innerHTML]="activityLic?.FirmActivityDetails"></div> -->
              </div>

              <strong>Specific Conditions and Restrictions: </strong>
              <div class="input-field fullwidth">
                <textarea disabled>{{
                  removeHtmlTags(activityLic?.Column1)
                }}</textarea>
              </div>
            </ng-container>
          </div>
          <!-- Edit Mode License -->
          <div class="add-activity-container">
            <button *ngIf="isEditModeLicense" class="add-permitted-activity" (click)="addNewActivity()">
              Add Activity
            </button>
          </div>

          <div class="permitted-activity-body" *ngFor="let activityLic of ActivityLicensed; let i = index">
            <ng-container *ngIf="isEditModeLicense">
              <table *ngIf="isEditModeLicense">
                <tr>
                  <th style="width: 70%">Activity</th>
                  <th style="width: 30%">Action</th>
                  <th></th>
                </tr>

                <tr>
                  <td>
                    <div class="input-field">
                      <select name="activities" id="activities" [ngClass]="{
                          'select-background-edited': isEditModeLicense,
                          'error-border':
                            activityLic.ActivityTypeID == 0 &&
                            errorMessages['ActivityTypeID']
                        }" [(ngModel)]="activityLic.ActivityTypeID">
                        <option value="0">Select</option>
                        <option [value]="licensedActivity.ActivityTypeID"
                          *ngFor="let licensedActivity of licensedActivities">
                          {{ licensedActivity.ActivityTypeDesc }}
                        </option>
                      </select>
                    </div>
                  </td>
                  <td>
                    <div class="input-field">
                      <select [disabled]="
                          !(
                            this.ActivityLicensed[0].ScopeRevNum > 1 &&
                            !isNullOrEmpty(this.ActivityLicensed[0].ScopeRevNum)
                          )
                        " [ngClass]="{
                          'select-background-edited': isEditModeLicense
                        }" name="action" id="action" [(ngModel)]="activityLic.FirmScopeTypeID">
                        <option *ngFor="let firmScopeType of allFirmScopeTypes" [value]="firmScopeType.FirmScopeTypeID">
                          {{ firmScopeType.FirmScopeTypeDesc }}
                        </option>
                      </select>
                    </div>
                  </td>
                  <td>
                    <button class="rmvActivityLicBtn bi bi-trash" (click)="removeLicActivity(i)"></button>
                  </td>
                </tr>
                <tr class="error-messages">
                  <p *ngIf="
                      activityLic.ActivityTypeID == 0 &&
                      errorMessages['ActivityTypeID']
                    ">
                    {{ errorMessages['ActivityTypeID'] }}
                  </p>
                </tr>
              </table>

              <strong>Activity Details: </strong>
              <div class="input-field fullwidth">
                <textarea [(ngModel)]="activityLic.FirmActivityDetails">
              {{ activityLic?.FirmActivityDetails }}
              </textarea>
              </div>
              <strong>Specific Conditions and Restrictions: </strong>
              <div class="input-field fullwidth">
                <textarea [(ngModel)]="activityLic.Column1">{{
                  activityLic?.Column1
                }}</textarea>
              </div>
            </ng-container>
          </div>

          <div class="permitted-activity-container2">
            <div class="scope-permitted-activity-header">
              <p>General License Conditions or restrictions</p>
            </div>

            <div class="permitted-activity-body">
              <div class="input-field fullwidth">
                <textarea [disabled]="!isEditModeLicense"
                  [(ngModel)]="ActivityLicensed[0].GeneralConditions">{{ ActivityLicensed?.GeneralConditions }}</textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--Authorized Section-->
    <div class="authorized-section" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0 && tabIndex === 1">
      <div class="authorized-body" [ngClass]="{ collapsed: isCollapsed['authorizeSection'] }">
        <div class="inputs-field-set scopeFor">
          <div class="error-messages">
            <p *ngIf="errorMessages['ScopeAppliedDateAuth']">
              {{ errorMessages['ScopeAppliedDateAuth'] }}
            </p>
            <p *ngIf="errorMessages['ScopeEffectiveDateAuth']">
              {{ errorMessages['ScopeEffectiveDateAuth'] }}
            </p>
            <p *ngIf="errorMessages['EffectiveDateLaterApplicationDate']">
              {{ errorMessages['EffectiveDateLaterApplicationDate'] }}
            </p>
            <p *ngIf="errorMessages['correctPermittedActivities']">
              {{ errorMessages['correctPermittedActivities'] }}
            </p>
            <p *ngIf="errorMessages['PrudentialEffectiveDate']">
              {{ errorMessages['PrudentialEffectiveDate'] }}
            </p>
            <p *ngIf="errorMessages['SectorEffectiveDate']">
              {{ errorMessages['SectorEffectiveDate'] }}
            </p>
            <p *ngIf="errorMessages['SectorReturnType']">
              Please select valid "Prudential Return Type".
            </p>
          </div>
          <div class="form-section-title">
            <h2 class="edit-firm-header">
              Scope ><span>{{ firmDetails?.FirmName }}</span>
            </h2>
            <div *ngIf="currentAuthRevisionNumber === lastAuthRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !hideEditBtn &&
                  getControlVisibility('imgBtnEdit') &&
                  ActivityAuth[0].ScopeRevNum
                ">
                <button [disabled]="!getControlEnablement('imgBtnEdit')" class="edit-btn" (click)="editAuthScope()">
                  <i class="bi bi-pen"></i>Edit
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !loading &&
                  !hideSaveBtn &&
                  getControlVisibility('imgBtnSave')
                ">
                <button [disabled]="!getControlEnablement('imgBtnSave')" class="save-btn" (click)="saveAuthScope()">
                  Save
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !loading &&
                  !hideCancelBtn &&
                  getControlVisibility('imgBtnCancel')
                ">
                <button [disabled]="!getControlEnablement('imgBtnCancel')" class="cancel-btn"
                  (click)="cancelEditAuthScope()">
                  Cancel
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !loading &&
                  !hideCreateBtn &&
                  getControlVisibility('imgBtnCreate') &&
                  !ActivityAuth[0].ScopeRevNum
                ">
                <button [disabled]="!getControlEnablement('imgBtnCreate')">
                  Create
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !loading &&
                  !hideReviseBtn &&
                  getControlVisibility('imgBtnRevise') &&
                  showVaryBtn
                ">
                <button [disabled]="!getControlEnablement('imgBtnRevise')">
                  Revise
                </button>
              </div>

              <div class="btn" *ngIf="
                  tabIndex === 1 &&
                  !loading &&
                  !hideDeleteBtn &&
                  getControlVisibility('imgBtnDelete')
                ">
                <button [disabled]="!getControlEnablement('imgBtnDelete')">
                  Delete
                </button>
              </div>
            </div>
          </div>
          <div class="inputs-row">
            <div class="input-field">
              <label for="formReff"> Form Reference </label>
              <input disabled name="formReff" id="formReff" type="text" value="" />
            </div>
            <div style="width: 100%" class="input-field">
              <label for=""> Link To Scope </label>
              <a *ngIf="!isEditModeAuth" id="websiteLink" [href]="ActivityAuth[0]?.ScopeCertificateLink" target="_blank"
                rel="noopener noreferrer">
                {{ ActivityAuth[0]?.ScopeCertificateLink }}
              </a>
            </div>
            <div class="input-field">
              <label for=""> Scope Revision Number </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeRevNum }}" />
            </div>
            <div class="input-field">
              <!--label is changed based on scoperevnum-->
              <label for="q13AppDate" *ngIf="
                  ActivityAuth[0]?.ScopeRevNum > 1 &&
                  ActivityAuth[0]?.ScopeRevNum
                ">
                Q13 Application Date for revisions
              </label>
              <!--label is changed based on scoperevnum-->
              <label *ngIf="
                  !ActivityAuth[0]?.ScopeRevNum ||
                  ActivityAuth[0]?.ScopeRevNum <= 1
                ">Application Date</label>
              <input [disabled]="disableApplicationDate" [(ngModel)]="ActivityAuth[0].ScopeApplicationDate" [ngClass]="{
                  'error-border': errorMessages['ScopeAppliedDateAuth']
                }" name="q13AppDate" id="AppDate" type="text" #dateInputs />
            </div>
            <div class="input-field">
              <label for="incorporationDate"> Incorporation Date </label>
              <input disabled name="incorporationDate" id="incorporationDate" type="text"
                value="{{ firmDetails?.DateOfIncorporation }}" />
            </div>
            <div class="input-field">
              <label for="authorisedDate"> Authorised Date </label>
              <input disabled name="authorisedDate" id="authorisedDate" type="text"
                value="{{ ActivityAuth[0]?.ScopeLicensedOrAuthorisedDate }}" />
            </div>
            <div class="input-field" *ngIf="
                (ActivityAuth[0].ScopeRevNum !== null ||
                  ActivityAuth[0].ScopeRevNum !== '') &&
                ActivityAuth[0].ScopeRevNum > 1
              ">
              <label for="effectiveDate"> Effective Date </label>
              <input [(ngModel)]="ActivityAuth[0].ScopeEffectiveDate" [disabled]="!isEditModeAuth" name="effectiveDate"
                id="effectiveDate" type="text" #dateInputs />
            </div>
            <div class="input-field">
              <label for=""> Created By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.CreatedByName }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for=""> Creation Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.CreatedDate }}" />
            </div>
            <div [hidden]="!isEditModeAuth" class="vary-scope">
              <button (click)="varyAuthScope()">Vary Scope</button>
            </div>
          </div>
          <div *ngIf="!isEditModeAuth && ActivityAuth[0].ScopeRevNum >= 1" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getAuthScopePreviousVersions(firmId, 3)">View Previous Version</a>
          </div>
        </div>

        <!--Scope of Authorization-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['scopeOfAuthorization'] }">
          <div class="section">
            <div class="form-section-title collapse-container">
              <h2 class="edit-firm-header">Scope of Authorisation</h2>
              <button class="collapse-button" (click)="toggleCollapse('scopeOfAuthorization')">
                {{ isCollapsed['scopeOfAuthorization'] ? '▲' : '▼' }}
              </button>
            </div>
            <div *ngIf="isEditModeAuth && !AuthTableDocument?.DocSubTypeDesc" class="inputs-row document-container">
              <div class="input-field">
                <label>Document Type</label>
                <select>
                  <option>Scope of Authorisation</option>
                </select>
              </div>
              <div *ngIf="!AuthTableDocument?.DocSubTypeDesc" class="input-field">
                <label id="uploaded-documents">Uploaded documents go here</label>

                <div class="btns-container">
                  <div class="upload-container">
                    <button class="choose-document-btn" (click)="selectDocument()">
                      Choose Document
                    </button>
                  </div>
                  <button class="upload-document-btn" (click)="uploadDocument()">
                    Upload the Document
                  </button>
                </div>
              </div>
            </div>
            <div class="inputs-row">
              <table class="scope-of-auth">
                <thead>
                  <tr>
                    <th style="width: 60%">Document Type</th>
                    <th style="width: 30%">File Name</th>
                    <th *ngIf="isEditModeAuth">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="text-align: left">
                      <span [style.color]="
                          AuthTableDocument?.DocSubTypeDesc ? 'inherit' : 'red'
                        ">
                        {{
                        AuthTableDocument?.DocSubTypeDesc ||
                        'No documents attached'
                        }}
                      </span>
                    </td>
                    <td style="text-align: left">
                      <a id="websiteLink" href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{
                          AuthTableDocument?.FileLoc
                        }}" target="_blank">{{ AuthTableDocument?.FileName }}</a>
                    </td>
                    <td *ngIf="isEditModeAuth" style="text-align: center">
                      <button class="delete-action" *ngIf="AuthTableDocument?.DocSubTypeDesc"
                        (click)="showAlertDeleteFile()">
                        Delete
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!--Regulated Activities-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['regulatedActivitiesSection'] }">
          <div class="section">
            <div class="form-section-title collapse-container">
              <h2>Regulated Activities</h2>
              <button class="collapse-button" (click)="toggleCollapse('regulatedActivitiesSection')">
                {{ isCollapsed['regulatedActivitiesSection'] ? '▲' : '▼' }}
              </button>
            </div>
            <div [hidden]="isCollapsed['regulatedActivitiesSection']" class="add-btn-container" *ngIf="isEditModeAuth">
              <button class="add-permitted-btn" (click)="addNewPermittedActivity()">
                Add
              </button>
            </div>
            <!--on view mode-->
            <div class="regulated-activities-container">
              <div *ngFor="let activity of ActivityAuth; let i = index">
                <div class="regulated-activities-header regulated-activity-view" *ngIf="!isEditModeAuth">
                  <p>
                    Category :
                    <strong>{{ activity?.CategoryDescription }}</strong>
                  </p>
                  <p>
                    Activity :
                    <strong>{{ activity?.ActivityTypeDescription }}</strong>
                  </p>
                </div>
                <div *ngIf="!isEditModeAuth" class="products-header">
                  <p>Product(s)</p>
                </div>
                <!---->
                <!--on edit mode-->
                <div class="regulated-activities-header" *ngIf="isEditModeAuth">
                  <div class="select-container">
                    <div class="category-select">
                      <label for="category" style="display: flex; gap: 5px">
                        Category <span style="color: red">*</span>:
                      </label>
                      <select [(ngModel)]="activity.FirmScopeTypeID" (ngModelChange)="onCategoryChange(activity)"
                        name="category" id="category">
                        <option *ngFor="let category of activityCategories" [value]="category.ActivityCategoryID">
                          {{ category.ActivityCategoryDesc }}
                        </option>
                      </select>
                    </div>

                    <div class="activity-select">
                      <label for="activity" style="display: flex; gap: 5px">
                        Activity <span style="color: red">*</span>:
                      </label>
                      <select [(ngModel)]="activity.ActivityTypeID" (ngModelChange)="onActivityChange(activity)"
                        [ngClass]="{
                          'error-border':
                            errorMessages['ActivityTypeID'] &&
                            activity.ActivityTypeID === 0
                        }" name="activity" id="activity">
                        <option value="0">Select</option>
                        <option *ngFor="let act of activity.activities" [value]="act.ActivityTypeID">
                          {{ act.ActivityTypeDesc }}
                        </option>
                      </select>
                    </div>
                  </div>

                  <button class="removeRegulatedActivity bi bi-trash" style="margin-left: auto"
                    (click)="removePermittedActivity(i)"></button>
                </div>

                <!---->

                <!--on view mode-->
                <!-- Display categorized products -->
                <div *ngIf="
                    activity?.categorizedProducts?.length > 0 && !isEditModeAuth
                  ">
                  <div *ngFor="let category of activity.categorizedProducts">
                    <!-- Display Main Category -->
                    <h4 *ngIf="category.hasVisibleProducts">
                      {{ category.mainCategory }}
                    </h4>

                    <!-- Display Sub Products -->

                    <ul style="margin-left: 40px">
                      <li *ngFor="let subProduct of category.subProducts">
                        {{ subProduct.productTypeDescription }}
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- On Edit Mode Table -->
                <table class="regulated-activity-table" *ngIf="isEditModeAuth">
                  <thead>
                    <tr>
                      <th style="width: 60%">Product(s)</th>
                      <th style="width: 60%">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Loop through the categorized products -->
                    <tr *ngFor="let product of activity.categorizedProducts">
                      <td colspan="2">
                        <label>
                          <input type="checkbox" [(ngModel)]="product.isChecked" (change)="
                              toggleAllSubCategories(product, product.isChecked)
                            " />
                          {{ product.mainCategory }}
                        </label>

                        <!-- Nested table for sub-products -->
                        <table class="nested-table">
                          <tbody>
                            <tr *ngFor="let subProduct of product.subProducts">
                              <!-- Sub-product description below "Product(s)" header -->
                              <td style="width: 60%">
                                <label>
                                  <input type="checkbox" [(ngModel)]="subProduct.isChecked"
                                    (change)="updateMainCategoryState(product)" />
                                  {{ subProduct.ProductCategoryTypeDesc }}
                                </label>
                              </td>
                              <!-- Dropdown placed under "Action" header -->
                              <td style="width: 40%">
                                <select [disabled]="
                                    !(
                                      this.ActivityAuth[0].ScopeRevNum > 1 &&
                                      !isNullOrEmpty(
                                        this.ActivityAuth[0].ScopeRevNum
                                      )
                                    )
                                  " class="action-column" name="action" [(ngModel)]="subProduct.firmScopeTypeID">
                                  <option *ngFor="
                                      let firmScopeType of allFirmScopeTypes
                                    " [value]="firmScopeType.FirmScopeTypeID">
                                    {{ firmScopeType.FirmScopeTypeDesc }}
                                  </option>
                                </select>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>

                <div *ngIf="isEditModeAuth" class="error-messages">
                  <p *ngIf="activity?.errorMessages?.['ActivityTypeID']">
                    {{ activity.errorMessages['ActivityTypeID'] }}
                  </p>
                  <p *ngIf="activity?.errorMessages?.['Products']">
                    {{ activity.errorMessages['Products'] }}
                  </p>
                </div>

                <!-- on view mode -->
                <!--specific conditions and restrictions-->
                <div *ngIf="!isEditModeAuth" class="specific-conditions-and-restrictions">
                  <div class="specific-conditions-and-restrictions-header">
                    <p>Specific Conditions and Restrictions</p>
                  </div>

                  <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;{{
                    activity?.FirmActivityConditions
                    }}
                  </p>
                </div>

                <!-- on edit mode -->
                <div *ngIf="isEditModeAuth" class="specific-conditions-and-restrictions">
                  <div class="specific-conditions-and-restrictions-header">
                    <p>Specific Conditions and Restrictions</p>
                  </div>
                  <div class="input-field fullwidth">
                    <textarea [(ngModel)]="activity.FirmActivityConditions">
                    {{ activity?.FirmActivityConditions }}
                  </textarea>
                  </div>
                </div>
              </div>
              <!--Conditions and Restrictions-->
              <div class="conditions-and-restrictions-section">
                <div class="conditions-and-restrictions-header">
                  <p>Conditions and Restrictions</p>
                </div>

                <p *ngIf="
                    ActivityAuth[0]?.ObjectFirmScopeCondition?.length > 0 ||
                    isEditModeAuth
                  ">
                  <strong>Retail Restriction: </strong> &nbsp;
                  <span *ngIf="!isEditModeAuth">Yes</span>
                  <input *ngIf="isEditModeAuth" [(ngModel)]="isScopeConditionChecked" type="checkbox" />
                </p>

                <p>
                  <strong>General Authorisation Conditions or Restrictions</strong>
                </p>
                <div class="input-field fullwidth">
                  <textarea [disabled]="!isEditModeAuth"
                    [(ngModel)]="ActivityAuth[0].GeneralCondition">{{ ActivityAuth[0]?.GeneralCondition }}</textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Islamic Finance-->
        <div class="inputs-field-set" *ngIf="
            isEditModeAuth ||
            (!isEditModeAuth &&
              islamicFinance?.IFinTypeId > 0 &&
              !isIslamicFinanceDeleted)
          " [ngClass]="{ collapsed: isCollapsed['islamicFinanceSection'] }">
          <div class="form-section-title collapse-container">
            <h2 class="edit-firm-header">Islamic Finance</h2>
            <button class="collapse-button" (click)="toggleCollapse('islamicFinanceSection')">
              {{ isCollapsed['islamicFinanceSection'] ? '▲' : '▼' }}
            </button>
          </div>
          <div class="inputs-row">
            <div class="input-field" *ngIf="!isEditModeAuth">
              <label for="isIslamicFinanceExist"> Islamic Finance </label>
              <input disabled name="isIslamicFinanceExist" id="isIslamicFinanceExist" type="text"
                [value]="islamicFinance?.IFinTypeId !== null ? 'Yes' : 'No'" />
            </div>
            <!-- or -->
            <div class="input-field" *ngIf="isEditModeAuth">
              <div style="display: flex; gap: 15px">
                <label for="isIslamicFinanceExist"> Islamic Finance </label>
                <input style="width: 15px" type="checkbox" name="isIslamicFinanceExist" id="isIslamicFinanceExist"
                  [(ngModel)]="isIslamicFinanceChecked" />
              </div>
            </div>
            <div class="input-field">
              <label for="islamicFinanceType"> Type </label>
              <select [disabled]="!isIslamicFinanceChecked || !isEditModeAuth" name="islamicFinanceType"
                id="islamicFinanceType" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }" [(ngModel)]="islamicFinance.IFinTypeId">
                <option value="0">Select</option>
                <option value="1">Islamic Institution</option>
                <option value="2">Islamic Window</option>
              </select>
            </div>

            <div class="input-field endorsement">
              <label for="endorsement"> Endorsement </label>
              <textarea [disabled]="!isIslamicFinanceChecked || !isEditModeAuth" name="islamicEndorsement"
                id="endorsement" [(ngModel)]="islamicFinance.Endorsement"></textarea>
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                [(ngModel)]="islamicFinance.IFinLastModifiedByName" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modified Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                [(ngModel)]="islamicFinance.LastModifiedDate" />
            </div>
          </div>
        </div>

        <!--Prudential Category-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialCategorySection'] }">
          <div class="form-section-title collapse-container">
            <h2 class="edit-firm-header">Prudential Category</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialCategorySection')">
              {{ isCollapsed['prudentialCategorySection'] ? '▲' : '▼' }}
            </button>
          </div>
          <div class="inputs-row">
            <div class="input-field">
              <label for="prudentialCategory"> Prudential Category </label>
              <select [disabled]="!isEditModeAuth" name="prudentialCategory" id="prudentialCategory"
                [(ngModel)]="ActivityAuth[0].PrudentialCategoryTypeID"
                (ngModelChange)="onPrudentialCategoryChange($event)" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option value="0">Select</option>
                <option *ngFor="let option of allPrudentialCategoryTypes" [value]="option.PrudentialCategoryTypeID">
                  {{ option?.PrudentialCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="authorisationCategory">
                Authorisation Category
              </label>
              <select [disabled]="!isEditModeAuth" name="prudentialCategory" id="prudentialCategory"
                [(ngModel)]="ActivityAuth[0].AuthorisationCategoryTypeID" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option *ngFor="let option of allAuthorisationCategoryTypes"
                  [value]="option?.AuthorisationCategoryTypeID">
                  {{ option?.AuthorisationCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate">
                Effective Date
                <span *ngIf="isEditModeAuth" style="color: red">*</span></label>
              <input [disabled]="!isEditModeAuth" [(ngModel)]="ActivityAuth[0].PrudentialCategoryEffectiveDate"
                [ngClass]="{
                  'error-border': errorMessages['PrudentialEffectiveDate']
                }" name="effectiveDate" id="effectiveDate" type="text" #dateInputs />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text" value="{{
                  ActivityAuth[0]?.PrudentialCategoryLastModifiedByName
                }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.LastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="isEditModeAuth">
              <thead>
                <tr>
                  <th>Prudential Category</th>
                  <th>Authorisation Category</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let prudDetail of prudentialCategoryDetails">
                  <td>{{ prudDetail.PrudentialCategoryTypeDesc }}</td>
                  <td>{{ prudDetail.AuthorisationCategoryTypeDesc }}</td>
                  <td>{{ prudDetail.EffectiveDate }}</td>
                  <td>{{ prudDetail.ExpirationDate }}</td>
                  <td>{{ prudDetail.LastModifiedBy }}</td>
                  <td>
                    {{ prudDetail.LastModifiedDate }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!--Prudential Return Type / Sector-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialReturnTypeSection'] }">
          <div class="form-section-title collapse-container">
            <h2 class="edit-firm-header">Prudential Return Type</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialReturnTypeSection')">
              {{ isCollapsed['prudentialReturnTypeSection'] ? '▲' : '▼' }}
            </button>
          </div>
          <div class="inputs-row">
            <div class="input-field">
              <label for="prudentialReturnType">
                Prudential Return Type
                <span *ngIf="isEditModeAuth" style="color: red">*</span></label>
              <select (ngModelChange)="onSectorTypeChange($event)" [disabled]="!isEditModeAuth"
                [(ngModel)]="ActivityAuth[0].SectorTypeID" name="prudentialReturnType" id="prudentialReturnType"
                [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option value="0">Select</option>
                <option *ngFor="let PrudReturnTypes of prudReturnTypesDropdown" [value]="PrudReturnTypes.SectorTypeID">
                  {{ PrudReturnTypes?.SectorTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate">
                Effective Date
                <span *ngIf="isEditModeAuth" style="color: red">*</span></label>
              <input [disabled]="!isEditModeAuth" [(ngModel)]="ActivityAuth[0].SectorEffectiveDate" [ngClass]="{
                  'error-border': errorMessages['SectorEffectiveDate']
                }" name="effectiveDate" id="effectiveDate" type="text" #dateInputs />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ ActivityAuth[0]?.SectorLastModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.SectorLastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="isEditModeAuth">
              <thead>
                <tr>
                  <th>Prudential Return Type</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let sectorDetail of sectorDetails">
                  <td>{{ sectorDetail.SectorTypeDesc }}</td>
                  <td>{{ sectorDetail.EffectiveDate }}</td>
                  <td>{{ sectorDetail.ExpirationDate }}</td>
                  <td>{{ sectorDetail.LastModifiedBy }}</td>
                  <td>{{ sectorDetail.LastModifiedDate }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--Controllers-->
  <section #controllerSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Controller ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="form-section-title">
          <h2 class="edit-firm-header">
            Controllers > <span>{{ firmDetails?.FirmName }}</span>
          </h2>
          <div class="btn">
            <button (click)="createController()">
              <i class="bi bi-pen"></i>
              Create
            </button>
          </div>
        </div>
        <table class="controller-tables">
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let controller of FIRMControllers" (click)="openControllerPopup(controller)">
              <td>{{ controller.OtherEntityName }}</td>
              <td>{{ controller.EntityTypeDesc }}</td>
              <td>{{ controller.RegisteredNum }}</td>
              <td>{{ controller.ControllerControlTypeDesc }}</td>
              <td>{{ controller.PctOfShares }}</td>
              <td>{{ controller.AssnDateFrom }}</td>
              <td>{{ controller.AssnDateTo }}</td>
              <td>{{ controller.LastModifiedByOfOtherEntities }}</td>
              <td>{{ controller.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2 class="edit-firm-header">
          Ultimate Beneficial Owners > <span>{{ firmDetails?.FirmName }}</span>
        </h2>
        <table class="controller-tables">
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody *ngIf="FIRMControllersIndividual?.length > 0; else noRecords">
            <tr *ngFor="let controller of FIRMControllersIndividual" (click)="openControllerPopup(controller)">
              <td>{{ controller.OtherEntityName }}</td>
              <td>{{ controller.EntityTypeDesc }}</td>
              <td>{{ controller.RegisteredNum }}</td>
              <td>{{ controller.ControllerControlTypeDesc }}</td>
              <td>{{ controller.PctOfShares }}</td>
              <td>{{ controller.AssnDateFrom }}</td>
              <td>{{ controller.AssnDateTo }}</td>
              <td>{{ controller.LastModifiedByOfOtherEntities }}</td>
              <td>{{ controller.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #noRecords>
        <p class="norecords">---- No records found.</p>
      </ng-template>
    </div>
    <!-- Popup Section -->
    <div *ngIf="isPopupOpen" (click)="closeControllerPopup()" class="contollerPopupOverlay">
      <div (click)="$event.stopPropagation()" class="contollerPopupContent">
        <div class="error-messages">
          <p *ngIf="errorMessages['OtherEntityName']">
            {{ errorMessages['OtherEntityName'] }}
          </p>
          <p *ngIf="errorMessages['EffectiveDate']">
            {{ errorMessages['EffectiveDate'] }}
          </p>
          <p *ngIf="errorMessages['CessationDate']">
            {{ errorMessages['CessationDate'] }}
          </p>
          <p *ngIf="errorMessages['PlaceOfEstablishment']">
            {{ errorMessages['PlaceOfEstablishment'] }}
          </p>
          <p *ngIf="errorMessages['ControllerControlTypeDesc']">
            {{ errorMessages['ControllerControlTypeDesc'] }}
          </p>
          <p *ngIf="errorMessages['PctOfShares']">
            {{ errorMessages['PctOfShares'] }}
          </p>
        </div>
        <!-- Title -->
        <div class="popup-title-btn-row">
          <div class="popup-header">
            <h3>
              Controller Details For {{ selectedController?.OtherEntityName }}
            </h3>
          </div>
          <!-- Save and Cancel Buttons -->

          <button class="close-button" (click)="closeControllerPopup()">
            <i class="bi bi-x-circle close-icon"></i>
          </button>
        </div>

        <!-- Form -->
        <form>
          <div class="inputs-row">
            <div class="input-field">
              <label>Controller Type</label>
              <input [(ngModel)]="selectedController.EntityTypeDesc" name="ControllerType" disabled />
            </div>

            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'Parent Entity' ||
                selectedController.EntityTypeDesc === 'Corporate Controller' ||
                selectedController.EntityTypeDesc === 'UBO – Corporate' ||
                selectedController.EntityTypeDesc === 'Head Office of a Branch'
              ">
              <label>Full Name of Entity</label>
              <input [(ngModel)]="selectedController.OtherEntityName" name="fullName" [readonly]="!isEditable"
                required />
            </div>
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="title"> Title </label>
              <ng-container *ngIf="isEditable; else titleDisplay">
                <select [(ngModel)]="selectedController.Title" name="title" id="title">
                  <option *ngFor="let title of TitleEdit" [value]="title.TitleTypeId">
                    {{ title.TitleDesc }}
                  </option>
                </select>
              </ng-container>
              <ng-template #titleDisplay>
                <input [value]="selectedController.Title" name="title" id="title" readonly />
              </ng-template>
            </div>
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="firstName">
                First Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="selectedController.FirstName" name="firstName" id="firstName" type="text"
                [readonly]="!isEditable" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="secondName">
                Second Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="selectedController.SecondName" name="secondName" id="secondName" type="text"
                [readonly]="!isEditable" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="familyName">
                Family Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="selectedController.FamilyName" name="familyName" id="familyName" type="text"
                [readonly]="!isEditable" />
            </div>
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="placeOfBirth"> Place of birth </label>
              <ng-container *ngIf="isEditable; else placeOfBirthDisplay">
                <select required [(ngModel)]="CreatecontrollerDetails.PlaceOfBirth" name="placeOfBirth"
                  id="placeOfBirth">
                  <option *ngFor="let place of allCountries" [value]="place.CountryID">
                    {{ place.CountryName }}
                  </option>
                </select>
              </ng-container>
              <ng-template #placeOfBirthDisplay>
                <input [value]="selectedController.PlaceOfBirth" name="placeOfBirth" id="placeOfBirth" readonly />
              </ng-template>
            </div>

            <!---->
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="dateOfBirth">
                Date of birth <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="selectedController.DateOfBirth" #dateInputs name="dateOfBirth" id="dateOfBirth"
                type="input" [readonly]="!isEditable" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="passportNum"> Passport Number </label>
              <input [(ngModel)]="selectedController.PassportNum" name="passportNum" id="passportNum" type="text"
                [readonly]="!isEditable" />
            </div>
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="jurisdictionIssue"> Jurisdiction of Issue </label>
              <select name="jurisdictionIssue" id="jurisdictionIssue">
                <option value="select">Select</option>
              </select>
            </div>

            <!---->
            <div class="input-field" style="width: 100%" *ngIf="
                selectedController.EntityTypeDesc === 'UBO - Individual' ||
                selectedController.EntityTypeDesc === 'Individual Controller'
              ">
              <label for="isPEP">
                Is Politically Exposed Person (PEP)?
                <span style="color: red">*</span>
              </label>
              <div class="radio-wrapper">
                <input name="isPEP" id="yes" type="radio" [value]="true" [(ngModel)]="selectedController.IsPEP" />
                Yes
                <input name="isPEP" id="no" type="radio" [value]="false" [(ngModel)]="selectedController.IsPEP" />
                No
              </div>
            </div>
            <!---->
            <div class="input-field">
              <label>Legal Status</label>
              <ng-container *ngIf="isEditable; else legalStatusDisplay">
                <select [(ngModel)]="selectedController.LegalStatusTypeID" name="legalStatus">
                  <option *ngFor="let status of legalStatusOptionsEdit" [value]="status.LegalStatusTypeID">
                    {{ status.LegalStatusTypeDesc }}
                  </option>
                </select>
              </ng-container>
              <ng-template #legalStatusDisplay>
                <input [value]="getLegalStatusDescription()" name="legalStatus" readonly />
              </ng-template>
            </div>
            <div class="input-field">
              <label>Registered Number</label>
              <input [(ngModel)]="selectedController.RegisteredNum" name="registeredNum" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Place of Establishment:</label>
              <ng-container *ngIf="isEditable; else placeOfEstablishmentDisplay">
                <select required [(ngModel)]="selectedController.PlaceOfEstablishment" name="placeOfEstablishment">
                  <option *ngFor="let place of allCountries" [value]="place.CountryID">
                    {{ place.CountryName }}
                  </option>
                </select>
              </ng-container>
              <ng-template #placeOfEstablishmentDisplay>
                <input [value]="getPlaceOfEstablishmentName()" name="placeOfEstablishment" readonly />
              </ng-template>
            </div>

            <div class="input-field">
              <label for="typeOfControl">Type of Control</label>
              <ng-container *ngIf="isEditable; else typeOfControlDisplay">
                <select required [(ngModel)]="selectedController.ControllerControlTypeID"
                  (ngModelChange)="updateControlTypeDesc($event)" name="typeOfControl" id="typeOfControl">
                  <option *ngFor="let ControlType of controlTypeOptionsCreate"
                    [value]="ControlType.ControllerControlTypeID">
                    {{ ControlType.ControllerControlTypeDesc }}
                  </option>
                </select>
              </ng-container>
              <ng-template #typeOfControlDisplay>
                <input [value]="selectedController.ControllerControlTypeDesc" name="placeOfEstablishment" readonly />
              </ng-template>
            </div>
            <!-- Display the % of Holding field only if the control type is "Percentage" -->
            <ng-container *ngIf="selectedController.ControllerControlTypeID == 1">
              <div class="input-field">
                <label>% of Holding</label>
                <input [(ngModel)]="selectedController.PctOfShares" name="percentOfHolding" type="text"
                  [readonly]="!isEditable" />
              </div>
            </ng-container>
            <div class="input-field">
              <label>Effective Date</label>
              <ng-container *ngIf="isEditable; else effectiveDateInput">
                <input type="text" #dateInputs [(ngModel)]="selectedController.AssnDateFrom" name="effectiveDate" />
              </ng-container>
              <ng-template #effectiveDateInput>
                <input [(ngModel)]="selectedController.AssnDateFrom" name="effectiveDate" [readonly]="!isEditable" />
              </ng-template>
            </div>
            <div class="input-field">
              <label>Cessation Date</label>
              <ng-container *ngIf="isEditable; else cessationDateInput">
                <input type="text" #dateInputs [(ngModel)]="selectedController.AssnDateTo" name="cessationDate" />
              </ng-container>
              <ng-template #cessationDateInput>
                <input [(ngModel)]="selectedController.AssnDateTo" name="cessationDate" [readonly]="!isEditable" />
              </ng-template>
            </div>
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'Parent Entity' ||
                selectedController.EntityTypeDesc === 'Corporate Controller' ||
                selectedController.EntityTypeDesc === 'UBO – Corporate' ||
                selectedController.EntityTypeDesc === 'Head Office of a Branch'
              ">
              <label>Is The Company Regulated</label>
              <ng-container *ngIf="isEditable; else regulatedValue">
                <div style="display: flex; align-items: center">
                  <input type="radio" id="regulatedYes" [(ngModel)]="selectedController.IsCompanyRegulated"
                    name="isCompanyRegulated" [value]="true" style="margin-right: 10px; cursor: pointer" />
                  <label for="regulatedYes" style="margin-left: 5px; color: #413b3c">Yes</label>

                  <input type="radio" id="regulatedNo" [(ngModel)]="selectedController.IsCompanyRegulated"
                    name="isCompanyRegulated" [value]="false" style="
                      margin-left: 20px;
                      margin-right: 10px;
                      cursor: pointer;
                    " />
                  <label for="regulatedNo" style="margin-left: 5px; color: #413b3c">No</label>
                </div>
              </ng-container>
              <ng-template #regulatedValue>
                <span style="margin-left: 10px; color: #413b3c">
                  {{ selectedController.IsCompanyRegulated ? 'Yes' : 'No' }}
                </span>
              </ng-template>
            </div>
            <div class="input-field" *ngIf="
                selectedController.EntityTypeDesc === 'Parent Entity' ||
                selectedController.EntityTypeDesc === 'Corporate Controller' ||
                selectedController.EntityTypeDesc === 'UBO – Corporate' ||
                selectedController.EntityTypeDesc === 'Head Office of a Branch'
              ">
              <label for="isParent">Is it also Parent / Corporate Controller?</label>
              <ng-container *ngIf="isEditable; else parentValue">
                <div style="display: flex; align-items: center">
                  <input type="radio" id="parentYes" [(ngModel)]="selectedController.IsParentController" name="isParent"
                    [value]="true" style="margin-right: 10px; cursor: pointer" />
                  <label for="parentYes" style="margin-left: 5px; color: #413b3c">Yes</label>

                  <input type="radio" id="parentNo" [(ngModel)]="selectedController.IsParentController" name="isParent"
                    [value]="false" style="
                      margin-left: 20px;
                      margin-right: 10px;
                      cursor: pointer;
                    " />
                  <label for="parentNo" style="margin-left: 5px; color: #413b3c">No</label>
                </div>
              </ng-container>
              <ng-template #parentValue>
                <span style="margin-left: 10px; color: #413b3c">
                  {{ selectedController.IsParentController ? 'Yes' : 'No' }}
                </span>
              </ng-template>
            </div>

            <div class="input-field" *ngIf="selectedController.EntityTypeDesc === 'UBO – Corporate'">
              <label for="isCompanyTraded">Is the company publicly traded?</label>
              <ng-container *ngIf="isEditable; else tradedValue">
                <div style="display: flex; align-items: center">
                  <input type="radio" id="tradedYes" [(ngModel)]="selectedController.IsPublicallyTraded"
                    name="isCompanyTraded" [value]="true" style="margin-right: 10px; cursor: pointer" />
                  <label for="tradedYes" style="margin-left: 5px; color: #413b3c">Yes</label>

                  <input type="radio" id="tradedNo" [(ngModel)]="selectedController.IsPublicallyTraded"
                    name="isCompanyTraded" [value]="false" style="
                      margin-left: 20px;
                      margin-right: 10px;
                      cursor: pointer;
                    " />
                  <label for="tradedNo" style="margin-left: 5px; color: #413b3c">No</label>
                </div>
              </ng-container>
              <ng-template #tradedValue>
                <span style="margin-left: 10px; color: #413b3c">
                  {{ selectedController.IsPublicallyTraded ? 'Yes' : 'No' }}
                </span>
              </ng-template>
            </div>
            <div class="input-field" *ngIf="
                selectedController.IsPublicallyTraded === false &&
                selectedController.EntityTypeDesc === 'UBO – Corporate'
              ">
              <label for="more10UBOs">Are there any UBOs that own more than 10% of this
                entity?</label>
              <ng-container *ngIf="isEditable; else moreUBOsValue">
                <div style="display: flex; align-items: center">
                  <input type="radio" id="UBOYes" [(ngModel)]="selectedController.More10UBOs" name="more10UBOs"
                    [value]="true" style="margin-right: 10px; cursor: pointer" />
                  <label for="UBOYes" style="margin-left: 5px; color: #413b3c">Yes</label>

                  <input type="radio" id="UBONo" [(ngModel)]="selectedController.More10UBOs" name="more10UBOs"
                    [value]="false" style="
                      margin-left: 20px;
                      margin-right: 10px;
                      cursor: pointer;
                    " />
                  <label for="UBONo" style="margin-left: 5px; color: #413b3c">No</label>
                </div>
              </ng-container>
              <ng-template #moreUBOsValue>
                <span style="margin-left: 10px; color: #413b3c">
                  {{ selectedController.More10UBOs ? 'Yes' : 'No' }}
                </span>
              </ng-template>
            </div>
          </div>
          <div class="inputs-row">
            <div class="input-field additional-details fullwidth">
              <label for="additionalDetails"> Additional Details </label>
              <textarea [(ngModel)]="selectedController.AdditionalDetails" name="additionalDetails"
                id="additionalDetails" [readonly]="!isEditable"></textarea>
            </div>
          </div>
          <!-- Addresses Section -->
          <div class="addresses">
            <div class="popup-header">
              <h3>Addresses</h3>
            </div>

            <!-- Address Details -->
            <div *ngFor="let address of addressForms; let i = index">
              <div class="inputs-row">
                <div class="input-field">
                  <label>Address Type</label>
                  <select [(ngModel)]="address.AddressTypeID" name="addressType" disabled>
                    <option *ngFor="let type of addressTypeOptionsEdit" [value]="type.AddressTypeID">
                      {{ type.AddressTypeDesc }}
                    </option>
                  </select>
                </div>
                <div class="input-field">
                  <label>Address - Line 1</label>
                  <input type="text" [(ngModel)]="address.addressLine1" name="addressLine1" id="addressLine1"
                    [readonly]="!isEditable" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " />
                </div>
                <div class="input-field">
                  <label>Address - Line 2</label>
                  <input [(ngModel)]="address.addressLine2" name="addressLine2" id="addressLine2"
                    [readonly]="!isEditable" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " />
                </div>
              </div>
              <div class="inputs-row">
                <div class="input-field">
                  <label for="address3"> Address - Line 3 </label>
                  <input [(ngModel)]="address.addressLine3" name="address3" id="address3" type="text" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " [readonly]="!isEditable" />
                </div>

                <div class="input-field">
                  <label for="address4"> Address - Line 4 </label>
                  <input [(ngModel)]="address.addressLine4" name="address4" id="address4" type="text" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " [readonly]="!isEditable" />
                </div>
                <div class="input-field">
                  <label for="city">City</label>
                  <input [(ngModel)]="address.city" name="city" id="city" type="text" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " [readonly]="!isEditable" />
                </div>
              </div>
              <div class="inputs-row">
                <div class="input-field">
                  <label for="stateProvince">State/Province</label>
                  <input [(ngModel)]="address.stateProvince" name="stateProvince" id="stateProvince" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " [readonly]="!isEditable" />
                </div>
                <div class="input-field">
                  <label for="country">Country</label>
                  <ng-container *ngIf="isEditable; else countryInput">
                    <select [(ngModel)]="address.CountryID" name="country" [disabled]="
                        address.sameAsTypeID && address.sameAsTypeID != 0
                      ">
                      <option *ngFor="let country of allCountries" [value]="country.CountryID">
                        {{ country.CountryName }}
                      </option>
                    </select>
                  </ng-container>
                  <ng-template #countryInput>
                    <input [(ngModel)]="address.CountryID" name="country" [readonly]="!isEditable" />
                  </ng-template>
                </div>
                <div class="input-field">
                  <label for="zipPostalCode">Zip/Postal Code</label>
                  <input [(ngModel)]="address.zipPostalCode" name="zipPostalCode" id="zipPostalCode"
                    [readonly]="!isEditable" [disabled]="
                      address.sameAsTypeID && address.sameAsTypeID != 0
                    " />
                </div>
              </div>
            </div>
          </div>
          <ng-container *ngIf="
              !isEditable ||
              (isEditable && selectedController.IsCompanyRegulated)
            ">
            <div class="popup-header">
              <h3>Home State Regulators</h3>
            </div>

            <div *ngFor="let regulator of regulatorList; let i = index">
              <div class="inputs-row">
                <div class="input-field">
                  <label for="regulators">Regulator <span style="color: red">*</span></label>
                  <ng-container *ngIf="isEditable; else regulatorinput">
                    <select required [(ngModel)]="regulator.RegulatorName" name="regulators" id="regulators">
                      <option *ngFor="let Regulater of AllRegulater" [value]="Regulater.RegulatorID">
                        {{ Regulater.RegulatorName }}
                      </option>
                    </select>
                  </ng-container>
                  <ng-template #regulatorinput>
                    <input [(ngModel)]="regulator.RegulatorName" name="regulators" id="regulators"
                      [readonly]="!isEditable" />
                  </ng-template>
                </div>
                <div class="input-field">
                  <label>Regulator Contact</label>
                  <input [(ngModel)]="selectedController.RegulatorContact" name="regulatorContact"
                    [readonly]="!isEditable" />
                </div>
              </div>
            </div>
          </ng-container>
          <div class="btn justify-content-end">
            <button *ngIf="!isEditable" (click)="editController()">
              <i class="bi bi-pen"></i> Edit
            </button>
            <button *ngIf="isEditable" (click)="saveControllerPopupChanges()">
              <i class="bi bi-save"></i> Save
            </button>
            <button (click)="confarmDeleteControllerDetials()">
              <i class="bi bi-trash"></i> Delete
            </button>
          </div>
        </form>
      </div>
    </div>
    <!-- heree -->
    <div *ngIf="showCreateControllerSection" class="contollerPopupOverlay">
      <div class="contollerPopupContent">
        <div class="popup-title-btn-row">
          <div class="popup-header">
            <h3>Controller For {{ firmDetails?.FirmName }}</h3>
          </div>
          <button (click)="closeCreateControllerPopup()" class="close-button">
            <i class="bi bi-x-circle close-icon"></i>
          </button>
          <div class="btn"></div>
        </div>

        <div class="error-messages">
          <p *ngIf="errorMessages['OtherEntityName']">
            {{ errorMessages['OtherEntityName'] }}
          </p>
          <p *ngIf="errorMessages['EffectiveDate']">
            {{ errorMessages['EffectiveDate'] }}
          </p>
          <p *ngIf="errorMessages['CessationDate']">
            {{ errorMessages['CessationDate'] }}
          </p>
          <p *ngIf="errorMessages['PlaceOfEstablishment']">
            {{ errorMessages['PlaceOfEstablishment'] }}
          </p>
          <p *ngIf="errorMessages['ControllerControlTypeDesc']">
            {{ errorMessages['ControllerControlTypeDesc'] }}
          </p>
          <p *ngIf="errorMessages['PctOfShares']">
            {{ errorMessages['PctOfShares'] }}
          </p>
        </div>
        <div class="inputs-row">
          <div class="input-field">
            <label for="controllerType">
              Controller Type <span style="color: red">*</span>
            </label>
            <select name="controllerType" id="controllerType" [(ngModel)]="CreatecontrollerDetails"
              (change)="changeControlType()">
              <option value="select" selected>Select</option>
              <option *ngFor="let controllerType of controllerTypeOption" [ngValue]="controllerType">
                {{ controllerType.EntityTypeDesc }}
              </option>
            </select>
          </div>
          <ng-container *ngIf="!hideForms">
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'Parent Entity' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Corporate Controller' ||
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Head Office of a Branch'
              ">
              <label for="entityName">
                Full Name of Entity <span style="color: red">*</span>
              </label>
              <input name="entityName" id="entityName" [(ngModel)]="CreatecontrollerDetails.OtherEntityName"
                type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="individualTitle"> Title </label>
              <select [(ngModel)]="CreatecontrollerDetails.Title" name="legalStatus">
                <option *ngFor="let title of TitleEdit" [value]="title.TitleTypeId">
                  {{ title.TitleDesc }}
                </option>
              </select>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="firstName">
                First Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="CreatecontrollerDetails.FirstName" name="firstName" id="firstName" type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="secondName">
                Second Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="CreatecontrollerDetails.SecondName" name="secondName" id="secondName" type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="familyName">
                Family Name <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="CreatecontrollerDetails.FamilyName" name="familyName" id="familyName" type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="placeOfBirth"> Place of birth </label>
              <select required [(ngModel)]="CreatecontrollerDetails.PlaceOfBirth" name="placeOfBirth">
                <option *ngFor="let place of allCountries" [value]="place.CountryID">
                  {{ place.CountryName }}
                </option>
              </select>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="dateOfBirth">
                Date of birth <span style="color: red">*</span>
              </label>
              <input [(ngModel)]="CreatecontrollerDetails.DateOfBirth" #dateInputs name="dateOfBirth" id="dateOfBirth"
                type="input" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="passportNum"> Passport Number </label>
              <input [(ngModel)]="CreatecontrollerDetails.PassportNum" name="passportNum" id="passportNum"
                type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="jurisdictionIssue"> Jurisdiction of Issue </label>
              <select name="jurisdictionIssue" id="jurisdictionIssue">
                <option value="select">Select</option>
              </select>
            </div>
            <!---->
            <div class="input-field" style="width: 100%" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO - Individual' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Individual Controller'
              ">
              <label for="isPEP">
                Is Politically Exposed Person (PEP)?
                <span style="color: red">*</span>
              </label>
              <div class="radio-wrapper">
                <input name="isPEP" id="yes" type="radio" [value]="true" [(ngModel)]="CreatecontrollerDetails.IsPEP" />
                Yes
                <input name="isPEP" id="no" type="radio" [value]="false" [(ngModel)]="CreatecontrollerDetails.IsPEP" />
                No
              </div>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'Parent Entity' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Corporate Controller' ||
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Head Office of a Branch'
              ">
              <label for="legalStatus"> Legal Status </label>
              <select [(ngModel)]="CreatecontrollerDetails.LegalStatusTypeID" name="legalStatus">
                <option *ngFor="let status of legalStatusOptionsEdit" [value]="status.LegalStatusTypeID">
                  {{ status.LegalStatusTypeDesc }}
                </option>
              </select>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'Parent Entity' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Corporate Controller' ||
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Head Office of a Branch'
              ">
              <label for="registeredNumber"> Registered Number </label>
              <input [(ngModel)]="CreatecontrollerDetails.RegisteredNum" name="registeredNumber" id="registeredNumber"
                type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'Parent Entity' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Corporate Controller' ||
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Head Office of a Branch'
              ">
              <label for="establishmentPlace">
                Place of Establishment <span style="color: red">*</span>
              </label>
              <select required [(ngModel)]="CreatecontrollerDetails.PlaceOfEstablishment" name="placeOfEstablishment">
                <option *ngFor="let place of allCountries" [value]="place.CountryID">
                  {{ place.CountryName }}
                </option>
              </select>
            </div>
            <!---->
            <!-- Display the % of Holding field only if the control type is "Percentage" -->

            <div class="input-field">
              <label for="controlType">
                Type of Control <span style="color: red">*</span>
              </label>
              <select required [(ngModel)]="CreatecontrollerDetails.ControllerControlTypeID" name="typeOfControl"
                id="typeOfControl" (ngModelChange)="CreateControlTypeDesc($event)">
                <option *ngFor="let ControlType of controlTypeOptionsCreate"
                  [value]="ControlType.ControllerControlTypeID">
                  {{ ControlType.ControllerControlTypeDesc }}
                </option>
              </select>
            </div>

            <!-- Conditionally show the 'Percentage' input if the type is 'Percentage' -->
            <ng-container *ngIf="CreatecontrollerDetails.ControllerControlTypeID == 1">
              <div class="input-field">
                <label for="holdingsPercentage"> % of Holding </label>
                <input [(ngModel)]="CreatecontrollerDetails.PctOfShares" name="holdingsPercentage"
                  id="holdingsPercentage" type="text" />
              </div>
            </ng-container>

            <!---->
            <div class="input-field">
              <label for="effectiveDate"> Effective Date </label>
              <input [(ngModel)]="CreatecontrollerDetails.AssnDateFrom" name="effectiveDate" id="effectiveDate"
                #dateInputs type="text" />
            </div>
            <!---->
            <div class="input-field">
              <label for="cessationDate"> Cessation Date </label>
              <input [(ngModel)]="CreatecontrollerDetails.AssnDateTo" name="cessationDate" id="cessationDate"
                #dateInputs type="text" />
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'Parent Entity' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Corporate Controller' ||
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate' ||
                CreatecontrollerDetails.EntityTypeDesc ===
                  'Head Office of a Branch'
              ">
              <label for="isRegulated"> Is the company regulated : </label>
              <div class="radio-wrapper">
                <input name="isRegulated" id="yes" type="radio" [(ngModel)]="CreatecontrollerDetails.IsCompanyRegulated"
                  [value]="true" />
                Yes
                <input name="isRegulated" id="no" type="radio" [(ngModel)]="CreatecontrollerDetails.IsCompanyRegulated"
                  [value]="false" />
                No
              </div>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate'
              ">
              <label for="isParent">
                Is it also Parent / Corporate Controller? :
              </label>
              <div class="radio-wrapper">
                <input name="isParent" id="yes" type="radio" [(ngModel)]="CreatecontrollerDetails.IsParentController" />
                Yes
                <input name="isParent" id="no" type="radio" [(ngModel)]="CreatecontrollerDetails.IsParentController" />
                No
              </div>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate'
              ">
              <label for="isCompanyTraded">
                Is the company publicly traded :
              </label>
              <div class="radio-wrapper">
                <input name="isCompanyTraded" id="yes" type="radio"
                  [(ngModel)]="CreatecontrollerDetails.IsPublicallyTraded" [value]="true" />
                Yes
                <input name="isCompanyTraded" id="no" type="radio"
                  [(ngModel)]="CreatecontrollerDetails.IsPublicallyTraded" [value]="false" />
                No
              </div>
            </div>
            <!---->
            <div class="input-field" *ngIf="
                CreatecontrollerDetails.IsPublicallyTraded === false &&
                CreatecontrollerDetails.EntityTypeDesc === 'UBO – Corporate'
              ">
              <label for="more10UBOs">
                Are there any UBOs that own more than 10% of this entity? :
              </label>
              <div class="radio-wrapper">
                <input name="more10UBOs" id="yes" type="radio" [(ngModel)]="CreatecontrollerDetails.More10UBOs"
                  [value]="true" />
                Yes
                <input name="more10UBOs" id="no" type="radio" [(ngModel)]="CreatecontrollerDetails.More10UBOs"
                  [value]="false" />
                No
              </div>
            </div>

            <div class="input-field additional-details fullwidth">
              <label for="additionalDetails"> Additional Details </label>
              <textarea [(ngModel)]="CreatecontrollerDetails.AdditionalDetails" name="additionalDetails"
                id="additionalDetails"></textarea>
            </div>
            <!---->
          </ng-container>
        </div>
        <div *ngIf="!hideForms" class="addresses create--inputs-field-set">
          <div class="popup-header">
            <h3>Addresses</h3>
            <button (click)="addAddressForm()" [disabled]="addressForms.length >= 3" style="
                background-color: green;
                color: white;
                border: none;
                padding: 5px;
                cursor: pointer;
                border-radius: 5px;
                float: right;
              ">
              <i style="size: 7px" class="bi bi-plus-lg"></i>
            </button>
          </div>
          <div *ngFor="let address of addressForms; let i = index">
            <hr />
            <button (click)="removeAddressForm(i)" style="
                float: right;
                background-color: red;
                color: white;
                border: none;
                padding: 5px;
                cursor: pointer;
                border-radius: 5px;
              ">
              <i style="size: 5px" class="bi bi-x-lg"></i>
            </button>

            <div class="inputs-row">
              <!-- Address Type -->
              <div class="input-field">
                <label for="addressType"> Address Type </label>
                <select [(ngModel)]="address.AddressTypeID" (change)="onAddressTypeChange($event, address)" [ngClass]="{
                    'error-border':
                      !address.AddressTypeID && errorMessages['AddressTypeID'],
                    'select-background-edited': isEditModeCore
                  }" [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0">
                  <!-- Disable if Same As Type is selected -->
                  <option value="0">Select</option>
                  <option *ngFor="let option of allAddressTypes" [value]="option.AddressTypeID">
                    {{ option.AddressTypeDesc }}
                  </option>
                </select>
              </div>

              <!-- Same As Type (only for forms after the first one) -->
              <div *ngIf="i > 0" class="input-field">
                <label for="sameAsType">Same As Type</label>
                <select [(ngModel)]="address.sameAsTypeID" (change)="onSameAsTypeChangeg($event, address)" [ngClass]="{
                    'error-border':
                      !address.sameAsTypeID && errorMessages['sameAsTypeID'],
                    'select-background-edited': isEditModeCore
                  }" id="sameAsType" name="sameAsType">
                  <option value="0">Select</option>
                  <!-- Dynamically populate the options from previous forms' AddressTypeID -->
                  <option *ngFor="let form of addressForms.slice(0, i)" [value]="form.AddressTypeID">
                    {{ getAddressTypeDesc(form.AddressTypeID) }}
                  </option>
                </select>
              </div>

              <!-- Other fields will be disabled if Same As Type has a value -->
              <div class="input-field">
                <label for="address1"> Address - Line 1 </label>
                <input [(ngModel)]="address.addressLine1" name="address1" id="address1" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="address2"> Address - Line 2 </label>
                <input [(ngModel)]="address.addressLine2" name="address2" id="address2" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="address3"> Address - Line 3 </label>
                <input [(ngModel)]="address.addressLine3" name="address3" id="address3" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="address4"> Address - Line 4 </label>
                <input [(ngModel)]="address.addressLine4" name="address4" id="address4" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="city"> City </label>
                <input [(ngModel)]="address.city" name="city" id="city" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="state"> State/Province </label>
                <input [(ngModel)]="address.stateProvince" name="state" id="state" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>

              <div class="input-field">
                <label for="country"> Country </label>
                <select required [(ngModel)]="address.CountryID" (change)="getAllRegulater(+address.CountryID, firmId)"
                  name="Country" id="Country" [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0">
                  <option *ngFor="let place of allCountries" [value]="place.CountryID">
                    {{ place.CountryName }}
                  </option>
                </select>
              </div>

              <div class="input-field">
                <label for="zipCode"> Zip/Postal Code </label>
                <input [(ngModel)]="address.zipPostalCode" name="zipCode" id="zipCode" type="text"
                  [disabled]="address.sameAsTypeID && address.sameAsTypeID != 0" />
              </div>
            </div>
          </div>
        </div>

        <div class="create--inputs-field-set" *ngIf="CreatecontrollerDetails.IsCompanyRegulated === true">
          <div class="create-controller-actions">
            <h2 class="create-controller-header">Home State Regulators</h2>
          </div>

          <!-- Add regulator button -->

          <button (click)="addRegulator()" style="
              background-color: green;
              color: white;
              border: none;
              padding: 5px;
              cursor: pointer;
              border-radius: 5px;
              float: right;
            ">
            <i style="size: 7px" class="bi bi-plus-lg"></i>
          </button>

          <!-- Dynamically generate form inputs for each regulator in regulatorList -->
          <div *ngFor="let regulator of regulatorList; let i = index" class="create-controller-inputs">
            <hr />
            <div style="width: 100%">
              <button (click)="removeRegulator(i)" style="
                  float: right;
                  background-color: red;
                  color: white;
                  border: none;
                  padding: 5px;
                  cursor: pointer;
                  border-radius: 5px;
                ">
                <i style="size: 5px" class="bi bi-x-lg"></i>
              </button>
            </div>
            <div class="input-field home-state-regulators-container">
              <!-- Regulator Name input -->
              <div class="regulator-select-container">
                <label for="regulators">Regulator <span style="color: red">*</span></label>
                <select required [(ngModel)]="regulator.RegulatorName" name="regulators" id="regulators">
                  <option *ngFor="let Regulater of AllRegulater" [value]="Regulater.RegulatorID">
                    {{ Regulater.RegulatorName }}
                  </option>
                </select>
              </div>
              <!-- Remove button for each regulator -->
            </div>

            <!-- Regulator Contact input (disabled as per your code) -->
            <div class="input-field regulator-contact-container">
              <label for="regulatorContact-{{ i }}">Regulator Contact</label>
              <input disabled type="text" [(ngModel)]="regulator.RegulatorContacts" name="regulatorContact-{{ i }}"
                id="regulatorContact-{{ i }}" />
            </div>
          </div>
        </div>
        <div class="btn justify-content-end">
          <button class="save-btn" (click)="createControllerPopupChanges()">
            Save
          </button>
        </div>
      </div>
    </div>
  </section>

  <!--Auditors-->
  <section #auditorSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Auditor ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="auditor-header">
          <h2 class="edit-firm-header">
            Auditors > <span>{{ firmDetails?.FirmName }}</span>
          </h2>
          <div class="btn">
            <button (click)="createAuditor()">
              <i class="bi bi-plus"></i>
              Create
            </button>
          </div>
        </div>
        <span class="enhanced-checkbox">
          <input id="InactiveAuditors" type="checkbox" (change)="onInactiveAuditorsToggle($event)" />
          <label for="InactiveAuditors">Display Inactive Auditors</label>
        </span>
        <table class="auditor-table">
          <thead>
            <tr>
              <!--leave it empty-->
              <th>Auditor Name</th>
              <th>Auditor Type</th>
              <th>Effective From Date</th>
              <th>Effective To Date</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let auditor of filteredAuditors" (click)="viewAuditor(auditor)">
              <td (click)="viewAuditor(auditor)">
                {{ auditor.OtherEntityName }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.EntitySubTypeDesc }}
              </td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateFrom }}</td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateTo }}</td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastMeodifiedBy }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastModifiedDate }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Popup for viewing/editing auditor -->
    <div *ngIf="IsViewAuditorVisible || IsEditAuditorVisible" class="contollerPopupOverlay">
      <div class="contollerPopupContent">
        <div class="popup-title-btn-row">
          <div class="popup-header">
            <h3>
              {{
              IsEditAuditorVisible
              ? 'Edit Auditor Details'
              : 'Auditor Details'
              }}
            </h3>
          </div>
          <button class="close-button" (click)="closeAuditorPopup()">
            <i class="bi bi-x-circle close-icon"></i>
          </button>
        </div>
        <div class="error-messages">
          <!-- Auditor Name Error -->
          <p *ngIf="errorMessages['OtherEntityName']">
            {{ errorMessages['OtherEntityName'] }}
          </p>
          <!-- Auditor Type Error -->
          <p *ngIf="errorMessages['EntitySubTypeID']">
            {{ errorMessages['EntitySubTypeID'] }}
          </p>
          <p *ngIf="errorMessages['AssnDateFrom']">
            {{ errorMessages['AssnDateFrom'] }}
          </p>
          <p *ngIf="errorMessages['AssnDateTo']">
            {{ errorMessages['AssnDateTo'] }}
          </p>
        </div>
        <form>
          <div class="inputs-row">
            <div class="input-field">
              <label for="auditorName">Auditor Name</label>
              <ng-container *ngIf="IsEditAuditorVisible; else viewAuditorName">
                <select disabled name="auditorName" id="auditorName" [(ngModel)]="selectedAuditor.OtherEntityID">
                  <option *ngFor="let name of firmAuditorName" [value]="name.OtherEntityID">
                    {{ name.OtherEntityName }}
                  </option>
                </select>
              </ng-container>
              <ng-template #viewAuditorName>
                <input name="auditorName" id="auditorName" type="text" [(ngModel)]="selectedAuditor.OtherEntityName"
                  disabled />
              </ng-template>
            </div>
            <div class="input-field">
              <label for="auditorType">Auditor Type</label>
              <ng-container *ngIf="IsEditAuditorVisible; else viewAuditorType">
                <select name="auditorType" id="auditorType" [(ngModel)]="selectedAuditor.EntitySubTypeID">
                  <option *ngFor="let type of firmAuditorType" [value]="type.EntitySubTypeID">
                    {{ type.EntitySubTypeDesc }}
                  </option>
                </select>
              </ng-container>
              <ng-template #viewAuditorType>
                <input name="auditorType" id="auditorType" type="text" [(ngModel)]="selectedAuditor.EntitySubTypeDesc"
                  disabled />
              </ng-template>
            </div>
            <div class="input-field">
              <label for="effectiveFromDate">Effective From Date</label>
              <input [disabled]="!IsEditAuditorVisible" #dateInputs name="effectiveFromDate" id="effectiveFromDate"
                type="text" [(ngModel)]="selectedAuditor.AssnDateFrom" />
            </div>
            <div class="input-field">
              <label for="effectiveToDate">Effective To Date</label>
              <input [disabled]="!IsEditAuditorVisible" #dateInputs name="effectiveToDate" id="effectiveToDate"
                type="text" [(ngModel)]="selectedAuditor.AssnDateTo" />
            </div>
          </div>
          <div class="btn justify-content-end">
            <button *ngIf="!IsEditAuditorVisible" (click)="editAuditor()">
              <i class="bi bi-pen"></i> Edit
            </button>
            <button *ngIf="!IsEditAuditorVisible" (click)="confirmDeleteAuditor()">
              <i class="bi bi-trash"></i> Delete
            </button>
            <button *ngIf="IsEditAuditorVisible" (click)="saveEditAuditor()">
              <i class="bi bi-save"></i> Save
            </button>
            <button *ngIf="IsEditAuditorVisible" (click)="cancelEdit()">
              <i class="bi bi-x"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
    <!-- create Auditor popup -->
    <div class="contollerPopupOverlay" *ngIf="IsCreateAuditorVisible">
      <div class="contollerPopupContent">
        <div class="popup-title-btn-row">
          <div class="popup-header">
            <h3>
              Auditor Details For {{ selectedController?.OtherEntityName }}
            </h3>
          </div>
          <!-- Save and Cancel Buttons -->
          <button class="close-button" (click)="closecreateAuditor()">
            <i class="bi bi-x-circle close-icon"></i>
          </button>
        </div>
        <div class="error-messages">
          <!-- Auditor Name Error -->
          <p *ngIf="errorMessages['OtherEntityName']">
            {{ errorMessages['OtherEntityName'] }}
          </p>
          <!-- Auditor Type Error -->
          <p *ngIf="errorMessages['EntitySubTypeID']">
            {{ errorMessages['EntitySubTypeID'] }}
          </p>
          <p *ngIf="errorMessages['AssnDateFrom']">
            {{ errorMessages['AssnDateFrom'] }}
          </p>
          <p *ngIf="errorMessages['AssnDateTo']">
            {{ errorMessages['AssnDateTo'] }}
          </p>
        </div>
        <form>
          <div class="inputs-row">
            <div class="input-field">
              <label for="auditorName">
                Auditor Name <span style="color: red">*</span>
              </label>
              <select name="auditorName" id="auditorName" [(ngModel)]="selectedAuditor.OtherEntityID"
                (change)="onAuditorChange($event)">
                <option *ngFor="let name of firmAuditorName" [value]="name.OtherEntityID">
                  {{ name.OtherEntityName }}
                </option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="input-field" *ngIf="selectedAuditor.OtherEntityID === 'other'">
              <label for="customAuditorName">
                Custom Auditor Name <span style="color: red">*</span>
              </label>
              <input id="customAuditorName" name="customAuditorName" type="text"
                [(ngModel)]="selectedAuditor.customAuditorName" placeholder="Enter Custom Auditor Name" />
            </div>

            <div class="input-field">
              <label for="auditorType">
                Auditor Type <span style="color: red">*</span>
              </label>
              <select name="auditorType" id="auditorType" [(ngModel)]="selectedAuditor.EntitySubTypeID">
                <option *ngFor="let type of firmAuditorType" [value]="type.EntitySubTypeID">
                  {{ type.EntitySubTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="address2">
                Effective From Date <span style="color: red">*</span>
              </label>
              <input name="effectiveFromDate" [(ngModel)]="selectedAuditor.AssnDateFrom" id="effectiveFromDate"
                type="text" #dateInputs />
            </div>
            <div class="input-field">
              <label for="effectiveToDate"> Effective To Date </label>
              <input name="effectiveToDate" [(ngModel)]="selectedAuditor.AssnDateTo" id="effectiveToDate" type="text"
                #dateInputs />
            </div>
          </div>
          <div class="btn justify-content-end">
            <button (click)="saveCreateAuditor()">Save</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- contact section -->
  <section #contactsSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Contatcs ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="contacts-header">
          <h2 class="edit-firm-header">
            Contacts > <span>{{ firmDetails?.FirmName }}</span>
          </h2>
          <div class="btn">
            <button (click)="createContact()">
              <i class="bi bi-pen"></i>
              Create
            </button>
          </div>
          <span class="enhanced-checkbox">
            <input id="InactiveContacts" type="checkbox" (change)="onInactiveContactsToggle($event)" />
            <label for="InactiveContacts">Display Inactive Contacts</label>
          </span>
        </div>
        <table class="contacts-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Contact Type</th>
              <th>Contact Form</th>
              <th>Position/Job Title</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of filteredContacts" (click)="onRowClick(contact)">
              <td>{{ contact.FullName }}</td>
              <td>{{ contact.ContactTypeDesc }}</td>
              <td>{{ contact?.ContactMethodTypeDesc }}</td>
              <td>{{ contact.JobTitle }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Popup -->
    <div *ngIf="isPopupVisible" (click)="closeContactPopup()" class="contollerPopupOverlay">
      <div (click)="$event.stopPropagation()" class="contollerPopupContent">
        <!-- Title -->
        <div class="popup-title-btn-row">
          <div class="popup-header">
            <h3>
              Contact Details For {{ selectedContact.FirstName }}-{{
              selectedContact.FamilyName
              }}
            </h3>
          </div>
          <div class="btn">
            <button (click)="enableEditing()">
              <i class="bi bi-pen"></i> Edit
            </button>
            <button (click)="saveContactPopupChanges()">
              <i class="bi bi-save"></i> Save
            </button>
            <button (click)="confirmDelete()" type="button">
              <i class="bi bi-trash"></i> Delete
            </button>
            <button style="margin-left: 150px" (click)="closeContactPopup()">
              Close<i class="bi bi-x"></i>
            </button>
          </div>
        </div>

        <!-- Form -->
        <form>
          <!-- Contact Details Row 1 -->
          <div class="inputs-row">
            <div class="input-field">
              <label>Contact From</label>
              <input [(ngModel)]="selectedContact.ContactMethodTypeDesc" name="contactFrom" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Is contact an approved individual?</label>
              <input [(ngModel)]="selectedContact.IsIndividualRegulated" name="isApprovedIndividual"
                [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Contact Type</label>
              <input [(ngModel)]="selectedContact.ContactTypeDesc" name="contactType" [readonly]="!isEditable" />
            </div>
          </div>

          <!-- Contact Details Row 2 -->
          <div class="inputs-row">
            <div class="input-field">
              <label>First Name</label>
              <input [(ngModel)]="selectedContact.FirstName" name="firstName" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Second Name</label>
              <input [(ngModel)]="selectedContact.SecondName" name="secondName" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Family Name</label>
              <input [(ngModel)]="selectedContact.FamilyName" name="familyName" [readonly]="!isEditable" />
            </div>
          </div>

          <!-- Contact Details Row 3 -->
          <div class="inputs-row">
            <div class="input-field">
              <label>Mobile Phone</label>
              <input [(ngModel)]="selectedContact.MobileNum" name="mobilePhone" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Business Email</label>
              <input [(ngModel)]="selectedContact.BusEmail" name="businessEmail" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Business Phone</label>
              <input [(ngModel)]="selectedContact.BusPhone" name="businessPhone" [readonly]="!isEditable" />
            </div>
          </div>

          <!-- Addresses Section -->
          <h3>Addresses</h3>

          <!-- Address Details -->
          <div class="inputs-row">
            <div class="input-field">
              <label>Address Type</label>
              <input [(ngModel)]="selectedContact.addressType" name="addressType" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Address - Line 1</label>
              <input [(ngModel)]="selectedContact.addressLine1" name="addressLine1" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>Address - Line 2</label>
              <input [(ngModel)]="selectedContact.addressLine2" name="addressLine2" [readonly]="!isEditable" />
            </div>
          </div>

          <div class="inputs-row">
            <div class="input-field">
              <label>Address - Line 3</label>
              <input [(ngModel)]="selectedContact.addressLine3" name="addressLine3" [readonly]="!isEditable" />
            </div>

            <div class="input-field">
              <label>City</label>
              <input [(ngModel)]="selectedContact.city" name="city" [readonly]="!isEditable" />
            </div>
            <div class="input-field">
              <label>State/Province</label>
              <input [(ngModel)]="selectedContact.stateProvince" name="stateProvince" [readonly]="!isEditable" />
            </div>
          </div>
          <div class="input-row">
            <div class="input-field">
              <label>Country</label>
              <input [(ngModel)]="selectedContact.country" name="country" [readonly]="!isEditable" />
            </div>

            <div class="input-field">
              <label>Zip/Postal Code</label>
              <input [(ngModel)]="selectedContact.zipPostalCode" name="zipPostalCode" [readonly]="!isEditable" />
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!--End Firm details sub section-->

  <!--Start Individuals sub sections-->

  <!--Individuals Details-->
  <section #individualSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Individual ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Applied For</h2>
        <table>
          <thead>
            <tr>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Applied Date</th>
              <th>Function Status</th>
              <th>RSG Assessment Completion Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Approved Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Applied Date</th>
              <th>Conditionally Approved Date</th>
              <th>Conditional Approved Expiry Date</th>
              <th>Approved Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Applied Date</td>
              <td>Conditionally Approved Date</td>
              <td>Conditional Approved Expiry Date</td>
              <td>Approved Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Withdraw Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Previous Status</th>
              <th>Current Status</th>
              <th>Current Status Effective Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Form Type</td>
              <td>Previous Status</td>
              <td>Current Status</td>
              <td>Current Status Effective Date</td>
              <td>Request Status</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Individuals sub sections-->

  <!--Start Supervision sub sections-->

  <!--Section Supervision-->
  <!--add here the section-->
  <section #supervisionSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Supervision ? 'flex' : 'none'
    }"></section>
  <!--Supervision Reporting Schedule-->
  <section #reportingScheduleSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.ReportingSchedule ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Reporting Schedule For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Reporting Schedule From</th>
              <th>Reporting Schedule To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dates of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ dates?.RptPeriodFromDate }}</td>
              <td>{{ dates?.RptPeriodToDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Review-->
  <section #returnReviewSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.ReturnsReview ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="return-review-header">
          <h2>Return Review For</h2>
          <span>
            <label>Report Type : </label>
            <select name="reportType" id="reportType" class="SPReview-dropdown">
              <option>All</option>
            </select>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Ver</th>
              <th>Report</th>
              <th>Report Period Start Date</th>
              <th>Report Period End Date</th>
              <th>Received Date</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Ver</td>
              <td>Report</td>
              <td>Report Period Start Date</td>
              <td>Report Period End Date</td>
              <td>Received Date</td>
              <td>Review Status Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Notices-->
  <section #noticesSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Notices ? 'flex' : 'none'
    }">
    <div class="inputs-field-set" style="overflow-x: scroll">
      <div class="section">
        <h2>Notices And Responses -</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Notice Type</th>
              <th>Notice Name</th>
              <th>Internal Reference Number</th>
              <th>Notice Issuer</th>
              <th>Notice Issued Date</th>
              <th>Issuer's Reference Number</th>
              <th>Subject</th>
              <th>Notice Finalized Date</th>
              <th>Date Published on Website</th>
              <th>Notice Sent Date</th>
              <th>Response Due Date</th>
              <th>Response Provided Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let notice of FIRMNotices">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ notice?.TypeOfNotice }}</td>
              <td>{{ notice?.NoticeName }}</td>
              <td>{{ notice?.InternalReferenceNumber }}</td>
              <td>{{ notice?.NoticeIssuedBy }}</td>
              <td>{{ notice?.NoticeIssuedDate }}</td>
              <td>{{ notice?.IssuersReferenceNumber }}</td>
              <td>{{ notice?.Subject }}</td>
              <td>{{ notice?.NoticeFinalizedDate }}</td>
              <td>{{ notice?.DatePublishedonWebsite }}</td>
              <td>{{ notice?.NotificationSentDate }}</td>
              <td>{{ notice?.ResponseDueDate }}</td>
              <td>{{ notice?.ResponseProvidedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Admin Fee-->
  <section #adminFeeSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.LateAdminFee ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Admin Fees For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Report Name</th>
              <th>Report Due Date</th>
              <th>Materially Complete Report Receive Date</th>
              <th>Fee Calculated</th>
              <th>Fee Imposed</th>
              <th>Review Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fee of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ fee.RptName }}</td>
              <td>{{ fee.FirmRptDueDate }}</td>
              <td>{{ fee.FirstMateriallyCompleteRptReceivedDate }}</td>
              <td>{{ fee.CalculatedAmount }}</td>
              <td>{{ fee.ImposedAmount }}</td>
              <td>{{ fee.ObjectWFStatusTypeDesc }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision RMPs-->
  <section #rmpsSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.RMP ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>RMPs For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>RMP ID</th>
              <th>Date Created</th>
              <th>Type</th>
              <th>Date Firm Agreed</th>
              <th>Agreed By</th>
              <th>RMP Status</th>
              <th>Review Status</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rmp of FIRMRMP">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="rmp" />
                  <span></span>
                </label>
              </td>
              <td>{{ rmp?.FirmRMPID }}</td>
              <td>{{ rmp?.RMPCreatedDate }}</td>
              <td>{{ rmp?.FirmRMPTypeDesc }}</td>
              <td>{{ rmp?.DateFirmAgreedOn }}</td>
              <td>{{ rmp?.AgreedBy }}</td>
              <td>{{ rmp?.RMPStatus }}</td>
              <td>{{ rmp?.SignOffStatus }}</td>
              <td>{{ rmp?.SignOffDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Breaches-->
  <section #breachesSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Breach ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Breaches For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Breach Number</th>
              <th>Version</th>
              <th>Breach Type</th>
              <th>Breach Category</th>
              <th>Breach Level</th>
              <th>Date Of Breach</th>
              <th>Breach Status</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="breach" />
                  <span></span>
                </label>
              </td>
              <td>Breach Number</td>
              <td>Version</td>
              <td>Breach Type</td>
              <td>Breach Category</td>
              <td>Breach Level</td>
              <td>Date Of Breach</td>
              <td>Breach Status</td>
              <td>Last Updated By</td>
              <td>Last Updated Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Waivers-->
  <section #waiversSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Waiver ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Waiver And/Or Modification For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Waiver Number</th>
              <th>Version</th>
              <th>Waiver Type</th>
              <th>Subject</th>
              <th>Waiver Status</th>
              <th>Status Date</th>
              <th>Review Date</th>
              <th>Review Decision</th>
              <th>Expiration Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let waiver of FirmWaivers">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="waiver" />
                  <span></span>
                </label>
              </td>
              <td>{{ waiver?.WaiverNumber }}</td>
              <td>{{ waiver?.WaiverRevNum }}</td>
              <td>{{ waiver?.WaiverTypeDesc }}</td>
              <td>{{ waiver?.WaiverSubject }}</td>
              <td>{{ waiver?.WaiverStatusTypeDesc }}</td>
              <td>{{ waiver?.WaiverStatusDate }}</td>
              <td>{{ waiver?.ReviewMeetingDate }}</td>
              <td>{{ waiver?.WaiverDecisionTypeDesc }}</td>
              <td>{{ waiver?.WaiverExpirationDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision ENF Actions-->
  <section #enfActionSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.Enforcement ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="ENFAction-header">
          <h2>List Of Enforcement & Disciplinary Actions</h2>
          <span>
            <input id="deletedRecords" type="checkbox" />
            <label>Display Deleted Records</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Action</th>
              <th>Type Of Action</th>
              <th>Date Of Action</th>
              <th>Firm Name</th>
              <th>Approved Individual</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Action</td>
              <td>Type Of Action</td>
              <td>Date Of Action</td>
              <td>Firm Name</td>
              <td>Approved Individual</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Reg. Funds-->
  <section #regFundsSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.RegisteredFunds ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>List Of Registered Funds For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Fund Number</th>
              <th>Fund Name</th>
              <th>Type Of Fund</th>
              <th>Status</th>
              <th>Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fund of RegisteredFund">
              <td></td>
              <td>{{ fund.RegisteredFundNumber }}</td>
              <td>{{ fund.FundName }}</td>
              <td>{{ fund.RegisteredFundTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Journal-->
  <section #journalSection class="form-section" [ngStyle]="{
      width: dataWidth,
      display: activeTab === Page.SupervisionJournal ? 'flex' : 'none'
    }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="Journal-header">
          <h2>Journal Entries For</h2>
          <span>
            <input id="deletedEntries" type="checkbox" />
            <label>Display Deleted Entries</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Entry Type</th>
              <th>Title</th>
              <th>Entry Date</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Supervision sub sections-->
</div>

<!--Popups-->
<!--Financial Year End History-->
<div *ngIf="callFYear" class="overlay show"></div>
<div *ngIf="callFYear" class="popup-wrapper">
  <i class="bi bi-x-circle close-icon" (click)="closeFYearHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Financial Year End History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Year End</th>
          <th class="date-center">Financial Year Effective From</th>
          <th class="date-center">Financial Year Effective To</th>
          <th>Modified By</th>
          <th class="date-center">Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FR of firmFYearHistory">
          <td style="text-align: left">{{ FR?.FirmName }}</td>
          <td style="text-align: left">{{ FR?.FirmFinYearEndTypeDesc }}</td>
          <td class="date-center">{{ FR?.FirmFinYearEndEffectiveFrom }}</td>
          <td class="date-center">
            {{ firmDetails?.FirmFinYearEndEffectiveTo }}
          </td>
          <td style="text-align: left">{{ FR?.UserName }}</td>
          <td class="date-center">{{ FR?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeFYearHistory()">Close</button>
  </div>
</div>
<!--Inactive Users-->
<div *ngIf="callInactiveUsers" class="overlay show"></div>
<div *ngIf="callInactiveUsers" class="InactiveUsersPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeInactiveUsers()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Inactive Users</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Function / Role</th>
          <th>Name</th>
          <th class="date-center">Date From</th>
          <th class="date-center">Date To</th>
          <th>Reason For Change</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FYE of firmInactiveUsers">
          <td style="text-align: left">{{ FYE.FirmUserAssnTypeDesc }}</td>
          <td style="text-align: left">{{ FYE.Name }}</td>
          <td class="date-center">
            {{ FYE.FirmUserAssnDateFrom | date: 'dd/MMM/yyyy' }}
          </td>
          <td class="date-center">
            {{ FYE.FirmUserAssnDateTo | date: 'dd/MMM/yyyy' }}
          </td>
          <td>{{ FYE.FirmUserAssnReasonTypeDesc }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeInactiveUsers()">Close</button>
  </div>
</div>

<!--Accounting Standards-->
<div *ngIf="callAccStandard" class="overlay show"></div>
<div *ngIf="callAccStandard" class="accountingStandardsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeAccountingStandard()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Accounting Standards History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Standard</th>
          <th class="date-center">Financial Standard Effective From</th>
          <th class="date-center">Financial Standard Effective To</th>
          <th>Modified By</th>
          <th class="date-center">Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AS of firmAccountingStandardHistory">
          <td style="text-align: left">{{ AS?.FirmName }}</td>
          <td style="text-align: left">{{ AS?.FinAccStdTypeDesc }}</td>
          <td class="date-center">{{ AS?.FirmFinYearEndEffectiveFrom }}</td>
          <td class="date-center">
            {{ firmDetails?.FirmFinYearEndEffectiveTo }}
          </td>
          <td style="text-align: left">{{ AS?.UserName }}</td>
          <td class="date-center">{{ AS?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeAccountingStandard()">Close</button>
  </div>
</div>
<!--Previous Firm Name-->
<div *ngIf="callPrevFirmName" class="overlay show"></div>
<div *ngIf="callPrevFirmName" class="prevFirmNamePopUp">
  <i class="bi bi-x-circle close-icon" (click)="closePrevFirmName()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>File Name History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Prev. Firm Name</th>
          <th>Date Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let PRN of firmNamesHistory">
          <td style="text-align: left">{{ PRN?.PrevFirmName }}</td>
          <td>{{ PRN?.DateEffectiveTo }}</td>
          <td style="text-align: left">{{ PRN?.LastModifiedBy }}</td>
          <td>{{ PRN?.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closePrevFirmName()">Close</button>
  </div>
</div>
<!--Application Details-->
<div *ngIf="callAppDetails" class="overlay show"></div>
<div *ngIf="callAppDetails" class="ApplicationDetailsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeApplicationDetails()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Application Details History</h3>
    </div>
    <div class="app-detail-history-header">Licensed Status</div>
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th class="date-center">Status Date</th>
          <th>Last Modified By</th>
          <th class="date-center">Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let LicenseDetailsHistory of firmAppDetailsLicensed">
          <td style="text-align: left">
            {{ LicenseDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td class="date-center">
            {{ LicenseDetailsHistory.FirmApplStatusDate }}
          </td>
          <td>{{ LicenseDetailsHistory.LastModifiedByUser }}</td>
          <td class="date-center">
            {{ LicenseDetailsHistory.LastModifiedDate }}
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="firmDetails?.AuthorisationStatusTypeID > 0" style="margin-top: 25px" class="app-detail-history-header">
      Authorisation Status
    </div>
    <table *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
      <thead>
        <tr>
          <th>Status</th>
          <th class="date-center">Status Date</th>
          <th>Press Release</th>
          <th>Last Modified By</th>
          <th class="date-center">Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AuthDetailsHistory of firmAppDetailsAuthorization">
          <td style="text-align: left">
            {{ AuthDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td class="date-center">
            {{ AuthDetailsHistory.FirmApplStatusDate }}
          </td>
          <td>{{ firmDetails?.PressReleaseLink }}</td>
          <td>{{ AuthDetailsHistory.LastModifiedByUser }}</td>
          <td class="date-center">{{ AuthDetailsHistory.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeApplicationDetails()">Close</button>
  </div>
</div>
<!--Select Document PopUp-->
<div *ngIf="callUploadDoc" class="overlay show"></div>
<div *ngIf="callUploadDoc" class="selectDocumentPopUp">
  <button type="button" (click)="closeSelectDocument()">
    <i class="bi bi-x-circle close-icon"></i>
  </button>
  <i class="bi bi-x-circle close-icon" (click)="closeSelectDocument()"></i>
  <div class="popup-info-place upload-container">
    <div class="popup-header">
      <h3>Upload Document</h3>
    </div>
    <div class="upload-document-body">
      <p>Please browse and upload/attach document:</p>
      <input type="file" accept=".pdf" #fileInput (change)="onFileSelected($event)" />
    </div>
    <small style="color: red" *ngIf="fileError">{{ fileError }}</small>
  </div>
  <div class="popup-operations-place">
    <button style="margin-right: 5px" class="subbutton" (click)="confirmUpload()">
      Ok
    </button>
    <button class="subbutton" (click)="closeSelectDocument()">Close</button>
  </div>
</div>
<!--Address Type History-->
<div *ngIf="callAddressType" class="overlay show"></div>
<div *ngIf="callAddressType" class="addressHistoryPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeAddressTypeHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Address History</h3>
    </div>
    <br />
    <div class="address-type-info">
      <span style="text-decoration: underline">{{
        firmAddressesTypeHistory[0]?.AddressTypeDesc
        }}</span>
      &nbsp; (<span style="color: red">history includes the deleted record for this address type.</span>)
    </div>
    <table>
      <thead>
        <tr>
          <th>Address</th>
          <th class="date-center">Created Date</th>
          <th class="date-center">Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let addressHistory of firmAddressesTypeHistory">
          <td>{{ addressHistory?.ShortAddress }}</td>
          <td class="date-center">{{ addressHistory?.CreatedDate }}</td>
          <td class="date-center">
            {{ addressHistory?.LastModifiedDate }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeAddressTypeHistory()">Close</button>
  </div>
</div>

<!--Scope Previous Versions for License popup-->
<div *ngIf="callLicScopePrev" class="overlay show"></div>
<div *ngIf="callLicScopePrev" class="ScopeLicPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon close-icon-prev-revisions" (click)="closeLicScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for License Scope</h3>
  </div>

  <div style="width: 80%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of LicPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId, 2, rev.ScopeRevNum)">
          {{ rev.ScopeRevNum }}
        </button>
      </li>
    </ul>
  </div>
</div>

<!--Scope Previous Versions for Authorize popup-->
<div *ngIf="callAuthScopePrev" class="overlay show"></div>
<div *ngIf="callAuthScopePrev" class="ScopeAuthPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon close-icon-prev-revisions" (click)="closeAuthScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for Authorize Scope</h3>
  </div>

  <div style="width: 80%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of AuthPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId, 3, rev.ScopeRevNum)">
          {{ rev.ScopeRevNum }}
        </button>
      </li>
    </ul>
  </div>
</div>