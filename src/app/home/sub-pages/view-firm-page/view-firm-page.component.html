<div class="brid-crump">
  <div class="text"><span> Home ></span> Firm Details</div>
</div>
<div class="page">
  <div class="menu" [ngStyle]="{ width: menuWidth }">
    <!-- <button (click)="toggleFulMenu()" class="menu-item menu-item-btn-ce"> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width1)" class="menu-icons bi bi-arrow-left-square-fill"></i>
    <!-- <p *ngIf="menuWidth.match('20%')">Close Menu</p> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-arrow-right-square-fill"></i>
    <!-- </button> -->
    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="1-item" (click)="toggleMenu(1)" [ngClass]="{ active: menuId === 1 }"
        (click)="switchTab('main')">
        FIRM Details
      </h3>
      <i *ngIf="menuWidth.match(width2)" (click)="toggleMenu(1)" class="menu-icons bi bi-info-square"></i>
      <div class="sub-menu" *ngIf="menuId === 1 && menuWidth.match(width1)">
        <a (click)="switchTab('CD')" class="menu-sub-item" [ngClass]="{ active: activeTab === 'CD' }">
          Core Details
        </a>
        <a (click)="switchTab('Scope')" class="menu-sub-item" [ngClass]="{ active: activeTab === 'Scope' }">
          Scope
        </a>
        <a (click)="switchTab('Controllers')" class="menu-sub-item" [ngClass]="{ active: activeTab === 'Controllers' }">
          Controllers
        </a>
        <a (click)="switchTab('Auditors')" class="menu-sub-item" [ngClass]="{ active: activeTab === 'Auditors' }">
          Auditors
        </a>
        <a (click)="switchTab('Contacts')" class="menu-sub-item" [ngClass]="{ active: activeTab === 'Contacts' }">
          Contacts
        </a>
      </div>
    </div>
    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(2)" [ngClass]="{ active: menuId === 2 }">
        Individuals
      </h3>
      <i *ngIf="menuWidth.match(width2)" (click)="toggleMenu(2)" class="menu-icons bi bi-people"></i>
      <div class="sub-menu" *ngIf="menuId === 2 && menuWidth.match(width1)">
        <a (click)="switchTab('INDDetails')" class="menu-sub-item">
          Individual Details
        </a>
      </div>
    </div>
    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(3)" [ngClass]="{ active: menuId === 3 }">
        Supervision
      </h3>
      <i *ngIf="menuWidth.match(width2)" (click)="toggleMenu(3)" class="menu-icons bi bi-kanban"></i>
      <div class="sub-menu" *ngIf="menuId === 3 && menuWidth.match(width1)">
        <a (click)="switchTab('SPRS')" class="menu-sub-item">
          Reporting Schedule
        </a>
        <a (click)="switchTab('SPReview')" class="menu-sub-item">
          Return Review
        </a>
        <a (click)="switchTab('SPNotices')" class="menu-sub-item"> Notices </a>
        <a (click)="switchTab('SPAdminFee')" class="menu-sub-item">
          Admin Fee
        </a>
        <a (click)="switchTab('SPRMPs')" class="menu-sub-item"> RMPs </a>
        <a (click)="switchTab('SPBreaches')" class="menu-sub-item">
          Breaches
        </a>
        <a (click)="switchTab('SPWaivers')" class="menu-sub-item"> Waivers </a>
        <a (click)="switchTab('SPENFAction')" class="menu-sub-item">
          Enf. Actions
        </a>
        <a (click)="switchTab('SPRegFunds')" class="menu-sub-item">
          Reg. Funds
        </a>
        <a (click)="switchTab('SPJournal')" class="menu-sub-item"> Journal </a>
      </div>
    </div>
  </div>

  <section id="main" class="edit-firm-section" [ngStyle]="{ width: dataWidth }">
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">
          FIRM Details > <span>{{ firmDetails?.FirmName }}</span>
        </h2>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="QFCNumber"> QFC Number </label>
          <input disabled name="QFCNumber" id="QFCNumber" type="text" value="{{ firmDetails?.QFCNum }}" />
        </div>
        <div class="input-field">
          <label for="code"> Code </label>
          <input disabled name="code" id="code" type="text" value="{{ firmDetails?.FirmCode }}" />
        </div>
        <div class="input-field">
          <label for="lagalStatus"> Legal Status </label>
          <input disabled name="lagalStatus" id="lagalStatus" type="text"
            value="{{ firmDetails?.LegalStatusTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="PrudentialCategory"> Prudential Category </label>
          <input disabled name="PrudentialCategory" id="PrudentialCategory" type="text"
            value="{{ firmDetails?.PrudentialCategoryTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="FinancialYearEnd"> Financial Year End </label>
          <input disabled name="financialYearEnd" id="financialYearEnd" type="text"
            value="{{ firmDetails?.FinYearEndTypeDesc }}" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">Application Details</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="dateOfApplication"> Date of Application </label>
          <input disabled name="dateOfApplication" id="dateOfApplication" type="text" value="{{
              firmDetails?.AuthorisationStatusTypeID == 0
                ? (firmDetails?.FirmLicApplDate | date : 'dd/MMM/y')
                : (firmDetails?.FirmAuthApplDate | date : 'dd/MMM/y')
            }}" />
        </div>

        <div class="input-field">
          <label for="firmApplicationType"> Firm Application Type </label>
          <input type="text" disabled name="firmApplicationType" id="firmApplicationType"
            value="{{ appDetails.FirmApplTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="qfcLicenseStatus"> QFC License Status </label>
          <input disabled type="text" name="qfcLicenseStatus" id="qfcLicenseStatus"
            value="{{ firmDetails?.LicenseStatusTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="DateLicensed">
            {{ firmDetails?.LicenseStatusTypeLabelDesc }}
          </label>
          <input disabled name="DateLicensed" id="DateLicensed" type="text"
            value="{{ firmDetails?.LicenseApplStatusDate | date : 'dd/MMM/y' }}" />
        </div>

        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="authorisationStatus"> Authorisation Status </label>
          <input type="text" disabled name="authorisationStatus" id="authorisationStatus"
            value="{{ firmDetails?.AuthorisationStatusTypeDesc }}" />
        </div>
        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="dateApplication">
            {{ firmDetails?.AuthorisationStatusTypeLabelDesc }}
          </label>
          <input disabled name="dateApplication" id="dateApplication" type="text"
            value="{{ firmDetails?.AuthApplStatusDate | date : 'dd/MMM/y' }}" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">Operational Information</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="noOfStaffInQatar"> No. Of Staff In Qatar </label>
          <input disabled name="noOfStaffInQatar" id="noOfStaffInQatar" type="text"
            value="{{ firmOPDetails?.NumOfLocalStaff }}" />
        </div>

        <div class="input-field">
          <label for="staffTotal"> Staff total </label>
          <input disabled name="staffTotal" id="staffTotal" type="text" value="{{ firmOPDetails?.NumOfTotalStaff }}" />
        </div>

        <div class="input-field notes">
          <label for="notes"> Notes : </label>
          <textarea disabled name="notes" id="notes">{{
            getCleanedNotes(firmOPDetails?.Notes)
          }}</textarea>
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="section">
        <h2>
          RA Personal Assigned
          <button class="subbutton" (click)="getInactiveUsers()">
            Open History
          </button>
        </h2>
        <table>
          <thead>
            <tr>
              <th>Function / Role</th>
              <th>Name</th>
              <th>Date From</th>
              <th>Date To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let RA of FIRMRA">
              <td style="text-align: left">{{ RA.FirmUserAssnTypeDesc }}</td>
              <td style="text-align: left">{{ RA.Name }}</td>
              <td>{{ RA.FirmUserAssnDateFrom | date : "dd/MMM/yyyy" }}</td>
              <td>{{ RA.FirmUserAssnDateTo | date : "dd/MMM/yyyy" }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Start Firm details sub section-->

  <!--Core Details-->
  <section id="CD" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['firmDetailsSection'] }">
      <!--Error messages-->
      <div class="error-messages" style="color: red">
        <p *ngIf="showError && !firmDetails.FirmName">Please specify a valid entry for the "Firm Name" field.
        </p>
        <p *ngIf="showError && firmDetails.LegalStatusTypeID == 0">Please select a value for the "Legal Status"
          field.</p>
        <p *ngIf="showError && firmDetails.DateOfIncorporation == null || firmDetails.DateOfIncorporation == ''">Please
          specify a valid date for the
          "Incorporation Date" field.</p>
      </div>
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">
          FIRM Details
          <button [ngClass]="{ 'hidden-button': allowEditFirmDetails }" class="collapse-button"
            (click)="toggleCollapse('firmDetailsSection')">
            {{ isCollapsed["firmDetailsSection"] ? "▲" : "▼" }}
          </button>
        </h2>

        <div style="display: flex; gap: 10px">
          <div class="btn">
            <button (click)="editFirm()">
              <i [class]="allowEditFirmDetails ? 'bi bi-pen' : ''"></i>
              {{ allowEditFirmDetails ? "Edit" : "Save" }}
            </button>
          </div>

          <div class="btn">
            <button class="cancel-btn" *ngIf="!allowEditFirmDetails" (click)="cancelEditFirm()">
              Cancel
            </button>
          </div>
        </div>
      </div>

      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="firmName"> Firm Name
            <span [hidden]="allowEditFirmDetails" style="color: red">*</span>
          </label>
          <input [disabled]="allowEditFirmDetails" name="firmName" id="firmName" type="text"
            [(ngModel)]="firmDetails.FirmName" [ngClass]="{ 'error-border': showError && !firmDetails.FirmName }" />
        </div>

        <div class="input-field">
          <label for="qfcNumber"> QFC Number </label>
          <input [disabled]="allowEditFirmDetails" name="qfcNumber" id="qfcNumber" type="text"
            [(ngModel)]="firmDetails.QFCNum" />
        </div>

        <div class="input-field">
          <label for="code"> Code </label>
          <input [disabled]="allowEditFirmDetails" name="code" id="code" type="text"
            [(ngModel)]="firmDetails.FirmCode" />
        </div>

        <div class="input-field">
          <label for="legalStatus">
            Legal Status
            <span [hidden]="allowEditFirmDetails" style="color: red">*</span>
          </label>
          <select
            [ngClass]="{ 'select-background-edited': !allowEditFirmDetails, 'error-border': showError && firmDetails.LegalStatusTypeID == 0 }"
            [disabled]="allowEditFirmDetails" id="legalStatus" (ngModelChange)="onLegalStatusChange($event)"
            [(ngModel)]="firmDetails.LegalStatusTypeID">
            <option value="0">Select</option>
            <option *ngFor="let option of allLegalStatus" [value]="option.LegalStatusTypeID">
              {{ option.LegalStatusTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="qfcTradingName"> QFC Trading Name </label>
          <input [disabled]="allowEditFirmDetails" name="qfcTradingName" id="qfcTradingName" type="text"
            [(ngModel)]="firmDetails.QFCTradingName" />
        </div>

        <div class="input-field">
          <label for="prevTradingNames"> Prev. Trading Name(s) </label>
          <input [disabled]="allowEditFirmDetails" name="prevTradingNames" id="prevTradingNames" type="text"
            [(ngModel)]="firmDetails.PrevTradingName" />
        </div>

        <div class="input-field">
          <label for="placeOfIncorporation"> Place of Incorporation </label>
          <input [disabled]="allowEditFirmDetails" name="placeOfIncorporation" id="placeOfIncorporation" type="text"
            [(ngModel)]="firmDetails.PlaceOfIncorporation" />
        </div>

        <div class="input-field">
          <label for="homeCountry"> Home Country </label>
          <select [ngClass]="{ 'select-background-edited': !allowEditFirmDetails }" [disabled]="allowEditFirmDetails"
            id="homeCountry" [(ngModel)]="firmDetails.CountyOfIncorporation">
            <option *ngFor="let option of allCountries" [value]="option.CountryID">
              {{ option?.CountryName }}
            </option>
          </select>
        </div>

        <div class="input-field" [hidden]="allowEditFirmDetails">
          <label for="isDateDifferent">
            Is Date of Incorporation different from Date of Licensing or
            Authorisation : <span style="color: red">*</span>
          </label>
          <div class="radio-wrapper">
            <input name="isIncorporationDateDifferent" id="yes" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="true" />
            Yes
            <input name="isIncorporationDateDifferent" id="no" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="false" />
            No
          </div>
        </div>

        <ng-container *ngIf="firmDetails.DifferentIncorporationDate || allowEditFirmDetails">
          <div class="input-field">
            <label for="incorporationDate"> Incorporation Date </label>
            <input [ngClass]="{ 'error-border': showError && !firmDetails.DateOfIncorporation }"
              [disabled]="allowEditFirmDetails" name="incorporationDate" id="incorporationDate" type="text" #dateInputs
              [(ngModel)]="firmDetails.DateOfIncorporation" />
          </div>
        </ng-container>

        <div class="input-field">
          <label for="financialYearEnd">
            Financial Year End
            <button *ngIf="firmDetails?.FinYearEndTypeDesc" class="subbutton" (click)="getFYearHistory()">
              History
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': !allowEditFirmDetails }" [disabled]="allowEditFirmDetails"
            id="financialYearEnd" [(ngModel)]="firmDetails.FinYearEndTypeID">
            <option *ngFor="let option of allFinYearEnd" [value]="option.FirmFinYearEndTypeID">
              {{ option.FirmFinYearEndTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="financialYearEndEffectiveFrom">
            Financial Year End Effective From
          </label>
          <input [disabled]="allowEditFirmDetails" name="financialYearEndEffectiveFrom" type="text" #dateInputs
            id="financialYearEndEffectiveFrom" [(ngModel)]="firmDetails.FirmFinYearEndEffectiveFrom" />
        </div>

        <div class="input-field">
          <label for="accountingStandards">
            Accounting Standards
            <button *ngIf="firmDetails?.FinAccStdTypeDesc" class="subbutton" (click)="getAccountingStandardHistory()">
              History
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': !allowEditFirmDetails }" [disabled]="allowEditFirmDetails"
            id="accountingStandards" [(ngModel)]="firmDetails.FinAccStdTypeID">
            <option *ngFor="let option of allFinAccStd" [value]="option.FinAccStdTypeID">
              {{ option.FinAccStdTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="accountingStandardsEffectiveFrom">
            Accounting Standards Effective From
          </label>
          <input [disabled]="allowEditFirmDetails" name="accountingStandardsEffectiveFrom"
            id="accountingStandardsEffectiveFrom" type="text" #dateInputs
            [(ngModel)]="firmDetails.FinAccStdTypeEffectiveFrom" />
        </div>

        <div class="input-field">
          <label for="websiteLink"> Website Link </label>

          <input *ngIf="!allowEditFirmDetails" type="text" value="" [(ngModel)]="firmDetails.WebSiteAddress"
            id="websiteLink" />

          <a *ngIf="allowEditFirmDetails" id="websiteLink" [href]="firmDetails?.WebSiteAddress" target="_blank"
            rel="noopener noreferrer">
            {{ firmDetails?.WebSiteAddress}}
          </a>
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmName">
            Prev. Firm Name <button class="subbutton" (click)="getPrevFirmName()">History</button>
          </label>
          <input [disabled]="allowEditFirmDetails" name="prevFirmName" id="prevFirmName" type="text"
            [(ngModel)]="firmNamesHistory[0].PrevFirmName">
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmNameEffectiveTo">
            Prev. Firm Name Effective To
          </label>
          <input [disabled]="allowEditFirmDetails" name="prevFirmNameEffectiveTo" id="prevFirmNameEffectiveTo"
            type="text" #dateInputs [(ngModel)]="firmNamesHistory[0].DateEffectiveTo">
        </div>
      </div>

    </div>
    <!---->
    <div class="inputs-field-set" [ngClass]="{collapsed: isCollapsed['appDetailsSection']}">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">
          Application Details <button class="subbutton" (click)="getApplicationDetailsHistory()">Open
            History</button>
          <button [ngClass]="{'hidden-button': allowEditFirmDetails}" class="collapse-button"
            (click)="toggleCollapse('appDetailsSection')">
            {{ isCollapsed['appDetailsSection'] ? '▲' : '▼'}}
          </button>
        </h2>
      </div>
      <div class="edit-firms-inputs" *ngIf="allowEditFirmDetails">
        <h3 class="subTitle-firmDetails">License Status</h3>
        <div class="input-field">
          <label for="appliedOn">
            Applied On
          </label>
          <input disabled name="appliedOn" id="appliedOn" type="text"
            value="{{firmAppDetailsCurrentLicensed?.AppliedOn | date: 'dd/MMM/y'}}">
        </div>

        <div class="input-field">
          <label for="licensedOn">
            Licensed On
          </label>
          <input type="text" disabled name="licensedOn" id="licensedOn"
            value="{{firmAppDetailsCurrentLicensed?.GrantedOn | date: 'dd/MMM/y'}}">

        </div>
        <div class="input-field">
          <label for="currentStatus">
            Current Status
          </label>
          <input disabled name="currentStatus" id="currentStatus" type="text"
            value="{{firmAppDetailsCurrentLicensed?.RecentStatus}}">
        </div>

        <div class="input-field">
          <label for="currentStatusEffectiveDate">
            Current Status Effective Date
          </label>
          <input disabled name="currentStatusEffectiveDate" id="currentStatusEffectiveDate" type="text"
            value="{{firmAppDetailsCurrentLicensed?.RecentStatusDate | date: 'dd/MMM/y'}}">
        </div>

        <div class="input-field">
          <label for="lastModifiedBy">
            Last Modified By
          </label>
          <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
            value="{{firmAppDetailsCurrentLicensed?.LastModifiedBy}}">
        </div>

        <div class="input-field">
          <label for="lastModifiedDate">
            Last Modified Date
          </label>
          <input disabled name="lastModifiedDate" id="lastModifiedDate" type="text"
            value="{{firmAppDetailsCurrentLicensed?.LastModifiedDate}}">
        </div>

        <ng-container *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <h3 class="subTitle-firmDetails">Authorisation Status</h3>
          <div class="input-field">
            <label for="appliedOnAuth">
              Applied On
            </label>
            <input disabled name="appliedOnAuth" id="appliedOnAuth" type="text"
              value="{{firmAppDetailsCurrentAuthorized?.AppliedOn | date: 'dd/MMM/y'}}">
          </div>

          <div class="input-field">
            <label for="AuthorizedOnAuth">
              Authorised On
            </label>
            <input type="text" disabled name="AuthorizedOnAuth" id="AuthorizedOnAuth"
              value="{{firmAppDetailsCurrentAuthorized?.GrantedOn | date: 'dd/MMM/y'}}">

          </div>
          <div class="input-field">
            <label for="currentStatusAuth">
              Current Status
            </label>
            <input disabled name="currentStatusAuth" id="currentStatusAuth" type="text"
              value="{{firmAppDetailsCurrentAuthorized?.RecentStatus}}">
          </div>

          <div class="input-field">
            <label for="currentStatusEffectiveDateAuth">
              Current Status Effective Date
            </label>
            <input disabled name="currentStatusEffectiveDateAuth" id="currentStatusEffectiveDateAuth" type="text"
              value="{{firmAppDetailsCurrentAuthorized?.RecentStatusDate | date: 'dd/MMM/y'}}">
          </div>

          <div class="input-field">
            <label for="lastModifiedByAuth">
              Last Modified By
            </label>
            <input disabled name="lastModifiedByAuth" id="lastModifiedByAuth" type="text"
              value="{{firmAppDetailsCurrentAuthorized?.LastModifiedBy}}">
          </div>

          <div class="input-field">
            <label for="lastModifiedDateAuth">
              Last Modified Date
            </label>
            <input disabled name="lastModifiedDateAuth" id="lastModifiedDateAuth" type="text"
              value="{{firmAppDetailsCurrentAuthorized?.LastModifiedDate}}">
          </div>

        </ng-container>
      </div>
      <!--or (edit mode)-->
      <div class="edit-firms-inputs" *ngIf="!allowEditFirmDetails">
        <div class="input-field">
          <label for="dateOfApplication">
            Date of Application
          </label>
          <input name="dateOfApplication" id="dateOfApplication" type="text" #dateInputs
            [(ngModel)]="dateOfApplication">
        </div>
        <div class="input-field">
          <label for="firmApplicationType">
            Firm Application Type
          </label>
          <select [ngClass]="{'select-background-edited': !allowEditFirmDetails}" name="firmApplicationType"
            id="firmApplicationType" [(ngModel)]="selectedFirmTypeID"
            (ngModelChange)="onFirmApplicationTypeChange($event)">
            <option *ngFor="let firmType of allFirmTypes" [value]="firmType.FirmApplTypeID">
              {{firmType.FirmApplTypeDesc}}</option>
          </select>
        </div>
        <div class="input-field">
          <label for="qfcLicenseStatus">
            QFC License Status
          </label>
          <select [ngClass]="{'select-background-edited': !allowEditFirmDetails}" name="qfcLicenseStatus"
            id="qfcLicenseStatus" [(ngModel)]="firmDetails.LicenseStatusTypeID"
            (ngModelChange)="onLicenseStatusChange($event)">
            <option *ngFor="let option of allQFCLicenseStatus" [value]="option.FirmApplStatusTypeID">{{
              option.FirmApplStatusTypeDesc }}
            </option>
          </select>
        </div>
        <div class="input-field">
          <label for="DateLicensed">
            {{firmDetails?.LicenseStatusTypeLabelDesc}}
          </label>
          <input name="DateLicensed" id="DateLicensed" type="text" #dateInputs [(ngModel)]="firmDetails.LicensedDate">
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="authorisationStatus">
            Authorisation Status
          </label>
          <select [ngClass]="{'select-background-edited': !allowEditFirmDetails}" name="authorisationStatus"
            id="authorisationStatus" [(ngModel)]="firmDetails.AuthorisationStatusTypeID"
            (ngModelChange)="onAuthorizedStatusChange($event)">
            <option *ngFor="let option of allAuthorisationStatus" [value]="option.FirmApplStatusTypeID">{{
              option.FirmApplStatusTypeDesc}}</option>
          </select>
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="dateAuthorized">
            {{firmDetails?.AuthorisationStatusTypeLabelDesc}}
          </label>
          <input name="dateAuthorized" id="dateAuthorized" type="text" #dateInputs
            [(ngModel)]="firmDetails.AuthorisationDate">
        </div>
      </div>

    </div>
    <!---->
    <div class="inputs-field-set" *ngIf="!allowEditFirmDetails && selectedFirmTypeID == 3"
      [ngClass]="{collapsed: isCollapsed['pressReleaseSection']}">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">Press Releases</h2>
        <button [ngClass]="{'hidden-button': allowEditFirmDetails}" class="collapse-button"
          (click)="toggleCollapse('pressReleaseSection')">
          {{ isCollapsed['pressReleaseSection'] ? '▲' : '▼'}}
        </button>
      </div>
      <div class="edit-firms-inputs">
        <div class="file-container">
          <div class="input-field">
            <label for="documentType">
              Document Type
            </label>
            <select [disabled]="allowEditFirmDetails" [ngClass]="{'select-background-edited': !allowEditFirmDetails}"
              class="document-type-select" name="documentType" id="documentType">
              <option value="263">Press Releases</option>
            </select>
          </div>

          <div id="uploaded-documents">Uploaded documents go here</div>

          <div class="btns-container">
            <div class="upload-container">
              <button class="choose-document-btn" (click)="uploadDocument()">
                Choose Document
              </button>
            </div>
            <button class="upload-document-btn">Upload the Document</button>
          </div>
        </div>
        <div class="file-table-container">
          <table>
            <thead>
              <tr>
                <th>Document Type</th>
                <th>File Name</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Attachment</td>
                <td></td>
                <td><button class="delete-file">Delete</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set comments" [ngClass]="{ collapsed: isCollapsed['commentsSection'] }">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">Comments</h2>
        <button [ngClass]="{ 'hidden-button': allowEditFirmDetails }" class="collapse-button"
          (click)="toggleCollapse('commentsSection')">
          {{ isCollapsed["commentsSection"] ? "▲" : "▼" }}
        </button>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="generalComments">
            <strong>General Comments:</strong>
          </label>
          <textarea [disabled]="allowEditFirmDetails" name="generalComments" id="generalComments"
            [(ngModel)]="firmDetails.FirmApplicationDataComments"></textarea>
        </div>
        <div class="input-field">
          <label for="publicRegisterComments">
            <strong>Public Register Comments:</strong>
          </label>
          <textarea [disabled]="allowEditFirmDetails" name="publicRegisterComments" id="publicRegisterComments"
            [(ngModel)]="firmDetails.PublicRegisterComments"></textarea>
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set" [ngClass]="{collapsed: isCollapsed['addressesSection']}">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">
          Addresses
        </h2>
        <button class="collapse-button" (click)="toggleCollapse('addressesSection')">
          {{ isCollapsed['addressesSection'] ? '▲' : '▼'}}
        </button>
      </div>
      <div class="add-address-container">
        <button *ngIf="!allowEditFirmDetails" (click)="addNewAddress()"
          [hidden]="isCollapsed['addressesSection']" class="addAddressBtn">Add Address</button>
      </div>
      <div class="edit-firms-inputs">
        <ng-container *ngFor="let address of firmAddresses; let i = index">
          <ng-container *ngIf="address.Valid === true">
            <div class="input-field" *ngIf="allowEditFirmDetails">
              <label for="addressType">
                Address Type <button *ngIf="address.PreviousRecords !== 0" class="subbutton"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">History</button>
              </label>
              <input disabled name="addressType" id="addressType" type="text" value="{{address?.AddressTypeDesc}}">
            </div>
            <div *ngIf="!allowEditFirmDetails" class="del-address-container">
              <button (click)="removeAddress(i)" class="RmvAddressBtn">x</button>
            </div>
            <!-- address type on edit mode -->
            <div class="input-field" *ngIf="!allowEditFirmDetails">
              <label for="addressType">
                Address Type <button *ngIf="address.PreviousRecords !== 0 && !address.isNew" class="subbutton"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">History</button>
              </label>
              <select [disabled]="!address.isNew" [(ngModel)]="address.AddressTypeID"
                [ngClass]="{'select-background-edited': !allowEditFirmDetails}">
                <option value="0">Select</option>
                <option *ngFor="let option of allAddressTypes" [value]="option.AddressTypeID">
                  {{option.AddressTypeDesc}}</option>
              </select>
            </div>

            <!-- <div class="input-field" *ngIf="!allowEditFirmDetails && address.isNew">
                            <label for="sameAsType">
                                Same As Type
                            </label>
                            <select name="sameAsType" id="sameAsType"
                                [ngClass]="{'select-background-edited': !allowEditFirmDetails}">
                                <option value="0">select</option>
                                <option *ngFor="let type of existingAddressTypes" [value]="type.AddressTypeID">
                                    {{type.AddressTypeDesc}}</option>
                            </select>
            </div> -->
            <div class="input-field">
              <label for="addressLine1"> Address Line 1 </label>
              <input type="text" [disabled]="allowEditFirmDetails" name="addressLine1" id="addressLine1"
                [(ngModel)]="address.AddressLine1" />
            </div>
            <div class="input-field">
              <label for="addressLine2"> Address Line 2 </label>
              <input [disabled]="allowEditFirmDetails" name="addressLine2" id="addressLine2" type="text"
                [(ngModel)]="address.AddressLine2" />
            </div>
            <div class="input-field">
              <label for="addressLine3"> Address Line 3 </label>
              <input [disabled]="allowEditFirmDetails" name="addressLine3" id="addressLine3" type="text"
                [(ngModel)]="address.AddressLine3" />
            </div>
            <div class="input-field">
              <label for="addressLine4"> Address Line 4 </label>
              <input [disabled]="allowEditFirmDetails" name="addressLine4" id="addressLine4" type="text"
                [(ngModel)]="address.AddressLine4" />
            </div>
            <div class="input-field">
              <label for="city"> City </label>
              <input [disabled]="allowEditFirmDetails" name="city" id="city" type="text" [(ngModel)]="address.City" />
            </div>
            <div class="input-field">
              <label for="state"> state/province </label>
              <input [disabled]="allowEditFirmDetails" name="state" id="state" type="text"
                [(ngModel)]="address.Province" />
            </div>
            <div class="input-field" *ngIf="allowEditFirmDetails">
              <label for="country"> Country </label>
              <input type="text" disabled name="country" id="country" [(ngModel)]="address.CountryName" />
            </div>
            <!-- countries on edit mode-->
            <div class="input-field" *ngIf="!allowEditFirmDetails">
              <label for="country"> Country </label>
              <select [(ngModel)]="address.CountryID" [ngClass]="{
                  'select-background-edited': !allowEditFirmDetails
                }">
                <option *ngFor="let option of allCountries" [value]="option.CountryID">
                  {{ option?.CountryName }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="zip"> Zip/Postal Code </label>
              <input [disabled]="allowEditFirmDetails" name="zip" id="zip" type="text"
                [(ngModel)]="address.PostalCode" />
            </div>
            <div class="input-field">
              <label for="phone"> Phone </label>
              <input [disabled]="allowEditFirmDetails" name="phone" id="phone" type="text"
                [(ngModel)]="address.PhoneNum" />
            </div>
            <div class="input-field">
              <label for="fax"> Fax </label>
              <input [disabled]="allowEditFirmDetails" name="fax" id="fax" type="text" [(ngModel)]="address.FaxNum" />
            </div>
            <hr *ngIf="i < firmAddresses.length - 1" />
          </ng-container>
        </ng-container>
      </div>
    </div>
  </section>

  <!--Scope Section-->
  <section id="Scope" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="licensed-section">
      <div class="licensed-header" (click)="toggleCollapse('LicensedSection')">
        Licensed
        <span class="arrow" [ngClass]="{
            down: !isCollapsed['LicensedSection'],
            up: isCollapsed['LicensedSection']
          }">{{ isCollapsed["LicensedSection"] ? "▲" : "▼" }}</span>
      </div>
      <div class="licensed-body" [ngClass]="{
          collapsed:
            isCollapsed['LicensedSection'] &&
            firmDetails?.AuthorisationStatusTypeID > 0
        }">
        <div class="inputs-field-set scopeFor">
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">
              <small>Scope for</small> {{ firmDetails?.FirmName }}
            </h2>
            <div *ngIf="currentLicRevisionNumber === lastLicRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn">
                <button (click)="editLicenseScope()">
                  <i [class]="allowEditLicScopeDetails ? 'bi bi-pen' : ''"></i>
                  {{ allowEditLicScopeDetails ? "Edit" : "Save" }}
                </button>
              </div>

              <div class="btn">
                <button class="cancel-btn" *ngIf="!allowEditLicScopeDetails" (click)="cancelEditLicScope()">
                  Cancel
                </button>
              </div>
            </div>
          </div>
          <div class="edit-firms-inputs">
            <div style="width: 100%" class="input-field">
              <label for="formReff"> Form Reference </label>
              <!-- <input [disabled]="allowEditLicScopeDetails" [ngModel]="documentDetails.FileName"
                                name="formReff" id="formReff" type="text" value="" /> -->
              <a *ngIf="allowEditLicScopeDetails" id="websiteLink"
                href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{documentDetails.Column3}}" target="_blank"
                rel="noopener noreferrer">
                {{documentDetails?.FileName}}
              </a>
            </div>
            <div style="width:100%" class="input-field">
              <label for="linkScope"> Link To Scope </label>
              <input *ngIf="!allowEditLicScopeDetails" name="linkScope" id="linkScope" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeCertificateLink" />
              <a *ngIf="allowEditLicScopeDetails" id="websiteLink" [href]="ActivityLicensed[0].ScopeCertificateLink"
                target="_blank" rel="noopener noreferrer">
                {{ ActivityLicensed[0]?.ScopeCertificateLink}}
              </a>
            </div>
            <div class="input-field">
              <label for="scopeRevNum"> Scope Revision Number </label>
              <input disabled name="scopeRevNum" id="scopeRevNum" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeRevNum" />
            </div>
            <div class="input-field">
              <label for="q13AppDate" *ngIf="ActivityLicensed[0]?.ScopeRevNum > 1">
                Q13 Application Date for revisions
              </label>
              <label *ngIf="ActivityLicensed[0]?.ScopeRevNum == 1">Application Date</label>
              <input [disabled]="allowEditLicScopeDetails" name="appDate" id="appDate" #dateInputs type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeAppliedDate" />
            </div>
            <div class="input-field">
              <label for="licenseDate"> License Date </label>
              <input disabled name="licenseDate" id="licenseDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeLicensedDate }}" />
            </div>
            <div class="input-field">
              <label for="createdBy"> Created By </label>
              <input disabled name="createdBy" id="createdBy" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedByName }}" />
            </div>
            <div class="input-field">
              <label for="modBy"> Modified By </label>
              <input disabled name="modBy" id="modBy" type="text" value="{{ ActivityLicensed[0]?.ModifiedBy }}" />
            </div>
            <div class="input-field">
              <label for="modDate"> Modification Date </label>
              <input disabled name="modDate" id="modDate" type="text"
                value="{{ ActivityLicensed[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for="createdDate"> Creation Date </label>
              <input disabled name="createdDate" id="createdDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedDate }}" />
            </div>
            <div [hidden]="allowEditLicScopeDetails" class="vary-scope">
              <button>Vary Scope</button>
            </div>
          </div>
          <div *ngIf="allowEditLicScopeDetails" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getLicScopePreviousVersions(firmId,2)">View Previous
              Version</a>
          </div>
        </div>
        <!---->
        <div class="inputs-field-set">
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">Permitted Activities</h2>
          </div>

          <div class="scope-permitted-activity-header">
            <p>Activity</p>
          </div>

          <!--on edit mode-->
          <div class="add-activity-container">
            <button *ngIf="!allowEditLicScopeDetails" class="add-permitted-activity"
              style="width: 30px; height: 30px; margin-left: auto">
              +
            </button>
          </div>

          <div class="permitted-activity-body" *ngFor="let activityLic of ActivityLicensed">
            <table *ngIf="!allowEditLicScopeDetails">
              <tr>
                <th style="width: 70%">Activity</th>
                <th style="width: 30%">Action</th>
                <th></th>
              </tr>

              <tr>
                <td>
                  <div class="input-field">
                    <select name="activities" id="activities" [ngClass]="{
                      'select-background-edited': !allowEditLicScopeDetails
                    }" [(ngModel)]="activityLic.ActivityTypeID">
                      <option value="0">Select</option>
                      <option [value]="licensedActivity.ActivityTypeID"
                        *ngFor="let licensedActivity of licensedActivities">
                        {{ licensedActivity.ActivityTypeDesc }}
                      </option>
                      <!--could be wrong ngModel-->
                    </select>
                  </div>
                </td>
                <td>
                  <div class="input-field">
                    <select [ngClass]="{
                                            'select-background-edited': !allowEditLicScopeDetails
                                          }" name="action" id="action" [(ngModel)]="ActivityLicensed.FirmScopeTypeID">
                      <option [value]="ActivityLicensed.FirmScopeTypeDesc"></option>
                      <!--could be wrong-->
                    </select>
                  </div>
                </td>
                <td>
                  <button style="width: 30px; height: 30px">
                    <i class="bi-trash"></i>
                  </button>
                </td>
              </tr>
            </table>

            <p *ngIf="allowEditLicScopeDetails">
              {{ activityLic?.ActivityTypeDesc }}
            </p>

            <strong>Activity Details: </strong>
            <div class="input-field conditions-textarea">
              <textarea [disabled]="allowEditLicScopeDetails" value="{{ activityLic?.FirmActivityDetails }}"></textarea>
            </div>
            <strong>Specific Conditions and Restrictions: </strong>
            <div class="input-field conditions-textarea">
              <textarea [disabled]="allowEditLicScopeDetails" value="{{ activityLic?.Column1 }}"></textarea>
            </div>
          </div>

          <div class="permitted-activity-container2">
            <div class="scope-permitted-activity-header">
              <p>General License Conditions or restrictions</p>
            </div>

            <div class="permitted-activity-body">
              <div class="input-field conditions-textarea">
                <textarea [disabled]="allowEditLicScopeDetails"
                  value="{{ ActivityLicensed?.GeneralConditions }}"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!---->
    <div class="authorized-section" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
      <div class="authorised-header" (click)="toggleCollapse('authorizeSection')">
        Authorised
        <span class="arrow" [ngClass]="{
            down: !isCollapsed['authorizeSection'],
            up: isCollapsed['authorizeSection']
          }">{{ isCollapsed["authorizeSection"] ? "▲" : "▼" }}</span>
      </div>
      <div class="authorized-body" [ngClass]="{ collapsed: isCollapsed['authorizeSection'] }">
        <div class="inputs-field-set scopeFor">
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">
              <small>Scope for</small> {{ firmDetails?.FirmName }}
            </h2>
            <div *ngIf="currentAuthRevisionNumber === lastAuthRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn">
                <button class="edit-btn" (click)="editAuthScope()">
                  <i [class]="allowEditAuthScopeDetails ? 'bi bi-pen' : ''"></i>
                  {{ allowEditAuthScopeDetails ? "Edit" : "Save" }}
                </button>
              </div>

              <div class="btn">
                <button class="cancel-btn" *ngIf="!allowEditAuthScopeDetails" (click)="cancelEditAuthScope()">
                  Cancel
                </button>
              </div>
            </div>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="formReff"> Form Reference </label>
              <input disabled name="formReff" id="formReff" type="text" value="" />
            </div>
            <div class="input-field">
              <label for=""> Link To Scope </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeCertificateLink }}" />
            </div>
            <div class="input-field">
              <label for=""> Scope Revision Number </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeRevNum }}" />
            </div>
            <div class="input-field">
              <label for="q13AppDate" *ngIf="ActivityAuth[0]?.ScopeRevNum > 1">
                Q13 Application Date for revisions
              </label>
              <label *ngIf="ActivityAuth[0]?.ScopeRevNum == 1">Date Application</label>
              <input [disabled]="allowEditAuthScopeDetails" name="q13AppDate" id="q13AppDate" type="text"
                value="{{ ActivityAuth[0]?.ScopeAppliedDate }}" />
            </div>
            <div class="input-field">
              <label for="incorporationDate"> Incorporation Date </label>
              <input disabled name="incorporationDate" id="incorporationDate" type="text"
                value="{{ firmDetails?.DateOfIncorporation }}" />
              <!--check integration-->
            </div>
            <div class="input-field">
              <label for="authorisedDate"> Authorised Date </label>
              <input disabled name="authorisedDate" id="authorisedDate" type="text"
                value="{{ ActivityAuth[0]?.ScopeLicensedDate }}" />
            </div>
            <div class="input-field">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="allowEditAuthScopeDetails" name="effectiveDate" id="effectiveDate" type="text"
                value="{{ ActivityAuth[0]?.ScopeEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for=""> Created By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeCreatedByName }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ModifiedBy }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for=""> Creation Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeCreatedDate }}" />
            </div>
            <div [hidden]="allowEditAuthScopeDetails" class="vary-scope">
              <button>Vary Scope</button>
            </div>
          </div>
          <div *ngIf="allowEditAuthScopeDetails" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getAuthScopePreviousVersions(firmId,3)">View Previous
              Version</a>
          </div>
        </div>

        <!--Scope of Authorization-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['scopeOfAuthorization'] }">
          <div class="section">
            <div class="edit-firm-actions collapse-container">
              <h2 class="edit-firm-header">Scope of Authorisation</h2>
              <button class="collapse-button" (click)="toggleCollapse('scopeOfAuthorization')">
                {{ isCollapsed["scopeOfAuthorization"] ? "▲" : "▼" }}
              </button>
            </div>
            <div class="edit-firms-inputs">
              <table class="scope-of-auth">
                <thead>
                  <tr>
                    <th>Document Type</th>
                    <th>File Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{AuthTableDocument?.DocSubTypeDesc}}</td>
                    <td><a href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{AuthTableDocument?.FileLoc}}" target="_blank">{{AuthTableDocument?.FileName}}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!--Regulated Activities-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['regulatedActivitiesSection'] }">
          <div class="section">
            <div class="edit-firm-actions collapse-container">
              <h2>Regulated Activities</h2>
              <button class="collapse-button" (click)="toggleCollapse('regulatedActivitiesSection')">
                {{ isCollapsed["regulatedActivitiesSection"] ? "▲" : "▼" }}
              </button>
            </div>
            <div class="regulated-activities-container">
              <div *ngFor="let activity of categorizedData">
                <div class="regulated-activities-header" *ngIf="allowEditAuthScopeDetails">
                  <p>
                    Category :
                    <strong>{{ activity?.ActivityCategoryDesc }}</strong>
                  </p>
                  <p>
                    Activity : <strong>{{ activity?.ActivityTypeDesc }}</strong>
                  </p>
                </div>
                <!--on edit mode-->
                <div class="regulated-activities-header" *ngIf="!allowEditAuthScopeDetails">
                  <div class="category-select">
                    <label for="category" style="display: flex; gap: 5px">
                      Category <span style="color: red">*</span>:
                    </label>
                    <select [(ngModel)]="activity.selectedCategory" (ngModelChange)="onCategoryChange(activity)"
                      name="category" id="category">
                      <!-- <option value="" disabled>Select</option> -->
                      <option *ngFor="let category of activityCategories" [ngValue]="category">
                        {{ category.ActivityCategoryDesc }}
                      </option>
                    </select>
                  </div>

                  <div class="activity-select">
                    <label for="activity" style="display: flex; gap: 5px">
                      Activity <span style="color: red">*</span>:
                    </label>
                    <select [(ngModel)]="activity.selectedActivity" name="activity" id="activity">
                      <option *ngFor="let activity of activity.activities" [ngValue]="activity">
                        {{ activity.ActivityTypeDesc }}
                      </option>
                    </select>
                  </div>
                </div>
                <!---->

                <!-- Loop through Products under each Activity -->
                <div *ngIf="allowEditAuthScopeDetails">
                  <div *ngFor="let product of activity.products">
                    <!-- Display Main Category (Product) -->
                    <h4>{{ product.mainCategory }}</h4>

                    <!-- Loop through Subcategories under each Product -->
                    <ul style="margin-left: 40px">
                      <li *ngFor="let subCategory of product.subCategories">
                        {{ subCategory.ProductCategoryTypeDesc }}
                      </li>
                    </ul>
                  </div>
                </div>

                <!--on Edit mode-->
                <table class="regulated-activity-table" *ngIf="!allowEditAuthScopeDetails">
                  <thead>
                    <tr>
                      <th>Product(s)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!--integration loop will be inside this tr for products-->
                    <tr *ngFor="let product of activity.products">
                      <td>
                        <label>
                          <input type="checkbox" /> {{ product.mainCategory }}
                        </label>

                        <table class="nested-table">
                          <tbody>
                            <tr *ngFor="let subCategory of product.subCategories">
                              <td>
                                <label>
                                  <input type="checkbox" />
                                  {{ subCategory.ProductCategoryTypeDesc }}
                                </label>
                              </td>
                              <td>
                                <select class="action-column" name="action">
                                  <option value="1">Add</option>
                                  <option value="2">Withdrawal</option>
                                  <option value="3">Discontinue</option>
                                </select>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!--specific conditions and restrictions-->
                <div class="specific-conditions-and-restrictions">
                  <div class="specific-conditions-and-restrictions-header">
                    <p>Specific Conditions and Restrictions</p>
                  </div>

                  <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;{{ activity?.specificCondition }}
                  </p>
                </div>
              </div>
              <!--Conditions and Restrictions-->
              <div class="conditions-and-restrictions-section">
                <div class="conditions-and-restrictions-header">
                  <p>Conditions and Restrictions</p>
                </div>
                <p>
                  <strong>Retail Restriction</strong> &nbsp;&nbsp;
                  <input disabled type="checkbox" />
                </p>

                <p>
                  <strong>General Authorisation Conditions or Restrictions</strong>
                </p>
                <div class="input-field conditions-textarea">
                  <textarea disabled value="{{ ActivityAuth[0]?.GeneralConditions }}"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Islamic Finance-->
        <div class="inputs-field-set" *ngIf="
            (firmDetails?.AuthorisationStatusTypeID > 0 &&
              islamicFinance?.IFinTypeId) ||
            !allowEditAuthScopeDetails
          " [ngClass]="{ collapsed: isCollapsed['islamicFinanceSection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Islamic Finance</h2>
            <button class="collapse-button" (click)="toggleCollapse('islamicFinanceSection')">
              {{ isCollapsed["islamicFinanceSection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field" *ngIf="allowEditAuthScopeDetails">
              <label for="isIslamicFinanceExist"> Islamic Finance </label>
              <input disabled name="isIslamicFinanceExist" id="isIslamicFinanceExist" type="text"
                [value]="islamicFinance?.IFinTypeId !== null ? 'Yes' : 'No'" />
            </div>
            <!-- or -->
            <div class="input-field" *ngIf="!allowEditAuthScopeDetails">
              <div style="display: flex; gap: 15px">
                <label for="isIslamicFinanceExist"> Islamic Finance </label>
                <input style="width: 15px" type="checkbox" name="isIslamicFinanceExist" id="isIslamicFinanceExist"
                  [checked]="islamicFinance?.IFinTypeId ? true : false" [(ngModel)]="isIslamicFinanceChecked" />
              </div>
            </div>
            <div class="input-field">
              <label for="islamicFinanceType"> Type </label>
              <select [disabled]="
                  !isIslamicFinanceChecked || allowEditAuthScopeDetails
                " name="islamicFinanceType" id="islamicFinanceType" [ngClass]="{
                  'select-background-edited': !allowEditAuthScopeDetails
                }" [(ngModel)]="islamicFinance.IFinTypeId">
                <option value="0">Select</option>
                <option value="1">Islamic Institution</option>
                <option value="2">Islamic Window</option>
              </select>
            </div>

            <div class="input-field endorsement">
              <label for="endorsement"> Endorsement </label>
              <textarea [disabled]="
                  !isIslamicFinanceChecked || allowEditAuthScopeDetails
                " name="islamicEndorsement" id="endorsement" [(ngModel)]="islamicFinance.Endorsement"></textarea>
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ islamicFinance?.IFinLastModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modified Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ islamicFinance?.LastModifiedDate }}" />
            </div>
          </div>
        </div>

        <!--Prudential Category-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialCategorySection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Prudential Category</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialCategorySection')">
              {{ isCollapsed["prudentialCategorySection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="prudentialCategory"> Prudential Category </label>
              <select [disabled]="allowEditAuthScopeDetails" name="prudentialCategory" id="prudentialCategory" [(ngModel)]="ActivityAuth[0].PrudentialCategoryTypeID"
                [ngClass]="{
                  'select-background-edited': !allowEditAuthScopeDetails
                }">
                <option *ngFor="let option of allPrudentialCategoryTypes" [value]="option.PrudentialCategoryTypeID">
                  {{ option?.PrudentialCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="authorisationCategory">
                Authorisation Category
              </label>
              <select [disabled]="allowEditAuthScopeDetails" name="prudentialCategory" id="prudentialCategory" [(ngModel)]="ActivityAuth[0].AuthorisationCategoryTypeID"
                [ngClass]="{
                  'select-background-edited': !allowEditAuthScopeDetails
                }">
                <option *ngFor="let option of allAuthorisationCategoryTypes" [value]="option?.AuthorisationCategoryTypeID">
                  {{ option?.AuthorisationCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="allowEditAuthScopeDetails" name="effectiveDate" id="effectiveDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.PrudentialCategoryEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ ActivityAuth[0]?.PrudentialModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.PrudentialCategoryLastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="!allowEditAuthScopeDetails">
              <thead>
                <tr>
                  <th>Prudential Category</th>
                  <th>Authorisation Category</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ ActivityAuth[0]?.PrudentialCategoryTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.AuthorisationCategoryTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.PrudentialCategoryEffectiveDate }}</td>
                  <td></td>
                  <!--Expiration Date does exist -->
                  <td>{{ ActivityAuth[0]?.PrudentialModifiedByName }}</td>
                  <td>
                    {{ ActivityAuth[0]?.PrudentialCategoryLastModifiedDate }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!--Prudential Return Type-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialReturnTypeSection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Prudential Return Type</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialReturnTypeSection')">
              {{ isCollapsed["prudentialReturnTypeSection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="prudentialReturnType"> Prudential Return Type </label>
              <select [disabled]="allowEditAuthScopeDetails" [(ngModel)]="ActivityAuth[0].SectorTypeID"
                name="prudentialReturnType" id="prudentialReturnType" [ngClass]="{
                  'select-background-edited': !allowEditAuthScopeDetails
                }">
                <option *ngFor="let PrudReturnTypes of prudReturnTypesDropdown" [value]="PrudReturnTypes.SectorTypeID">
                  {{ PrudReturnTypes?.SectorTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="allowEditAuthScopeDetails" name="effectiveDate" id="effectiveDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.SectorEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ ActivityAuth[0]?.SectorModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.SectorLastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="!allowEditAuthScopeDetails">
              <thead>
                <tr>
                  <th>Prudential Return Type</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ ActivityAuth[0]?.SectorTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.SectorEffectiveDate }}</td>
                  <td></td>
                  <td>{{ ActivityAuth[0]?.SectorModifiedByName }}</td>
                  <td>{{ ActivityAuth[0]?.SectorLastModifiedDate }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--Controllers-->
  <section id="Controllers" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="edit-firm-actions">
          <h2>Controllers For {{ firmDetails?.FirmName }}</h2>
          <div class="btn">
            <button (click)="createController()">
              <i class="bi bi-pen"></i>
              Create
            </button>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let controller of FIRMControllers" (click)="viewController()">
              <td>{{ controller.OtherEntityName }}</td>
              <td>{{ controller.EntityTypeDesc }}</td>
              <td>{{ controller.RegisteredNum }}</td>
              <td>{{ controller.ControllerControlTypeDesc }}</td>
              <td>{{ controller.PctOfShares }}</td>
              <td>{{ controller.AssnDateFrom }}</td>
              <td>{{ controller.AssnDateTo }}</td>
              <td>{{ controller.LastModifiedByOfOtherEntities }}</td>
              <td>{{ controller.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Ultimate Beneficial Owners For</h2>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Auditors-->
  <section id="Auditors" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="btn">
      <button (click)="createAuditor()">
        <i class="bi bi-plus"></i>
        Create
      </button>
      <button (click)="editAuditor()">
        <i class="bi bi-pen"></i>
        Edit
      </button>
      <!--popup message for edit-->

      <button>
        <i class="bi bi-trash"></i>
        Delete
      </button>
    </div>
    <div class="inputs-field-set">
      <div class="section">
        <div class="auditor-header">
          <h2>Auditors For {{ firmDetails?.FirmName }}</h2>
          <span>
            <input id="InactiveAuditors" type="checkbox" />
            <label>Display Inactive Auditors</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Auditor Name</th>
              <th>Auditor Type</th>
              <th>Effective From Date</th>
              <th>Effective To Date</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let auditor of FIRMAuditors">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="auditor" #auditorRadio />
                  <span></span>
                </label>
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.OtherEntityName }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.EntitySubTypeDesc }}
              </td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateFrom }}</td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateTo }}</td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastMeodifiedBy }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastModifiedDate }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!--view auditor-->
    <div class="inputs-field-set" *ngIf="IsViewAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
      </div>
      <div class="view-auditor-inputs">
        <div class="input-field">
          <label for="auditorName"> Auditor Name </label>
          <input disabled name="auditorName" id="auditorName" type="text"
            value="{{ selectedAuditor.OtherEntityName }}" />
        </div>
        <div class="input-field">
          <label for="auditorType"> Auditor Type </label>
          <input disabled name="auditorType" id="auditorType" type="text"
            value="{{ selectedAuditor.EntitySubTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="address2"> Effective From Date </label>
          <input disabled name="effectiveFromDate" id="effectiveFromDate" type="text"
            value="{{ selectedAuditor.AssnDateFrom }}" />
        </div>
        <div class="input-field">
          <label for="effectiveToDate"> Effective To Date </label>
          <input disabled name="effectiveToDate" id="effectiveToDate" type="text"
            value="{{ selectedAuditor.AssnDateTo }}" />
        </div>
      </div>
    </div>
    <!--create auditor-->
    <div class="inputs-field-set" *ngIf="IsCreateAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
        <div class="btn">
          <button class="save-btn">Save</button>
        </div>
      </div>
      <form>
        <div class="view-auditor-inputs">
          <div class="input-field">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <select name="auditorName" id="auditorName" [(ngModel)]="selectedAuditorNameFromSelectBox">
              <option value="select">Select</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="input-field" *ngIf="selectedAuditorNameFromSelectBox === 'other'">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <input type="text" />
          </div>
          <div class="input-field">
            <label for="auditorType">
              Auditor Type <span style="color: red">*</span>
            </label>
            <select name="auditorType" id="auditorType">
              <option value="select">Select</option>
            </select>
          </div>
          <div class="input-field">
            <label for="address2">
              Effective From Date <span style="color: red">*</span>
            </label>
            <input name="effectiveFromDate" id="effectiveFromDate" type="date" />
          </div>
          <div class="input-field">
            <label for="effectiveToDate"> Effective To Date </label>
            <input name="effectiveToDate" id="effectiveToDate" type="date" />
          </div>
        </div>
      </form>
    </div>

    <!--edit auditor-->
    <div class="inputs-field-set" *ngIf="IsEditAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
        <div class="btn">
          <button class="save-btn">Save</button>
        </div>
      </div>
      <form>
        <div class="view-auditor-inputs">
          <div class="input-field">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <select disabled name="auditorName" id="auditorName" [(ngModel)]="selectedAuditorNameFromSelectBox"
              value="{{ selectedAuditor.OtherEntityName }}">
              <option value="select">Select</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="input-field">
            <label for="auditorType">
              Auditor Type <span style="color: red">*</span>
            </label>
            <select name="auditorType" id="auditorType">
              <option value="select">Select</option>
            </select>
          </div>
          <div class="input-field">
            <label for="address2">
              Effective From Date <span style="color: red">*</span>
            </label>
            <input name="effectiveFromDate" id="effectiveFromDate" type="date" />
          </div>
          <div class="input-field">
            <label for="effectiveToDate"> Effective To Date </label>
            <input name="effectiveToDate" id="effectiveToDate" type="date" />
          </div>
        </div>
      </form>
    </div>
  </section>

  <!--Contacts-->
  <section id="Contacts" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="contacts-header">
          <h2>Contacts For</h2>
          <span>
            <input id="InactiveContacts" type="checkbox" />
            <label>Display Inactive Contacts</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Name</th>
              <th>Contact Type</th>
              <th>Contact Form</th>
              <th>Position/Job Title</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of FIRMContacts">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="contact" />
                  <span></span>
                </label>
              </td>
              <td>{{ contact.FullName }}</td>
              <td>{{ contact.ContactTypeDesc }}</td>
              <td>{{ contact?.ContactMethodTypeDesc }}</td>
              <td>{{ contact.JobTitle }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Firm details sub section-->

  <!--Start Individuals sub sections-->

  <!--Individuals Details-->
  <section id="INDDetails" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Applied For</h2>
        <table>
          <thead>
            <tr>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Applied Date</th>
              <th>Function Status</th>
              <th>RSG Assessment Completion Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Approved Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Applied Date</th>
              <th>Conditionally Approved Date</th>
              <th>Conditional Approved Expiry Date</th>
              <th>Approved Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Applied Date</td>
              <td>Conditionally Approved Date</td>
              <td>Conditional Approved Expiry Date</td>
              <td>Approved Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Withdraw Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Previous Status</th>
              <th>Current Status</th>
              <th>Current Status Effective Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Form Type</td>
              <td>Previous Status</td>
              <td>Current Status</td>
              <td>Current Status Effective Date</td>
              <td>Request Status</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Individuals sub sections-->

  <!--Start Supervision sub sections-->

  <!--Supervision Reporting Schedule-->
  <section id="SPRS" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Reporting Schedule For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Reporting Schedule From</th>
              <th>Reporting Schedule To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dates of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ dates?.RptPeriodFromDate }}</td>
              <td>{{ dates?.RptPeriodToDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Review-->
  <section id="SPReview" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="return-review-header">
          <h2>Return Review For</h2>
          <span>
            <label>Report Type : </label>
            <select name="reportType" id="reportType" class="SPReview-dropdown">
              <option>All</option>
            </select>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Ver</th>
              <th>Report</th>
              <th>Report Period Start Date</th>
              <th>Report Period End Date</th>
              <th>Received Date</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Ver</td>
              <td>Report</td>
              <td>Report Period Start Date</td>
              <td>Report Period End Date</td>
              <td>Received Date</td>
              <td>Review Status Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Notices-->
  <section id="SPNotices" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set" style="overflow-x: scroll">
      <div class="section">
        <h2>Notices And Responses -</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Notice Type</th>
              <th>Notice Name</th>
              <th>Internal Reference Number</th>
              <th>Notice Issuer</th>
              <th>Notice Issued Date</th>
              <th>Issuer's Reference Number</th>
              <th>Subject</th>
              <th>Notice Finalized Date</th>
              <th>Date Published on Website</th>
              <th>Notice Sent Date</th>
              <th>Response Due Date</th>
              <th>Response Provided Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let notice of FIRMNotices">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ notice?.TypeOfNotice }}</td>
              <td>{{ notice?.NoticeName }}</td>
              <td>{{ notice?.InternalReferenceNumber }}</td>
              <td>{{ notice?.NoticeIssuedBy }}</td>
              <td>{{ notice?.NoticeIssuedDate }}</td>
              <td>{{ notice?.IssuersReferenceNumber }}</td>
              <td>{{ notice?.Subject }}</td>
              <td>{{ notice?.NoticeFinalizedDate }}</td>
              <td>{{ notice?.DatePublishedonWebsite }}</td>
              <td>{{ notice?.NotificationSentDate }}</td>
              <td>{{ notice?.ResponseDueDate }}</td>
              <td>{{ notice?.ResponseProvidedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Admin Fee-->
  <section id="SPAdminFee" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Admin Fees For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Report Name</th>
              <th>Report Due Date</th>
              <th>Materially Complete Report Receive Date</th>
              <th>Fee Calculated</th>
              <th>Fee Imposed</th>
              <th>Review Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fee of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ fee.RptName }}</td>
              <td>{{ fee.FirmRptDueDate }}</td>
              <td>{{ fee.FirstMateriallyCompleteRptReceivedDate }}</td>
              <td>{{ fee.CalculatedAmount }}</td>
              <td>{{ fee.ImposedAmount }}</td>
              <td>{{ fee.ObjectWFStatusTypeDesc }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision RMPs-->
  <section id="SPRMPs" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>RMPs For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>RMP ID</th>
              <th>Date Created</th>
              <th>Type</th>
              <th>Date Firm Agreed</th>
              <th>Agreed By</th>
              <th>RMP Status</th>
              <th>Review Status</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rmp of FIRMRMP">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="rmp" />
                  <span></span>
                </label>
              </td>
              <td>{{ rmp?.FirmRMPID }}</td>
              <td>{{ rmp?.RMPCreatedDate }}</td>
              <td>{{ rmp?.FirmRMPTypeDesc }}</td>
              <td>{{ rmp?.DateFirmAgreedOn }}</td>
              <td>{{ rmp?.AgreedBy }}</td>
              <td>{{ rmp?.RMPStatus }}</td>
              <td>{{ rmp?.SignOffStatus }}</td>
              <td>{{ rmp?.SignOffDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Breaches-->
  <section id="SPBreaches" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Breaches For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Breach Number</th>
              <th>Version</th>
              <th>Breach Type</th>
              <th>Breach Category</th>
              <th>Breach Level</th>
              <th>Date Of Breach</th>
              <th>Breach Status</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="breach" />
                  <span></span>
                </label>
              </td>
              <td>Breach Number</td>
              <td>Version</td>
              <td>Breach Type</td>
              <td>Breach Category</td>
              <td>Breach Level</td>
              <td>Date Of Breach</td>
              <td>Breach Status</td>
              <td>Last Updated By</td>
              <td>Last Updated Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Waivers-->
  <section id="SPWaivers" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Waiver And/Or Modification For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Waiver Number</th>
              <th>Version</th>
              <th>Waiver Type</th>
              <th>Subject</th>
              <th>Waiver Status</th>
              <th>Status Date</th>
              <th>Review Date</th>
              <th>Review Decision</th>
              <th>Expiration Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let waiver of FirmWaivers">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="waiver" />
                  <span></span>
                </label>
              </td>
              <td>{{ waiver?.WaiverNumber }}</td>
              <td>{{ waiver?.WaiverRevNum }}</td>
              <td>{{ waiver?.WaiverTypeDesc }}</td>
              <td>{{ waiver?.WaiverSubject }}</td>
              <td>{{ waiver?.WaiverStatusTypeDesc }}</td>
              <td>{{ waiver?.WaiverStatusDate }}</td>
              <td>{{ waiver?.ReviewMeetingDate }}</td>
              <td>{{ waiver?.WaiverDecisionTypeDesc }}</td>
              <td>{{ waiver?.WaiverExpirationDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision ENF Actions-->
  <section id="SPENFAction" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="ENFAction-header">
          <h2>List Of Enforcement & Disciplinary Actions</h2>
          <span>
            <input id="deletedRecords" type="checkbox" />
            <label>Display Deleted Records</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Action</th>
              <th>Type Of Action</th>
              <th>Date Of Action</th>
              <th>Firm Name</th>
              <th>Approved Individual</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Action</td>
              <td>Type Of Action</td>
              <td>Date Of Action</td>
              <td>Firm Name</td>
              <td>Approved Individual</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Reg. Funds-->
  <section id="SPRegFunds" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <h2>List Of Registered Funds For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Fund Number</th>
              <th>Fund Name</th>
              <th>Type Of Fund</th>
              <th>Status</th>
              <th>Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fund of RegisteredFund">
              <td></td>
              <td>{{ fund.RegisteredFundNumber }}</td>
              <td>{{ fund.FundName }}</td>
              <td>{{ fund.RegisteredFundTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Journal-->
  <section id="SPJournal" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="Journal-header">
          <h2>Journal Entries For</h2>
          <span>
            <input id="deletedEntries" type="checkbox" />
            <label>Display Deleted Entries</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Entry Type</th>
              <th>Title</th>
              <th>Entry Date</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Supervision sub sections-->
</div>

<!--Popups-->
<!--Financial Year End History-->
<div *ngIf="call" class="popup-wrapper">
  <i class="bi bi-x-circle close-icon" (click)="closeFYearHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Financial Year End History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Year End</th>
          <th>Financial Year Effective From</th>
          <th>Financial Year Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FR of firmFYearHistory">
          <td style="text-align: left">{{ FR?.FirmName }}</td>
          <td style="text-align: left">{{ FR?.FirmFinYearEndTypeDesc }}</td>
          <td>{{ FR?.FirmFinYearEndEffectiveFrom }}</td>
          <td>{{ firmDetails?.FirmFinYearEndEffectiveTo }}</td>
          <td style="text-align: left">{{ FR?.UserName }}</td>
          <td>{{ FR?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeFYearHistory()">
      Close
    </button>
  </div>
</div>
<!--Inactive Users-->
<div *ngIf="callInactiveUsers" class="InactiveUsersPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeInactiveUsers()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Inactive Users</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Function / Role</th>
          <th>Name</th>
          <th>Date From</th>
          <th>Date To</th>
          <th>Reason For Change</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FYE of firmInactiveUsers">
          <td style="text-align: left">{{ FYE.FirmUserAssnTypeDesc }}</td>
          <td style="text-align: left">{{ FYE.Name }}</td>
          <td>{{ FYE.FirmUserAssnDateFrom | date : "dd/MMM/yyyy" }}</td>
          <td>{{ FYE.FirmUserAssnDateTo | date : "dd/MMM/yyyy" }}</td>
          <td>{{ FYE.FirmUserAssnReasonTypeDesc }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeInactiveUsers()">
      Close
    </button>
  </div>
</div>

<!--Accounting Standards-->
<div class="accountingStandardsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeAccountingStandard()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Accounting Standards History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Standard</th>
          <th>Financial Standard Effective From</th>
          <th>Financial Standard Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AS of firmAccountingStandardHistory">
          <td style="text-align: left">{{ AS?.FirmName }}</td>
          <td style="text-align: left">{{ AS?.FinAccStdTypeDesc }}</td>
          <td>{{ AS?.FirmFinYearEndEffectiveFrom }}</td>
          <td>{{ firmDetails?.FirmFinYearEndEffectiveTo }}</td>
          <td style="text-align: left">{{ AS?.UserName }}</td>
          <td>{{ AS?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeAccountingStandard()">
      Close
    </button>
  </div>
</div>
<!--Previous Firm Name-->
<div class="prevFirmNamePopUp">
  <i class="bi bi-x-circle close-icon" (click)="closePrevFirmName()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>File Name History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Prev. Firm Name</th>
          <th>Date Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let PRN of firmNamesHistory">
          <td style="text-align: left">{{ PRN?.PrevFirmName }}</td>
          <td>{{ PRN?.DateEffectiveTo }}</td>
          <td style="text-align: left">{{ PRN?.LastModifiedBy }}</td>
          <td>{{ PRN?.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closePrevFirmName()">
      Close
    </button>
  </div>
</div>
<!--Application Details-->
<div class="ApplicationDetailsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeApplicationDetails()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Application Details History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <td style="background: #a51e36; color: white; cursor: default" colspan="4">
            Licensed Status
          </td>
        </tr>
        <tr>
          <th>Status</th>
          <th>Status Date</th>
          <th>Last Modified By</th>
          <th>Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let LicenseDetailsHistory of firmAppDetailsLicensed">
          <td style="text-align: left">
            {{ LicenseDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td>{{ LicenseDetailsHistory.FirmApplStatusDate }}</td>
          <td>{{ LicenseDetailsHistory.LastModifiedByUser }}</td>
          <td>{{ LicenseDetailsHistory.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
    <table *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
      <thead>
        <tr>
          <td style="background: #a51e36; color: white; cursor: default" colspan="5">
            Authorisation Status
          </td>
        </tr>
        <tr>
          <th>Status</th>
          <th>Status Date</th>
          <th>Press Release</th>
          <th>Last Modified By</th>
          <th>Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AuthDetailsHistory of firmAppDetailsAuthorization">
          <td style="text-align: left">
            {{ AuthDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td>{{ AuthDetailsHistory.FirmApplStatusDate }}</td>
          <td>{{ firmDetails?.PressReleaseLink }}</td>
          <td>{{ AuthDetailsHistory.LastModifiedByUser }}</td>
          <td>{{ AuthDetailsHistory.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeApplicationDetails()">
      Close
    </button>
  </div>
</div>
<!--Upload document-->
<div class="uploadDocumentPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeUploadDocument()"></i>
  <div class="popup-info-place upload-container">
    <div class="popup-header">
      <h3>Upload Document</h3>
    </div>
    <div class="upload-document-body">
      <p>Please browse and upload/attach document:</p>
      <input type="file" accept=".pdf" #fileInput (change)="onFileSelected($event)" />
    </div>
    <small style="color: red" *ngIf="fileError">{{ fileError }}</small>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%; margin-right: 5px" class="subbutton" (click)="confirmUpload()">
      Ok
    </button>
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeUploadDocument()">
      Close
    </button>
  </div>
</div>
<!--Address Type History-->
<div class="addressHistoryPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeAddressTypeHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Address History</h3>
    </div>
    <br />
    <div class="address-type-info">
      <span style="text-decoration: underline">{{
        firmAddressesTypeHistory[0]?.AddressTypeDesc
        }}</span>
      &nbsp; (<span style="color: red">history includes the deleted record for this address type.</span>)
    </div>
    <table>
      <thead>
        <tr>
          <th>Address</th>
          <th>Created Date</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let addressHistory of firmAddressesTypeHistory">
          <td>{{ addressHistory?.ShortAddress }}</td>
          <td style="text-align: center">{{ addressHistory?.CreatedDate }}</td>
          <td style="text-align: center">
            {{ addressHistory?.LastModifiedDate }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button style="padding: 1rem; width: 30%" class="subbutton" (click)="closeAddressTypeHistory()">
      Close
    </button>
  </div>
</div>

<!--Scope Previous Versions for License popup-->
<div class="ScopeLicPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeLicScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for License Scope</h3>
  </div>

  <div style="width: 50%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of LicPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId,2,rev.ScopeRevNum)">
          {{rev.ScopeRevNum}}
        </button>
      </li>
    </ul>
  </div>
</div>

<!--Scope Previous Versions for Authorize popup-->
<div class="ScopeAuthPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeAuthScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for Authorize Scope</h3>
  </div>

  <div style="width: 50%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of AuthPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId,3,rev.ScopeRevNum)">
          {{rev.ScopeRevNum}}
        </button>
      </li>
    </ul>
  </div>
</div>