<div class="brid-crump">
  <div class="text"><span> Home ></span> Firm Details</div>
</div>
<div class="page">
  <div class="menu" [ngStyle]="{ width: menuWidth }">
    <!-- <button (click)="toggleFulMenu()" class="menu-item menu-item-btn-ce"> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width1)" class="menu-icons bi bi-arrow-left-square-fill"></i>
    <!-- <p *ngIf="menuWidth.match('20%')">Close Menu</p> -->
    <i (click)="toggleFulMenu()" *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-arrow-right-square-fill"></i>
    <!-- </button> -->

    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="1-item" (click)="toggleMenu(1)" [ngClass]="{ active: menuId === 1 }"
        (click)="switchTab(FrimsObject.Firm)">
        FIRM Details
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-info-square"></i>
      <div class="sub-menu" *ngIf="menuId === 1 && menuWidth.match(width1)">
        <a (click)="switchTab(FrimsObject.CoreDetail)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.CoreDetail }">
          Core Details
        </a>
        <a (click)="switchTab(FrimsObject.Scope)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Scope }">
          Scope
        </a>
        <a (click)="switchTab(FrimsObject.Controller)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Controller }">
          Controllers
        </a>
        <a (click)="switchTab(FrimsObject.Auditor)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Auditor }">
          Auditors
        </a>
        <a (click)="switchTab(FrimsObject.Contatcs)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Contatcs }">
          Contacts
        </a>
      </div>
    </div>


    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(2)" [ngClass]="{ active: menuId === 2 }">
        Individuals
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-people"></i>
      <div class="sub-menu" *ngIf="menuId === 2 && menuWidth.match(width1)">
        <a (click)="switchTab(FrimsObject.Individual)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Individual }">
          Individual Details
        </a>
      </div>
    </div>

    <div class="menu-item">
      <h3 *ngIf="menuWidth.match(width1)" id="2-item" (click)="toggleMenu(3)" [ngClass]="{ active: menuId === 3 }">
        Supervision
      </h3>
      <i *ngIf="menuWidth.match(width2)" class="menu-icons bi bi-kanban"></i>
      <div class="sub-menu" *ngIf="menuId === 3 && menuWidth.match(width1)">
        <a (click)="switchTab(FrimsObject.ReportingSchedule)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.ReportingSchedule }">
          Reporting Schedule
        </a>
        <a (click)="switchTab(FrimsObject.ReturnsReview)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.ReturnsReview }">
          Return Review
        </a>
        <a (click)="switchTab(FrimsObject.Notices)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Notices }">
          Notices
        </a>
        <a (click)="switchTab(FrimsObject.LateAdminFee)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.LateAdminFee }">
          Admin Fee
        </a>
        <a (click)="switchTab(FrimsObject.RMP)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.RMP }">
          RMPs
        </a>
        <a (click)="switchTab(FrimsObject.Breach)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Breach }">
          Breaches
        </a>
        <a (click)="switchTab(FrimsObject.Waiver)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Waiver }">
          Waivers
        </a>
        <a (click)="switchTab(FrimsObject.Enforcement)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.Enforcement }">
          Enf. Actions
        </a>
        <a (click)="switchTab(FrimsObject.RegisteredFunds)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.RegisteredFunds }">
          Reg. Funds
        </a>
        <a (click)="switchTab(FrimsObject.SupervisionJournal)" class="menu-sub-item"
          [ngClass]="{ active: activeTab === FrimsObject.SupervisionJournal }">
          Journal
        </a>
      </div>
    </div>
  </div>

  <!-- Firm Section -->
  <section #firmSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Firm ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">
          FIRM Details > <span>{{ firmDetails?.FirmName }}</span>
        </h2>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="QFCNumber"> QFC Number </label>
          <input disabled name="QFCNumber" id="QFCNumber" type="text" value="{{ firmDetails?.QFCNum }}" />
        </div>
        <div class="input-field">
          <label for="code"> Code </label>
          <input disabled name="code" id="code" type="text" value="{{ firmDetails?.FirmCode }}" />
        </div>
        <div class="input-field">
          <label for="lagalStatus"> Legal Status </label>
          <input disabled name="lagalStatus" id="lagalStatus" type="text"
            value="{{ firmDetails?.LegalStatusTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="PrudentialCategory"> Prudential Category </label>
          <input disabled name="PrudentialCategory" id="PrudentialCategory" type="text"
            value="{{ firmDetails?.PrudentialCategoryTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="FinancialYearEnd"> Financial Year End </label>
          <input disabled name="financialYearEnd" id="financialYearEnd" type="text"
            value="{{ firmDetails?.FinYearEndTypeDesc }}" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">Application Details</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="dateOfApplication"> Date of Application </label>
          <input disabled name="dateOfApplication" id="dateOfApplication" type="text" value="{{
              firmDetails?.AuthorisationStatusTypeID == 0
                ? (firmDetails?.FirmLicApplDate | date : 'dd/MMM/y')
                : (firmDetails?.FirmAuthApplDate | date : 'dd/MMM/y')
            }}" />
        </div>

        <div class="input-field">
          <label for="firmApplicationType"> Firm Application Type </label>
          <input type="text" disabled name="firmApplicationType" id="firmApplicationType"
            value="{{ appDetails.FirmApplTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="qfcLicenseStatus"> QFC License Status </label>
          <input disabled type="text" name="qfcLicenseStatus" id="qfcLicenseStatus"
            value="{{ firmDetails?.LicenseStatusTypeDesc }}" />
        </div>

        <div class="input-field">
          <label for="DateLicensed">
            {{ firmDetails?.LicenseStatusTypeLabelDesc }}
          </label>
          <input disabled name="DateLicensed" id="DateLicensed" type="text"
            value="{{ firmDetails?.LicenseApplStatusDate | date : 'dd/MMM/y' }}" />
        </div>

        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="authorisationStatus"> Authorisation Status </label>
          <input type="text" disabled name="authorisationStatus" id="authorisationStatus"
            value="{{ firmDetails?.AuthorisationStatusTypeDesc }}" />
        </div>
        <div class="input-field" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <label for="dateApplication">
            {{ firmDetails?.AuthorisationStatusTypeLabelDesc }}
          </label>
          <input disabled name="dateApplication" id="dateApplication" type="text"
            value="{{ firmDetails?.AuthApplStatusDate | date : 'dd/MMM/y' }}" />
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">Operational Information</h2>
        <div class="edit-btn"></div>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="noOfStaffInQatar"> No. Of Staff In Qatar </label>
          <input disabled name="noOfStaffInQatar" id="noOfStaffInQatar" type="text"
            value="{{ firmOPDetails?.NumOfLocalStaff }}" />
        </div>

        <div class="input-field">
          <label for="staffTotal"> Staff total </label>
          <input disabled name="staffTotal" id="staffTotal" type="text" value="{{ firmOPDetails?.NumOfTotalStaff }}" />
        </div>

        <div class="input-field notes">
          <label for="notes"> Notes : </label>
          <textarea disabled name="notes" id="notes">{{
            getCleanedNotes(firmOPDetails?.Notes)
          }}</textarea>
        </div>
      </div>
    </div>
    <!---->
    <div class="inputs-field-set">
      <div class="section">
        <h2>
          RA Personal Assigned
          <button [disabled]="FIRMRA.length === 0" class="subbutton" (click)="getInactiveUsers()">
            Open History
          </button>
        </h2>
        <table *ngIf="FIRMRA?.length > 0; else noSupervisors">
          <thead>
            <tr>
              <th>Function / Role</th>
              <th>Name</th>
              <th>Date From</th>
              <th>Date To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let RA of FIRMRA">
              <td style="text-align: left">{{ RA.firmUserAssnTypeDesc }}</td>
              <td style="text-align: left">{{ RA.name }}</td>
              <td>{{ RA.firmUserAssnDateFrom | date : "dd/MMM/yyyy" }}</td>
              <td>{{ RA.firmUserAssnDateTo | date : "dd/MMM/yyyy" }}</td>
            </tr>
          </tbody>
        </table>
        <!-- Display this message when there are no supervisors assigned -->
        <ng-template #noSupervisors>
          <p style="color: red">No supervisors assigned</p>
        </ng-template>
      </div>
    </div>
  </section>

  <!--Start Firm details sub section-->

  <!--Core Details-->
  <section #coreDetailSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.CoreDetail ? 'flex' : 'none' }">
    <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['firmDetailsSection'] }">
      <!--Error messages for firm details-->
      <div class="error-messages" style="color: red">
        <p *ngIf="errorMessages['FirmName']">{{ errorMessages['FirmName'] }}</p>
        <p *ngIf="errorMessages['LegalStatusTypeID']">{{ errorMessages['LegalStatusTypeID'] }}</p>
        <p *ngIf="errorMessages['DateOfIncorporation']">{{ errorMessages['DateOfIncorporation'] }}</p>
        <p *ngIf="errorMessages['DateOfApplication']">{{ errorMessages['DateOfApplication'] }}</p>
        <p *ngIf="errorMessages['LicensedDate']">{{ errorMessages['LicensedDate'] }}</p>
        <p *ngIf="errorMessages['AuthorisationDate']">{{ errorMessages['AuthorisationDate'] }}</p>
        <p *ngIf="errorMessages['QFCNum']">{{ errorMessages['QFCNum'] }}</p>
        <p *ngIf="errorMessages['FYearEndDate']">{{ errorMessages['FYearEndDate'] }}</p>
        <p *ngIf="errorMessages['AccStandDate']">{{ errorMessages['AccStandDate'] }}</p>
        <p *ngIf="errorMessages['PrevFirmNameEffectiveTo']">{{ errorMessages['PrevFirmNameEffectiveTo'] }}</p>
      </div>
      <div class="edit-firm-actions">
        <h2 class="edit-firm-header">
          FIRM Details
          <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
            (click)="toggleCollapse('firmDetailsSection')">
            {{ isCollapsed["firmDetailsSection"] ? "▲" : "▼" }}
          </button>
        </h2>

        <div style="display: flex; gap: 10px">
          <!-- loading flag for rendering buttons, hideSaveBtn..etc flag for supervisor access and other roles, getControlVisiblity function for role access endpoint -->
          <div class="btn" *ngIf="!loading && !hideEditBtn && getControlVisibility('imgBtnEdit')">
            <button [disabled]="!getControlEnablement('imgBtnEdit')" class="edit-btn" (click)="editFirm()">
              <i class="bi bi-pen"></i>Edit
            </button>
          </div>

          <div class="btn" *ngIf="!loading && !hideSaveBtn && getControlVisibility('imgBtnSave')">
            <button [disabled]="!getControlEnablement('imgBtnSave')" class="save-btn" (click)="saveFirm()">
              Save
            </button>
          </div>

          <div class="btn" *ngIf="!loading && !hideCancelBtn && getControlVisibility('imgBtnCancel')">
            <button [disabled]="!getControlEnablement('imgBtnCancel')" class="cancel-btn" (click)="cancelEditFirm()">
              Cancel
            </button>
          </div>

          <div class="btn" *ngIf="!loading && !hideCreateBtn && getControlVisibility('imgBtnCreate')">
            <button [disabled]="!getControlEnablement('imgBtnCreate')">
              Create
            </button>
          </div>

          <div class="btn" *ngIf="!loading && !hideReviseBtn && getControlVisibility('imgBtnRevise')">
            <button [disabled]="!getControlEnablement('imgBtnRevise')">
              Revise
            </button>
          </div>

          <div class="btn" *ngIf="!loading && !hideDeleteBtn && getControlVisibility('imgBtnDelete')">
            <button [disabled]="!getControlEnablement('imgBtnDelete')">
              Delete
            </button>
          </div>

        </div>
      </div>

      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="firmName"> Firm Name
            <span [hidden]="!isEditModeCore" style="color: red">*</span>
          </label>
          <input [disabled]="!isEditModeCore" name="firmName" id="firmName" type="text"
            [(ngModel)]="firmDetails.FirmName" [ngClass]="{ 'error-border': errorMessages['FirmName'] }" />
        </div>

        <div class="input-field">
          <label for="qfcNumber"> QFC Number </label>
          <input [disabled]="!isEditModeCore" name="qfcNumber" id="qfcNumber" type="text"
            [(ngModel)]="firmDetails.QFCNum" [ngClass]="{ 'error-border': errorMessages['QFCNum'] }" />
        </div>

        <div class="input-field">
          <label for="code"> Code </label>
          <input [disabled]="!isEditModeCore" name="code" id="code" type="text" [(ngModel)]="firmDetails.FirmCode" />
        </div>

        <div class="input-field">
          <label for="legalStatus">
            Legal Status
            <span [hidden]="!isEditModeCore" style="color: red">*</span>
          </label>
          <select
            [ngClass]="{ 'select-background-edited': isEditModeCore, 'error-border': errorMessages['LegalStatusTypeID'] }"
            [disabled]="!isEditModeCore" id="legalStatus" (ngModelChange)="onLegalStatusChange($event)"
            [(ngModel)]="firmDetails.LegalStatusTypeID">
            <option value="0">Select</option>
            <option *ngFor="let option of allLegalStatus" [value]="option.LegalStatusTypeID">
              {{ option.LegalStatusTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="qfcTradingName"> QFC Trading Name </label>
          <input [disabled]="!isEditModeCore" name="qfcTradingName" id="qfcTradingName" type="text"
            [(ngModel)]="firmDetails.QFCTradingName" />
        </div>

        <div class="input-field">
          <label for="prevTradingNames"> Prev. Trading Name(s) </label>
          <input [disabled]="!isEditModeCore" name="prevTradingNames" id="prevTradingNames" type="text"
            [(ngModel)]="firmDetails.PrevTradingName" />
        </div>

        <div class="input-field">
          <label for="placeOfIncorporation"> Place of Incorporation </label>
          <input [disabled]="!isEditModeCore" name="placeOfIncorporation" id="placeOfIncorporation" type="text"
            [(ngModel)]="firmDetails.PlaceOfIncorporation" />
        </div>

        <div class="input-field">
          <label for="homeCountry"> Home Country </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="homeCountry" [(ngModel)]="firmDetails.CountyOfIncorporation">
            <option *ngFor="let option of allCountries" [value]="option.CountryID">
              {{ option?.CountryName }}
            </option>
          </select>
        </div>

        <div class="input-field" [hidden]="!isEditModeCore">
          <label for="isDateDifferent">
            Is Date of Incorporation different from Date of Licensing or
            Authorisation : <span style="color: red">*</span>
          </label>
          <div class="radio-wrapper">
            <input name="isIncorporationDateDifferent" id="yes" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="true" />
            Yes
            <input name="isIncorporationDateDifferent" id="no" type="radio"
              [(ngModel)]="firmDetails.DifferentIncorporationDate" [value]="false" />
            No
          </div>
        </div>

        <ng-container *ngIf="firmDetails.DifferentIncorporationDate || !isEditModeCore">
          <div class="input-field">
            <label for="incorporationDate"> Incorporation Date </label>
            <input [ngClass]="{ 'error-border': errorMessages['DateOfIncorporation'] }" [disabled]="!isEditModeCore"
              name="incorporationDate" id="incorporationDate" type="text" #dateInputs
              [(ngModel)]="firmDetails.DateOfIncorporation" />
          </div>
        </ng-container>

        <div class="input-field">
          <label for="financialYearEnd">
            Financial Year End
            <button *ngIf="firmDetails?.FinYearEndTypeDesc" class="subbutton" (click)="getFYearHistory()">
              History
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="financialYearEnd" [(ngModel)]="firmDetails.FinYearEndTypeID">
            <option *ngFor="let option of allFinYearEnd" [value]="option.FirmFinYearEndTypeID">
              {{ option.FirmFinYearEndTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="financialYearEndEffectiveFrom">
            Financial Year End Effective From
          </label>
          <input [disabled]="!isEditModeCore" name="financialYearEndEffectiveFrom" type="text" #dateInputs
            id="financialYearEndEffectiveFrom" [(ngModel)]="firmDetails.FirmFinYearEndEffectiveFrom"
            [ngClass]="{ 'error-border': errorMessages['FYearEndDate'] }" />
        </div>

        <div class="input-field">
          <label for="accountingStandards">
            Accounting Standards
            <button *ngIf="firmDetails?.FinAccStdTypeDesc" class="subbutton" (click)="getAccountingStandardHistory()">
              History
            </button>
          </label>
          <select [ngClass]="{ 'select-background-edited': isEditModeCore }" [disabled]="!isEditModeCore"
            id="accountingStandards" [(ngModel)]="firmDetails.FinAccStdTypeID">
            <option *ngFor="let option of allFinAccStd" [value]="option.FinAccStdTypeID">
              {{ option.FinAccStdTypeDesc }}
            </option>
          </select>
        </div>

        <div class="input-field">
          <label for="accountingStandardsEffectiveFrom">
            Accounting Standards Effective From
          </label>
          <input [disabled]="!isEditModeCore" name="accountingStandardsEffectiveFrom"
            id="accountingStandardsEffectiveFrom" type="text" #dateInputs
            [(ngModel)]="firmDetails.FinAccStdTypeEffectiveFrom"
            [ngClass]="{ 'error-border': errorMessages['AccStandDate'] }" />
        </div>

        <div class="input-field">
          <label for="websiteLink"> Website Link </label>

          <input *ngIf="isEditModeCore" type="text" value="" [(ngModel)]="firmDetails.WebSiteAddress"
            id="websiteLink" />

          <a *ngIf="!isEditModeCore" id="websiteLink" [href]="firmDetails?.WebSiteAddress" target="_blank"
            rel="noopener noreferrer">
            {{ firmDetails?.WebSiteAddress}}
          </a>
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmName">
            Prev. Firm Name <button class="subbutton" (click)="getPrevFirmName()">History</button>
          </label>
          <input [disabled]="!isEditModeCore" name="prevFirmName" id="prevFirmName" type="text"
            [(ngModel)]="firmNamesHistory[0].PrevFirmName">
        </div>
        <div class="input-field" *ngIf="firmNamesHistory[0]?.FirmNameHistoryID">
          <label for="prevFirmNameEffectiveTo">
            Prev. Firm Name Effective To
          </label>
          <input [disabled]="!isEditModeCore" name="prevFirmNameEffectiveTo" id="prevFirmNameEffectiveTo" type="text"
            #dateInputs [(ngModel)]="firmNamesHistory[0].DateEffectiveTo"
            [ngClass]="{ 'error-border': errorMessages['PrevFirmNameEffectiveTo'] }">
        </div>
      </div>

    </div>
    <!---->
    <div class="inputs-field-set" [ngClass]="{collapsed: isCollapsed['appDetailsSection']}">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">
          Application Details <button class="subbutton" (click)="getApplicationDetailsHistory()">Open
            History</button>
          <button [ngClass]="{'hidden-button': !isEditModeCore}" class="collapse-button"
            (click)="toggleCollapse('appDetailsSection')">
            {{ isCollapsed['appDetailsSection'] ? '▲' : '▼'}}
          </button>
        </h2>
      </div>
      <div class="edit-firms-inputs" *ngIf="!isEditModeCore">
        <!-- Licensed Status Table -->
        <table class="aligned-table">
          <thead>
            <tr>
              <td class="app-details-table-header" colspan="6">Licensed Status</td>
            </tr>
            <tr>
              <th class="aligned-column">Applied On</th>
              <th class="aligned-column">Licensed On</th>
              <th class="aligned-column">Current Status</th>
              <th class="aligned-column">Current Status Effective Date</th>
              <th class="aligned-column">Last Modified By</th>
              <th class="aligned-column">Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{firmAppDetailsCurrentLicensed?.AppliedOn | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentLicensed?.GrantedOn | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentLicensed?.RecentStatus}}</td>
              <td>{{firmAppDetailsCurrentLicensed?.RecentStatusDate | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentLicensed?.LastModifiedBy}}</td>
              <td>{{firmAppDetailsCurrentLicensed?.LastModifiedDate}}</td>
            </tr>
          </tbody>
        </table>

        <!-- Authorisation Status Table -->
        <table class="aligned-table" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
          <thead>
            <tr>
              <td class="app-details-table-header" colspan="6">Authorisation Status</td>
            </tr>
            <tr>
              <th class="aligned-column">Applied On</th>
              <th class="aligned-column">Authorised On</th>
              <th class="aligned-column">Current Status</th>
              <th class="aligned-column">Current Status Effective Date</th>
              <th class="aligned-column">Last Modified By</th>
              <th class="aligned-column">Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{firmAppDetailsCurrentAuthorized?.AppliedOn | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentAuthorized?.GrantedOn | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentAuthorized?.RecentStatus}}</td>
              <td>{{firmAppDetailsCurrentAuthorized?.RecentStatusDate | date: 'dd/MMM/y'}}</td>
              <td>{{firmAppDetailsCurrentAuthorized?.LastModifiedBy}}</td>
              <td>{{firmAppDetailsCurrentAuthorized?.LastModifiedDate}}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!--or (edit mode)-->
      <div class="edit-firms-inputs" *ngIf="isEditModeCore">
        <div class="input-field">
          <label for="dateOfApplication">
            Date of Application
          </label>
          <input name="dateOfApplication" id="dateOfApplication" type="text" #dateInputs
            (ngModelChange)="onDateOfApplicationChange($event)" [(ngModel)]="dateOfApplication"
            [ngClass]="{'error-border': errorMessages['DateOfApplication']}">
        </div>
        <div class="input-field">
          <label for="firmApplicationType">
            Firm Application Type
          </label>
          <select [ngClass]="{'select-background-edited': isEditModeCore}" name="firmApplicationType"
            id="firmApplicationType" [(ngModel)]="selectedFirmTypeID"
            (ngModelChange)="onFirmApplicationTypeChange($event)">
            <option *ngFor="let firmType of allFirmTypes" [value]="firmType.FirmApplTypeID">
              {{firmType.FirmApplTypeDesc}}</option>
          </select>
        </div>
        <div class="input-field">
          <label for="qfcLicenseStatus">
            QFC License Status
          </label>
          <select [ngClass]="{'select-background-edited': isEditModeCore}" name="qfcLicenseStatus" id="qfcLicenseStatus"
            [(ngModel)]="firmDetails.LicenseStatusTypeID" (ngModelChange)="onLicenseStatusChange($event)">
            <option *ngFor="let option of allQFCLicenseStatus" [value]="option.FirmApplStatusTypeID">{{
              option.FirmApplStatusTypeDesc }}
            </option>
          </select>
        </div>
        <div class="input-field">
          <label for="DateLicensed">
            {{firmDetails?.LicenseStatusTypeLabelDesc}}
          </label>
          <input name="DateLicensed" id="DateLicensed" type="text" #dateInputs
            [(ngModel)]="formattedLicenseApplStatusDate" [ngClass]="{'error-border': errorMessages['LicensedDate']}">
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="authorisationStatus">
            Authorisation Status
          </label>
          <select [ngClass]="{'select-background-edited': isEditModeCore}" name="authorisationStatus"
            id="authorisationStatus" [(ngModel)]="firmDetails.AuthorisationStatusTypeID"
            (ngModelChange)="onAuthorizedStatusChange($event)">
            <option *ngFor="let option of allAuthorisationStatus" [value]="option.FirmApplStatusTypeID">{{
              option.FirmApplStatusTypeDesc}}</option>
          </select>
        </div>
        <div class="input-field" *ngIf="selectedFirmTypeID == 3">
          <label for="dateAuthorized">
            {{firmDetails?.AuthorisationStatusTypeLabelDesc}}
          </label>
          <input name="dateAuthorized" id="dateAuthorized" type="text" #dateInputs
            [(ngModel)]="formattedAuthApplStatusDate" [ngClass]="{'error-border': errorMessages['AuthorisationDate']}">
        </div>
      </div>

    </div>
    <!---->
    <div class="inputs-field-set" *ngIf="isEditModeCore && selectedFirmTypeID == 3"
      [ngClass]="{collapsed: isCollapsed['pressReleaseSection']}">
      <div class="error-messages" style="color: red">
        <p *ngIf="errorMessages['uploadDocument']">{{ errorMessages['uploadDocument'] }}</p>
      </div>
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">Press Releases</h2>
        <button [ngClass]="{'hidden-button': !isEditModeCore}" class="collapse-button"
          (click)="toggleCollapse('pressReleaseSection')">
          {{ isCollapsed['pressReleaseSection'] ? '▲' : '▼'}}
        </button>
      </div>
      <div class="edit-firms-inputs">
        <div class="file-container">
          <div class="input-field">
            <label for="documentType">
              Document Type
            </label>
            <select [disabled]="!isEditModeCore" [ngClass]="{'select-background-edited': isEditModeCore}"
              class="document-type-select" name="documentType" id="documentType">
              <option value="263">Press Releases</option>
            </select>
          </div>

          <div id="uploaded-documents">Uploaded documents go here</div>

          <div class="btns-container">
            <div class="upload-container">
              <button class="choose-document-btn" (click)="selectDocument()">
                Choose Document
              </button>
            </div>
            <button class="upload-document-btn" (click)="uploadDocument()">Upload the Document</button>
          </div>
        </div>
        <div class="file-table-container">
          <table>
            <thead>
              <tr>
                <th>Document Type</th>
                <th>File Name</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Attachment</td>
                <td></td>
                <td><button style="display: none;" class="delete-file">Delete</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set comments" [ngClass]="{ collapsed: isCollapsed['commentsSection'] }">
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">Comments</h2>
        <button [ngClass]="{ 'hidden-button': !isEditModeCore }" class="collapse-button"
          (click)="toggleCollapse('commentsSection')">
          {{ isCollapsed["commentsSection"] ? "▲" : "▼" }}
        </button>
      </div>
      <div class="edit-firms-inputs">
        <div class="input-field">
          <label for="generalComments">
            <strong>General Comments:</strong>
          </label>
          <textarea [disabled]="!isEditModeCore" name="generalComments" id="generalComments"
            [(ngModel)]="firmDetails.FirmApplicationDataComments"></textarea>
        </div>
        <div class="input-field">
          <label for="publicRegisterComments">
            <strong>Public Register Comments:</strong>
          </label>
          <textarea [disabled]="!isEditModeCore" name="publicRegisterComments" id="publicRegisterComments"
            [(ngModel)]="firmDetails.PublicRegisterComments"></textarea>
        </div>
      </div>
    </div>

    <!---->
    <div class="inputs-field-set" [ngClass]="{collapsed: isCollapsed['addressesSection']}">
      <!--Error messages for addresses-->
      <div class="error-messages" style="color: red">
        <p *ngIf="errorMessages['AddressTypeID']">{{ errorMessages['AddressTypeID'] }}</p>
        <p *ngIf="errorMessages['DuplicatedAddressTypeID']">{{ errorMessages['DuplicatedAddressTypeID'] }}</p>
      </div>
      <div class="edit-firm-actions collapse-container">
        <h2 class="edit-firm-header">
          Addresses
        </h2>
        <button class="collapse-button" (click)="toggleCollapse('addressesSection')">
          {{ isCollapsed['addressesSection'] ? '▲' : '▼'}}
        </button>
      </div>
      <div class="add-address-container">
        <button *ngIf="isEditModeCore && canAddNewAddress" (click)="addNewAddress()"
          [hidden]="isCollapsed['addressesSection']" class="addAddressBtn">Add Address</button>
      </div>
      <div class="edit-firms-inputs">
        <ng-container *ngFor="let address of filteredFirmAddresses; let i = index">
          <ng-container *ngIf="address.Valid === true">
            <div class="input-field" *ngIf="!isEditModeCore">
              <label for="addressType">
                Address Type <button *ngIf="address.PreviousRecords !== 0" class="subbutton"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">History</button>
              </label>
              <input disabled name="addressType" id="addressType" type="text" value="{{address?.AddressTypeDesc}}">
            </div>
            <div *ngIf="isEditModeCore" class="del-address-container">
              <button (click)="removeAddress(i)" class="RmvAddressBtn bi-trash"></button>
            </div>
            <!-- address type on edit mode -->
            <div class="input-field" *ngIf="isEditModeCore">
              <label for="addressType">
                Address Type <button *ngIf="address.PreviousRecords !== 0 && address.AddressID" class="subbutton"
                  (click)="getAddressTypeHistory(address.AddressTypeID)">History</button>
              </label>
              <select [disabled]="!!address.AddressID" [(ngModel)]="address.AddressTypeID"
                (change)="onAddressTypeChange($event, address)"
                [ngClass]="{
                'error-border': !address.AddressID && errorMessages['AddressTypeID'] ,'select-background-edited': isEditModeCore}">
                <option value="0">Select</option>
                <option *ngFor="let option of allAddressTypes" [value]="option.AddressTypeID">
                  {{option.AddressTypeDesc}}</option>
              </select>
            </div>

            <div class="input-field" *ngIf="isEditModeCore && (!address.AddressID || address.AddressID === '')">
              <label for="sameAsType">
                Same As Type
              </label>
              <select [(ngModel)]="address.SameAsTypeID" (ngModelChange)="onSameAsTypeChange($event)" name="sameAsType"
                id="sameAsType" [ngClass]="{'select-background-edited': isEditModeCore}">
                <option value="0">Select</option>
                <option *ngFor="let type of existingAddresses" [value]="type.AddressTypeID">
                  {{type.AddressTypeDesc}}</option>
              </select>
            </div>

            <div class="input-field">
              <label for="addressLine1"> Address Line 1 </label>
              <input type="text" [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)"
                name="addressLine1" id="addressLine1" [(ngModel)]="address.AddressLine1" />
            </div>
            <div class="input-field">
              <label for="addressLine2"> Address Line 2 </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="addressLine2"
                id="addressLine2" type="text" [(ngModel)]="address.AddressLine2" />
            </div>
            <div class="input-field">
              <label for="addressLine3"> Address Line 3 </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="addressLine3"
                id="addressLine3" type="text" [(ngModel)]="address.AddressLine3" />
            </div>
            <div class="input-field">
              <label for="addressLine4"> Address Line 4 </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="addressLine4"
                id="addressLine4" type="text" [(ngModel)]="address.AddressLine4" />
            </div>
            <div class="input-field">
              <label for="city"> City </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="city" id="city"
                type="text" [(ngModel)]="address.City" />
            </div>
            <div class="input-field">
              <label for="state"> state/province </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="state"
                id="state" type="text" [(ngModel)]="address.Province" />
            </div>
            <div class="input-field" *ngIf="!isEditModeCore">
              <label for="country"> Country </label>
              <input disabled type="text" name="country" id="country" [(ngModel)]="address.CountryName" />
            </div>
            <!-- countries on edit mode-->
            <div class="input-field" *ngIf="isEditModeCore">
              <label for="country"> Country </label>
              <select [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)"
                [(ngModel)]="address.CountryID" [ngClass]="{
                  'select-background-edited': isEditModeCore
                }">
                <option *ngFor="let option of allCountries" [value]="option.CountryID">
                  {{ option?.CountryName }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="zip"> Zip/Postal Code </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="zip" id="zip"
                type="text" [(ngModel)]="address.PostalCode" />
            </div>
            <div class="input-field">
              <label for="phone"> Phone </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="phone"
                id="phone" type="text" [(ngModel)]="address.PhoneNum" />
            </div>
            <div class="input-field">
              <label for="fax"> Fax </label>
              <input [disabled]="!isEditModeCore || (disableAddressFields && !address.AddressID)" name="fax" id="fax"
                type="text" [(ngModel)]="address.FaxNum" />
            </div>
            <hr *ngIf="i < filteredFirmAddresses.length - 1" />
          </ng-container>
        </ng-container>
      </div>
    </div>
  </section>

  <!--Scope Section-->
  <section #scopeSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Scope ? 'flex' : 'none' }">
    <div class="licensed-section">
      <div class="licensed-header" (click)="toggleCollapse('LicensedSection')">
        Licensed
        <span class="arrow" [ngClass]="{
            down: !isCollapsed['LicensedSection'],
            up: isCollapsed['LicensedSection']
          }">{{ isCollapsed["LicensedSection"] ? "▲" : "▼" }}</span>
      </div>
      <div class="licensed-body" [ngClass]="{
          collapsed:
            isCollapsed['LicensedSection'] &&
            firmDetails?.AuthorisationStatusTypeID > 0
        }">
        <div class="inputs-field-set scopeFor">
          <!--Error messages for firm details-->
          <div class="error-messages" style="color: red">
            <p *ngIf="errorMessages['ScopeEffectiveDate']">{{ errorMessages['ScopeEffectiveDate'] }}</p>
            <p *ngIf="errorMessages['ScopeAppliedDate']">{{ errorMessages['ScopeAppliedDate'] }}</p>
            <p *ngIf="errorMessages['ScopeEffectiveDateLessThanApplicationDate']">{{
              errorMessages['ScopeEffectiveDateLessThanApplicationDate'] }}</p>
            <p *ngIf="errorMessages['ScopeAppliedDateLessThanFirmLicApplDate']">{{
              errorMessages['ScopeAppliedDateLessThanFirmLicApplDate'] }}</p>
            <p *ngIf="errorMessages['ActivityTypeIDCORRECTION']">{{ errorMessages['ActivityTypeIDCORRECTION'] }}</p>
          </div>
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">
              <small>Scope for</small> {{ firmDetails?.FirmName }}
            </h2>
            <div *ngIf="currentLicRevisionNumber === lastLicRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn"
                *ngIf="!hideEditBtn && getControlVisibility('imgBtnEdit') && ActivityLicensed[0].ScopeRevNum">
                <button [disabled]="!getControlEnablement('imgBtnEdit')" class="edit-btn" (click)="editLicenseScope()">
                  <i class="bi bi-pen"></i>Edit
                </button>
              </div>

              <div class="btn" *ngIf="!loading && !hideSaveBtn && getControlVisibility('imgBtnSave')">
                <button [disabled]="!getControlEnablement('imgBtnSave')" class="save-btn" (click)="saveLicenseScope()">
                  Save
                </button>
              </div>

              <div class="btn" *ngIf="!loading && !hideCancelBtn && getControlVisibility('imgBtnCancel')">
                <button [disabled]="!getControlEnablement('imgBtnCancel')" class="cancel-btn"
                  (click)="cancelEditLicScope()">
                  Cancel
                </button>
              </div>

              <div class="btn"
                *ngIf="!loading && !hideCreateBtn && getControlVisibility('imgBtnCreate') && !(ActivityLicensed[0].ScopeRevNum)">
                <button [disabled]="!getControlEnablement('imgBtnCreate')">
                  Create
                </button>
              </div>

              <div class="btn"
                *ngIf="!loading && !hideReviseBtn && getControlVisibility('imgBtnRevise') && showVaryBtn">
                <button [disabled]="!getControlEnablement('imgBtnRevise')">
                  Revise
                </button>
              </div>

              <div class="btn" *ngIf="!loading && !hideDeleteBtn && getControlVisibility('imgBtnDelete')">
                <button [disabled]="!getControlEnablement('imgBtnDelete')">
                  Delete
                </button>
              </div>
            </div>
          </div>
          <div class="edit-firms-inputs">
            <div style="width: 100%" class="input-field">
              <label for="formReff"> Form Reference </label>
              <!-- <input [disabled]="isEditModeLicense" [ngModel]="documentDetails.FileName"
                                name="formReff" id="formReff" type="text" value="" /> -->
              <!-- <a *ngIf="!isEditModeLicense" id="websiteLink"
                href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{documentDetails.Column3}}" target="_blank"
                rel="noopener noreferrer">
                {{documentDetails?.FileName}}
              </a> -->
            </div>
            <div style="width:100%" class="input-field">
              <label for="linkScope"> Link To Scope </label>
              <input *ngIf="isEditModeLicense" name="linkScope" id="linkScope" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeCertificateLink" />
              <a *ngIf="!isEditModeLicense" id="websiteLink" [href]="ActivityLicensed[0].ScopeCertificateLink"
                target="_blank" rel="noopener noreferrer">
                {{ActivityLicensed[0]?.ScopeCertificateLink}}
              </a>
            </div>
            <div class="input-field">
              <label for="scopeRevNum"> Scope Revision Number </label>
              <input disabled name="scopeRevNum" id="scopeRevNum" type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeRevNum" />
            </div>
            <div class="input-field">
              <!--label is changed based on scoperevnum-->
              <label for="q13AppDate" *ngIf="ActivityLicensed[0]?.ScopeRevNum > 1 && ActivityLicensed[0]?.ScopeRevNum">
                Q13 Application Date for revisions
              </label>
              <!--label is changed based on scoperevnum-->
              <label *ngIf="ActivityLicensed[0]?.ScopeRevNum == 1">Application Date</label>
              <input [disabled]="disableApplicationDate" name="appDate" id="appDate" #dateInputs type="text"
                [(ngModel)]="ActivityLicensed[0].ScopeAppliedDate" />
            </div>
            <div class="input-field">
              <label for="licenseDate"> Licensed Date </label>
              <input disabled name="licenseDate" id="licenseDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeLicensedDate }}" />
            </div>
            <div class="input-field"
              *ngIf="(ActivityLicensed[0].ScopeRevNum !== null || ActivityLicensed[0].ScopeRevNum !== '') && ActivityLicensed[0].ScopeRevNum > 1">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="!isEditModeLicense" disabled name="effectiveDate" id="effectiveDate" type="text"
                #dateInputs [(ngModel)]="ActivityLicensed[0].ScopeEffectiveDate"
                [ngClass]="{ 'error-border': errorMessages['ScopeEffectiveDate'] || errorMessages['ScopeEffectiveDateLessThanApplicationDate'] }" />
            </div>
            <div class="input-field">
              <label for="createdBy"> Created By </label>
              <input disabled name="createdBy" id="createdBy" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedByName }}" />
            </div>
            <div class="input-field">
              <label for="modBy"> Modified By </label>
              <input disabled name="modBy" id="modBy" type="text" value="{{ ActivityLicensed[0]?.ModifiedBy }}" />
            </div>
            <div class="input-field">
              <label for="modDate"> Modification Date </label>
              <input disabled name="modDate" id="modDate" type="text"
                value="{{ ActivityLicensed[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for="createdDate"> Creation Date </label>
              <input disabled name="createdDate" id="createdDate" type="text"
                value="{{ ActivityLicensed[0]?.ScopeCreatedDate }}" />
            </div>
            <div *ngIf="isEditModeLicense && !hideReviseBtn && showVaryBtn" class="vary-scope">
              <button (click)="varyLicenseScope()">Vary Scope</button>
            </div>
          </div>
          <div *ngIf="!isEditModeLicense && ActivityLicensed[0]?.ScopeRevNum" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getLicScopePreviousVersions(firmId,2)">View Previous
              Version</a>
          </div>
        </div>
        <!---->
        <div class="inputs-field-set">
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">Permitted Activities</h2>
          </div>

          <div class="scope-permitted-activity-header">
            <p>Activity</p>
          </div>

          <!-- View Mode License -->
          <div class="permitted-activity-body" *ngFor="let activityLic of ActivityLicensed">
            <ng-container *ngIf="!isEditModeLicense && activityLic.FirmScopeTypeID === 1">
              <p *ngIf="!isEditModeLicense">{{ activityLic?.ActivityTypeDesc }}</p>

              <strong>Activity Details: </strong>
              <div class="input-field conditions-textarea">
                <textarea disabled>{{activityLic?.FirmActivityDetails}}</textarea>
              </div>

              <strong>Specific Conditions and Restrictions: </strong>
              <div class="input-field conditions-textarea">
                <textarea disabled>{{ activityLic?.Column1 }}</textarea>
              </div>

            </ng-container>
          </div>
          <!-- Edit Mode License -->
          <div class="add-activity-container">
            <button *ngIf="isEditModeLicense" class="add-permitted-activity" (click)="addNewActivity()">
              Add Activity
            </button>
          </div>

          <div class="permitted-activity-body" *ngFor="let activityLic of ActivityLicensed; let i = index">
            <ng-container *ngIf="isEditModeLicense">
              <table *ngIf="isEditModeLicense">
                <tr>
                  <th style="width: 70%">Activity</th>
                  <th style="width: 30%">Action</th>
                  <th></th>
                </tr>

                <tr>
                  <td>
                    <div class="input-field">
                      <select name="activities" id="activities" [ngClass]="{
                      'select-background-edited': isEditModeLicense,'error-border': activityLic.ActivityTypeID == 0 && errorMessages['ActivityTypeID']
                    }" [(ngModel)]="activityLic.ActivityTypeID">
                        <option value="0">Select</option>
                        <option [value]="licensedActivity.ActivityTypeID"
                          *ngFor="let licensedActivity of licensedActivities">
                          {{ licensedActivity.ActivityTypeDesc }}
                        </option>
                      </select>
                    </div>
                  </td>
                  <td>
                    <div class="input-field">
                      <select
                        [disabled]="!((this.ActivityLicensed[0].ScopeRevNum > 1) && !(isNullOrEmpty(this.ActivityLicensed[0].ScopeRevNum)))"
                        [ngClass]="{'select-background-edited': isEditModeLicense}" name="action" id="action"
                        [(ngModel)]="activityLic.FirmScopeTypeID">
                        <option *ngFor="let firmScopeType of allFirmScopeTypes" [value]="firmScopeType.FirmScopeTypeID">
                          {{firmScopeType.FirmScopeTypeDesc}}</option>
                      </select>
                    </div>
                  </td>
                  <td>
                    <button class="rmvActivityLicBtn bi-trash" (click)="removeLicActivity(i)">
                    </button>
                  </td>
                </tr>
                <tr class="error-messages" style="color: red">
                  <p *ngIf="activityLic.ActivityTypeID == 0 && errorMessages['ActivityTypeID']">{{
                    errorMessages['ActivityTypeID'] }}</p>
                </tr>
              </table>

              <strong>Activity Details: </strong>
              <div class="input-field conditions-textarea">
                <textarea [(ngModel)]="activityLic.FirmActivityDetails">
              {{activityLic?.FirmActivityDetails}}
              </textarea>
              </div>
              <strong>Specific Conditions and Restrictions: </strong>
              <div class="input-field conditions-textarea">
                <textarea [(ngModel)]="activityLic.Column1">{{ activityLic?.Column1 }}</textarea>
              </div>
            </ng-container>
          </div>

          <div class="permitted-activity-container2">
            <div class="scope-permitted-activity-header">
              <p>General License Conditions or restrictions</p>
            </div>

            <div class="permitted-activity-body">
              <div class="input-field conditions-textarea">
                <textarea [disabled]="!isEditModeLicense"
                  [(ngModel)]="ActivityLicensed[0].GeneralConditions">{{ActivityLicensed?.GeneralConditions}}</textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!---->
    <div class="authorized-section" *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
      <div class="authorised-header" (click)="toggleCollapse('authorizeSection')">
        Authorised
        <span class="arrow" [ngClass]="{
            down: !isCollapsed['authorizeSection'],
            up: isCollapsed['authorizeSection']
          }">{{ isCollapsed["authorizeSection"] ? "▲" : "▼" }}</span>
      </div>
      <div class="authorized-body" [ngClass]="{ collapsed: isCollapsed['authorizeSection'] }">
        <div class="inputs-field-set scopeFor">
          <div class="edit-firm-actions">
            <h2 class="edit-firm-header">
              <small>Scope for</small> {{ firmDetails?.FirmName }}
            </h2>
            <div *ngIf="currentAuthRevisionNumber === lastAuthRevisionNumber" style="display: flex; gap: 10px">
              <div class="btn">
                <button class="edit-btn" (click)="editAuthScope()">
                  <i [class]="!isEditModeAuth ? 'bi bi-pen' : ''"></i>
                  {{ !isEditModeAuth ? "Edit" : "Save" }}
                </button>
              </div>

              <div class="btn">
                <button class="cancel-btn" *ngIf="isEditModeAuth" (click)="cancelEditAuthScope()">
                  Cancel
                </button>
              </div>
            </div>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="formReff"> Form Reference </label>
              <input disabled name="formReff" id="formReff" type="text" value="" />
            </div>
            <div style="width:100%" class="input-field">
              <label for=""> Link To Scope </label>
              <a *ngIf="!isEditModeAuth" id="websiteLink" [href]="ActivityAuth[0]?.ScopeCertificateLink" target="_blank"
                rel="noopener noreferrer">
                {{ActivityAuth[0]?.ScopeCertificateLink}}
              </a>
            </div>
            <div class="input-field">
              <label for=""> Scope Revision Number </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ScopeRevNum }}" />
            </div>
            <div class="input-field">
              <!--label is changed based on scoperevnum-->
              <label for="q13AppDate" *ngIf="ActivityAuth[0]?.ScopeRevNum > 1 && ActivityAuth[0]?.ScopeRevNum">
                Q13 Application Date for revisions
              </label>
              <!--label is changed based on scoperevnum-->
              <label *ngIf="ActivityAuth[0]?.ScopeRevNum == 1">Application Date</label>
              <input [disabled]="!isEditModeAuth" name="q13AppDate" id="q13AppDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.ScopeApplicationDate }}" />
            </div>
            <div class="input-field">
              <label for="incorporationDate"> Incorporation Date </label>
              <input disabled name="incorporationDate" id="incorporationDate" type="text"
                value="{{ firmDetails?.DateOfIncorporation }}" />
            </div>
            <div class="input-field">
              <label for="authorisedDate"> Authorised Date </label>
              <input disabled name="authorisedDate" id="authorisedDate" type="text"
                value="{{ ActivityAuth[0]?.ScopeLicensedOrAuthorisedDate }}" />
            </div>
            <div class="input-field"
              *ngIf="(ActivityAuth[0].ScopeRevNum !== null || ActivityAuth[0].ScopeRevNum !== '') && ActivityAuth[0].ScopeRevNum > 1">
              <label for="effectiveDate"> Effective Date </label>
              <input [disabled]="!isEditModeAuth" name="effectiveDate" id="effectiveDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.ScopeEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for=""> Created By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.CreatedByName }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified By </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.ModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for=""> Last Modified Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.LastModifiedDate }}" />
            </div>
            <div class="input-field">
              <label for=""> Creation Date </label>
              <input disabled name="" id="" type="text" value="{{ ActivityAuth[0]?.CreatedDate }}" />
            </div>
            <div [hidden]="!isEditModeAuth" class="vary-scope">
              <button>Vary Scope</button>
            </div>
          </div>
          <div *ngIf="!isEditModeAuth" class="view-prev-version-container">
            <a class="view-prev-version" (click)="getAuthScopePreviousVersions(firmId,3)">View Previous
              Version</a>
          </div>
        </div>

        <!--Scope of Authorization-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['scopeOfAuthorization'] }">
          <div class="section">
            <div class="edit-firm-actions collapse-container">
              <h2 class="edit-firm-header">Scope of Authorisation</h2>
              <button class="collapse-button" (click)="toggleCollapse('scopeOfAuthorization')">
                {{ isCollapsed["scopeOfAuthorization"] ? "▲" : "▼" }}
              </button>
            </div>
            <div class="edit-firms-inputs">
              <table class="scope-of-auth">
                <thead>
                  <tr>
                    <th>Document Type</th>
                    <th>File Name</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{AuthTableDocument?.DocSubTypeDesc}}</td>
                    <td><a href="https://qfcra365.sharepoint.com/sites/FIRMSUAT/{{AuthTableDocument?.FileLoc}}"
                        target="_blank">{{AuthTableDocument?.FileName}}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!--Regulated Activities-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['regulatedActivitiesSection'] }">
          <div class="section">
            <div class="edit-firm-actions collapse-container">
              <h2>Regulated Activities</h2>
              <button class="collapse-button" (click)="toggleCollapse('regulatedActivitiesSection')">
                {{ isCollapsed["regulatedActivitiesSection"] ? "▲" : "▼" }}
              </button>
            </div>
            <div class="regulated-activities-container">
              <div *ngFor="let activity of ActivityAuth">
                <div class="regulated-activities-header" *ngIf="!isEditModeAuth">
                  <p>
                    Category : <strong>{{ activity?.CategoryDescription }}</strong>
                  </p>
                  <p>
                    Activity : <strong>{{ activity?.ActivityTypeDescription }}</strong>
                  </p>
                </div>
                <!--on edit mode-->
                <div class="regulated-activities-header" *ngIf="isEditModeAuth">
                  <div class="category-select">
                    <label for="category" style="display: flex; gap: 5px">
                      Category <span style="color: red">*</span>:
                    </label>
                    <select [(ngModel)]="activity.selectedCategory" (ngModelChange)="onCategoryChange(activity)"
                      name="category" id="category">
                      <!-- <option value="" disabled>Select</option> -->
                      <option *ngFor="let category of activityCategories" [ngValue]="category">
                        {{ category.ActivityCategoryDesc }}
                      </option>
                    </select>
                  </div>

                  <div class="activity-select">
                    <label for="activity" style="display: flex; gap: 5px">
                      Activity <span style="color: red">*</span>:
                    </label>
                    <select [(ngModel)]="activity.selectedActivity" name="activity" id="activity">
                      <option *ngFor="let activity of activity.activities" [ngValue]="activity">
                        {{ activity.ActivityTypeDesc }}
                      </option>
                    </select>
                  </div>
                </div>
                <!---->

                <!-- Display categorized products -->
                <div *ngIf="activity?.categorizedProducts?.length > 0">
                  <div *ngFor="let category of activity.categorizedProducts">
                    <!-- Display Main Category -->
                    <h4>{{ category.mainCategory }}</h4>

                    <!-- Display Sub Products -->
                    <ul style="margin-left: 40px">
                      <li *ngFor="let subProduct of category.subProducts">
                        {{ subProduct.productTypeDescription }}
                      </li>
                    </ul>
                  </div>
                </div>

                <!--on Edit mode-->
                <table class="regulated-activity-table" *ngIf="isEditModeAuth">
                  <thead>
                    <tr>
                      <th>Product(s)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!--integration loop will be inside this tr for products-->
                    <tr *ngFor="let product of activity.products">
                      <td>
                        <label>
                          <input type="checkbox" /> {{ product.mainCategory }}
                        </label>

                        <table class="nested-table">
                          <tbody>
                            <tr *ngFor="let subCategory of product.subCategories">
                              <td>
                                <label>
                                  <input type="checkbox" />
                                  {{ subCategory.ProductCategoryTypeDesc }}
                                </label>
                              </td>
                              <td>
                                <select class="action-column" name="action">
                                  <option value="1">Add</option>
                                  <option value="2">Withdrawal</option>
                                  <option value="3">Discontinue</option>
                                </select>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <!--specific conditions and restrictions-->
                <div class="specific-conditions-and-restrictions">
                  <div class="specific-conditions-and-restrictions-header">
                    <p>Specific Conditions and Restrictions</p>
                  </div>

                  <p>
                    &nbsp;&nbsp;&nbsp;&nbsp;{{ activity?.specificCondition }}
                  </p>
                </div>
              </div>
              <!--Conditions and Restrictions-->
              <div class="conditions-and-restrictions-section">
                <div class="conditions-and-restrictions-header">
                  <p>Conditions and Restrictions</p>
                </div>
                <p>
                  <strong>Retail Restriction</strong> &nbsp;&nbsp;
                  <input disabled type="checkbox" />
                </p>

                <p>
                  <strong>General Authorisation Conditions or Restrictions</strong>
                </p>
                <div class="input-field conditions-textarea">
                  <textarea disabled value="{{ ActivityAuth[0]?.GeneralConditions }}"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Islamic Finance-->
        <div class="inputs-field-set" *ngIf="
            (firmDetails?.AuthorisationStatusTypeID > 0 &&
              islamicFinance?.IFinTypeId) ||
            isEditModeAuth
          " [ngClass]="{ collapsed: isCollapsed['islamicFinanceSection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Islamic Finance</h2>
            <button class="collapse-button" (click)="toggleCollapse('islamicFinanceSection')">
              {{ isCollapsed["islamicFinanceSection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field" *ngIf="!isEditModeAuth">
              <label for="isIslamicFinanceExist"> Islamic Finance </label>
              <input disabled name="isIslamicFinanceExist" id="isIslamicFinanceExist" type="text"
                [value]="islamicFinance?.IFinTypeId !== null ? 'Yes' : 'No'" />
            </div>
            <!-- or -->
            <div class="input-field" *ngIf="isEditModeAuth">
              <div style="display: flex; gap: 15px">
                <label for="isIslamicFinanceExist"> Islamic Finance </label>
                <input style="width: 15px" type="checkbox" name="isIslamicFinanceExist" id="isIslamicFinanceExist"
                  [checked]="islamicFinance?.IFinTypeId ? true : false" [(ngModel)]="isIslamicFinanceChecked" />
              </div>
            </div>
            <div class="input-field">
              <label for="islamicFinanceType"> Type </label>
              <select [disabled]="
                  !isIslamicFinanceChecked || !isEditModeAuth
                " name="islamicFinanceType" id="islamicFinanceType" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }" [(ngModel)]="islamicFinance.IFinTypeId">
                <option value="0">Select</option>
                <option value="1">Islamic Institution</option>
                <option value="2">Islamic Window</option>
              </select>
            </div>

            <div class="input-field endorsement">
              <label for="endorsement"> Endorsement </label>
              <textarea [disabled]="
                  !isIslamicFinanceChecked || !isEditModeAuth
                " name="islamicEndorsement" id="endorsement" [(ngModel)]="islamicFinance.Endorsement"></textarea>
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ islamicFinance?.IFinLastModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modified Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ islamicFinance?.LastModifiedDate }}" />
            </div>
          </div>
        </div>

        <!--Prudential Category-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialCategorySection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Prudential Category</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialCategorySection')">
              {{ isCollapsed["prudentialCategorySection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="prudentialCategory"> Prudential Category </label>
              <select [disabled]="!isEditModeAuth" name="prudentialCategory" id="prudentialCategory"
                [(ngModel)]="ActivityAuth[0].PrudentialCategoryTypeID"
                (ngModelChange)="onPrudentialCategoryChange($event)" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option value="0">Select</option>
                <option *ngFor="let option of allPrudentialCategoryTypes" [value]="option.PrudentialCategoryTypeID">
                  {{ option?.PrudentialCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="authorisationCategory">
                Authorisation Category
              </label>
              <select [disabled]="!isEditModeAuth" name="prudentialCategory" id="prudentialCategory"
                [(ngModel)]="ActivityAuth[0].AuthorisationCategoryTypeID" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option *ngFor="let option of allAuthorisationCategoryTypes"
                  [value]="option?.AuthorisationCategoryTypeID">
                  {{ option?.AuthorisationCategoryTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate"> Effective Date <span *ngIf="isEditModeAuth" style="color:red">*</span></label>
              <input [disabled]="!isEditModeAuth" name="effectiveDate" id="effectiveDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.PrudentialCategoryEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ ActivityAuth[0]?.PrudentialCategoryLastModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.LastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="isEditModeAuth">
              <thead>
                <tr>
                  <th>Prudential Category</th>
                  <th>Authorisation Category</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ ActivityAuth[0]?.PrudentialCategoryTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.AuthorisationCategoryTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.PrudentialCategoryEffectiveDate }}</td>
                  <td></td>
                  <!--Expiration Date does exist -->
                  <td>{{ ActivityAuth[0]?.PrudentialModifiedByName }}</td>
                  <td>
                    {{ ActivityAuth[0]?.PrudentialCategoryLastModifiedDate }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!--Prudential Return Type / Sector-->
        <div class="inputs-field-set" [ngClass]="{ collapsed: isCollapsed['prudentialReturnTypeSection'] }">
          <div class="edit-firm-actions collapse-container">
            <h2 class="edit-firm-header">Prudential Return Type</h2>
            <button class="collapse-button" (click)="toggleCollapse('prudentialReturnTypeSection')">
              {{ isCollapsed["prudentialReturnTypeSection"] ? "▲" : "▼" }}
            </button>
          </div>
          <div class="edit-firms-inputs">
            <div class="input-field">
              <label for="prudentialReturnType"> Prudential Return Type <span *ngIf="isEditModeAuth"
                  style="color:red">*</span></label>
              <select [disabled]="!isEditModeAuth" [(ngModel)]="ActivityAuth[0].SectorTypeID"
                name="prudentialReturnType" id="prudentialReturnType" [ngClass]="{
                  'select-background-edited': isEditModeAuth
                }">
                <option value="0">Select</option>
                <option *ngFor="let PrudReturnTypes of prudReturnTypesDropdown" [value]="PrudReturnTypes.SectorTypeID">
                  {{ PrudReturnTypes?.SectorTypeDesc }}
                </option>
              </select>
            </div>
            <div class="input-field">
              <label for="effectiveDate"> Effective Date <span *ngIf="isEditModeAuth" style="color:red">*</span></label>
              <input [disabled]="!isEditModeAuth" name="effectiveDate" id="effectiveDate" type="text" #dateInputs
                value="{{ ActivityAuth[0]?.SectorEffectiveDate }}" />
            </div>
            <div class="input-field">
              <label for="lastModifiedBy"> Last Modified By </label>
              <input disabled name="lastModifiedBy" id="lastModifiedBy" type="text"
                value="{{ ActivityAuth[0]?.SectorLastModifiedByName }}" />
            </div>
            <div class="input-field">
              <label for="lastModificationDate"> Last Modification Date </label>
              <input disabled name="lastModificationDate" id="lastModificationDate" type="text"
                value="{{ ActivityAuth[0]?.SectorLastModifiedDate }}" />
            </div>

            <table class="prudentialTable" [hidden]="isEditModeAuth">
              <thead>
                <tr>
                  <th>Prudential Return Type</th>
                  <th>Effective Date</th>
                  <th>Expiration Date</th>
                  <th>Last Modified By</th>
                  <th>Last Modified Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{ ActivityAuth[0]?.SectorTypeDesc }}</td>
                  <td>{{ ActivityAuth[0]?.SectorEffectiveDate }}</td>
                  <td></td>
                  <td>{{ ActivityAuth[0]?.SectorModifiedByName }}</td>
                  <td>{{ ActivityAuth[0]?.SectorLastModifiedDate }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--Controllers-->
  <section #controllerSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Controller ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="edit-firm-actions">
          <h2>Controllers For {{ firmDetails?.FirmName }}</h2>
          <div class="btn">
            <button (click)="createController()">
              <i class="bi bi-pen"></i>
              Create
            </button>
          </div>
        </div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let controller of FIRMControllers" (click)="openControllerPopup(controller)">
              <td>{{ controller.OtherEntityName }}</td>
              <td>{{ controller.EntityTypeDesc }}</td>
              <td>{{ controller.RegisteredNum }}</td>
              <td>{{ controller.ControllerControlTypeDesc }}</td>
              <td>{{ controller.PctOfShares }}</td>
              <td>{{ controller.AssnDateFrom }}</td>
              <td>{{ controller.AssnDateTo }}</td>
              <td>{{ controller.LastModifiedByOfOtherEntities }}</td>
              <td>{{ controller.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Ultimate Beneficial Owners For {{ firmDetails?.FirmName }}</h2>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Controller Type</th>
              <th>Registered Number</th>
              <th>Control Type</th>
              <th>% of Holding</th>
              <th>Effective Date</th>
              <th>Cessation Date</th>
              <th>Last Modified By</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody *ngIf="FIRMControllersIndividual?.length > 0; else noRecords">
            <tr *ngFor="let controller of FIRMControllersIndividual" (click)="viewController()">
              <td>{{ controller.OtherEntityName }}</td>
              <td>{{ controller.EntityTypeDesc }}</td>
              <td>{{ controller.RegisteredNum }}</td>
              <td>{{ controller.ControllerControlTypeDesc }}</td>
              <td>{{ controller.PctOfShares }}</td>
              <td>{{ controller.AssnDateFrom }}</td>
              <td>{{ controller.AssnDateTo }}</td>
              <td>{{ controller.LastModifiedByOfOtherEntities }}</td>
              <td>{{ controller.LastModifiedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #noRecords>
        <p> ---- No records found.</p>
      </ng-template>
    </div>

    <!-- Popup Section -->
    <!-- Popup Section -->
    <div *ngIf="isPopupOpen" (click)="closeControllerPopup()"
      style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(253, 236, 236, 0.2); display: flex; justify-content: center; align-items: center; z-index: 1000;">
      <div (click)="$event.stopPropagation()"
        style="background-color: #ffffff; padding: 15px; border-radius: 10px; width: 70%; height: 60%; box-shadow:0 0 10px rgba(146, 146, 146, 0.1); position: relative; display: flex; flex-direction: column; justify-content: space-between;">
        <!-- Title -->
        <h3
          style="margin-top: 0; color: #8b152b; font-size: 1.3em; text-align: left; border-bottom: 2px solid #a51e36; padding-bottom: 5px;">
          Controller Details For {{ selectedController?.OtherEntityName }}
        </h3>

        <!-- Form -->
        <form style="flex: 1; overflow-y: auto;">
          <ng-container *ngIf="isEditable">
            <div style="display: flex; gap: 20px; margin-bottom: 5px;">
              <div style="flex: 1;">
                <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Controller Type
                  :</label>
                <input [(ngModel)]="selectedController.EntityTypeDesc" name="ControllerType" readonly
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </div>
            </div>
          </ng-container>
          <!-- Contact Details Row 1 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Full Name of
                Entity:</label>
              <input [(ngModel)]="selectedController.OtherEntityName" name="fullName" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Legal
                Status:</label>
              <ng-container *ngIf="isEditable; else legalStatusInput">
                <select [(ngModel)]="selectedController.LegalStatusTypeDesc" name="legalStatus"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;">
                  <option *ngFor="let status of legalStatusOptionsEdit" [value]="status.LegalStatusTypeID">{{
                    status.LegalStatusTypeDesc }}</option>
                </select>
              </ng-container>
              <ng-template #legalStatusInput>
                <input [(ngModel)]="selectedController.LegalStatusTypeDesc" name="legalStatus" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Registered
                Number:</label>
              <input [(ngModel)]="selectedController.RegisteredNum" name="registeredNum" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
          </div>

          <!-- Contact Details Row 2 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Place of
                Establishment:</label>
              <ng-container *ngIf="isEditable; else placeOfEstablishmentInput">
                <select [(ngModel)]="selectedController.PlaceOfEstablishment" name="placeOfEstablishment"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;">
                  <option *ngFor="let place of countryOptionsEdit" [value]="place.CountryID">{{ place.CountryName }}
                  </option>
                </select>
              </ng-container>
              <ng-template #placeOfEstablishmentInput>
                <input [(ngModel)]="selectedController.PlaceOfEstablishment" name="placeOfEstablishment"
                  [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Type of
                Control:</label>
              <ng-container *ngIf="isEditable; else controlTypeInput">
                <select [(ngModel)]="selectedController.ControllerControlTypeDesc" name="typeOfControl"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;">
                  <option *ngFor="let controlType of controlTypeOptionsEdit"
                    [value]="controlType.ControllerControlTypeID">{{ controlType.ControllerControlTypeDesc }}</option>
                </select>
              </ng-container>
              <ng-template #controlTypeInput>
                <input [(ngModel)]="selectedController.ControllerControlTypeDesc" name="typeOfControl"
                  [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <ng-container *ngIf="selectedController.ControllerControlTypeDesc == 'Percentage' ">
              <div style="flex: 1;">
                <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">% of Holding
                  :</label>
                <input [(ngModel)]="selectedController.PctOfShares" name="cessationDate" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
              </div>
            </ng-container>
          </div>
          <!-- Contact Details Row 3 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Effective
                Date:</label>
              <ng-container *ngIf="isEditable; else effectiveDateInput">
                <input type="date" [(ngModel)]="selectedController.EffectiveDate" name="effectiveDate"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;" />
              </ng-container>
              <ng-template #effectiveDateInput>
                <input [(ngModel)]="selectedController.EffectiveDate" name="effectiveDate" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Is The Company
                Regulated:</label>
              <ng-container *ngIf="isEditable; else regulatedValue">
                <div style="display: flex; align-items: center;">
                  <input type="radio" id="regulatedYes" [(ngModel)]="selectedController.IsCompanyRegulated"
                    name="isCompanyRegulated" [value]="true" style="margin-right: 10px; cursor: pointer;" />
                  <label for="regulatedYes" style="margin-left: 5px; color: #413b3c;">Yes</label>

                  <input type="radio" id="regulatedNo" [(ngModel)]="selectedController.IsCompanyRegulated"
                    name="isCompanyRegulated" [value]="false"
                    style="margin-left: 20px; margin-right: 10px; cursor: pointer;" />
                  <label for="regulatedNo" style="margin-left: 5px; color: #413b3c;">No</label>
                </div>
              </ng-container>
              <ng-template #regulatedValue>
                <span style="margin-left: 10px; color: #413b3c;">
                  {{ selectedController.IsCompanyRegulated ? 'Yes' : 'No' }}
                </span>
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Cessation
                Date:</label>
              <ng-container *ngIf="isEditable; else cessationDateInput">
                <input type="date" [(ngModel)]="selectedController.CessationDate" name="cessationDate"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;" />
              </ng-container>
              <ng-template #cessationDateInput>
                <input [(ngModel)]="selectedController.CessationDate" name="cessationDate" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
          </div>
          <!-- Addresses Section -->
          <h3
            style="margin-top: 20px; color: #8b152b; font-size: 1.3em; text-align: left; border-bottom: 2px solid #a51e36; padding-bottom: 5px;">
            Addresses
          </h3>

          <!-- Address Details -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Address
                Type:</label>
              <ng-container *ngIf="isEditable; else addressTypeInput">
                <select [(ngModel)]="selectedController.AddressType" name="addressType"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;">
                  <option *ngFor="let type of addressTypeOptionsEdit" [value]="type.AddressTypeID">{{
                    type.AddressTypeDesc }}</option>
                </select>
              </ng-container>
              <ng-template #addressTypeInput>
                <input [(ngModel)]="selectedController.AddressType" name="addressType" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Address - Line
                1:</label>
              <input name="addressLine1" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Address - Line
                2:</label>
              <input name="addressLine2" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
          </div>

          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label
                style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">State/Province:</label>
              <input name="stateProvince" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Country:</label>
              <ng-container *ngIf="isEditable; else countryInput">
                <select [(ngModel)]="selectedController.Country" name="country"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c; cursor: pointer;">
                  <option *ngFor="let country of countryOptionsEdit" [value]="country.CountryID">{{ country.CountryName
                    }}</option>
                </select>
              </ng-container>
              <ng-template #countryInput>
                <input [(ngModel)]="selectedController.Country" name="country" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa; color: #413b3c;" />
              </ng-template>
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">City:</label>
              <input name="city" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
          </div>

          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Zip/Postal
                Code:</label>
              <input name="zipPostalCode" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
            </div>
          </div>
          <ng-container *ngIf="!isEditable || (isEditable && selectedController.IsCompanyRegulated)">
            <h3
              style="margin-top: 20px; color: #8b152b; font-size: 1.3em; text-align: left; border-bottom: 2px solid #a51e36; padding-bottom: 5px;">
              Home State Regulators
            </h3>

            <div style="display: flex; gap: 20px; margin-bottom: 10px;">
              <div style="flex: 1;">
                <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Regulator:</label>
                <input [(ngModel)]="homeRegulater.RegulatorName" name="regulator" [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
              </div>
              <div style="flex: 1;">
                <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #413b3c;">Regulator
                  Contact:</label>
                <input [(ngModel)]="selectedController.RegulatorContact" name="regulatorContact"
                  [readonly]="!isEditable"
                  style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #c2c2c2; background-color: #fffafa;" />
              </div>
            </div>
          </ng-container>
        </form>

        <!-- Save and Cancel Buttons -->
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" (click)="deleteController()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Delete
          </button>
          <button type="button" (click)="editController()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Edit
          </button>
          <ng-container *ngIf="isEditable">
            <button type="button" (click)="saveControllerPopupChanges()"
              style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
              Save
            </button>
            <button type="button" (click)="closeControllerPopup()"
              style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
              Cancel
            </button>
          </ng-container>
        </div>
      </div>
    </div>

  </section>


  <!--Auditors-->
  <section #auditorSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Auditor ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="auditor-header">
          <h2>Auditors For {{ firmDetails?.FirmName }}</h2>
          <div class="btn">
            <button (click)="createAuditor()">
              <i class="bi bi-plus"></i>
              Create
            </button>
            <button (click)="editAuditor()">
              <i class="bi bi-pen"></i>
              Edit
            </button>
            <!--popup message for edit-->

            <button>
              <i class="bi bi-trash"></i>
              Delete
            </button>
          </div>
        </div>
        <span class="inactive-auditors">
          <input id="InactiveAuditors" type="checkbox" />
          <label>Display Inactive Auditors</label>
        </span>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Auditor Name</th>
              <th>Auditor Type</th>
              <th>Effective From Date</th>
              <th>Effective To Date</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let auditor of FIRMAuditors">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="auditor" #auditorRadio />
                  <span></span>
                </label>
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.OtherEntityName }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.EntitySubTypeDesc }}
              </td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateFrom }}</td>
              <td (click)="viewAuditor(auditor)">{{ auditor.AssnDateTo }}</td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastMeodifiedBy }}
              </td>
              <td (click)="viewAuditor(auditor)">
                {{ auditor.LastModifiedDate }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!--view auditor-->
    <div class="inputs-field-set" *ngIf="IsViewAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
      </div>
      <div class="view-auditor-inputs">
        <div class="input-field">
          <label for="auditorName"> Auditor Name </label>
          <input disabled name="auditorName" id="auditorName" type="text"
            value="{{ selectedAuditor.OtherEntityName }}" />
        </div>
        <div class="input-field">
          <label for="auditorType"> Auditor Type </label>
          <input disabled name="auditorType" id="auditorType" type="text"
            value="{{ selectedAuditor.EntitySubTypeDesc }}" />
        </div>
        <div class="input-field">
          <label for="address2"> Effective From Date </label>
          <input disabled name="effectiveFromDate" id="effectiveFromDate" type="text"
            value="{{ selectedAuditor.AssnDateFrom }}" />
        </div>
        <div class="input-field">
          <label for="effectiveToDate"> Effective To Date </label>
          <input disabled name="effectiveToDate" id="effectiveToDate" type="text"
            value="{{ selectedAuditor.AssnDateTo }}" />
        </div>
      </div>
    </div>
    <!--create auditor-->
    <div class="inputs-field-set" *ngIf="IsCreateAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
        <div class="btn">
          <button class="save-btn">Save</button>
        </div>
      </div>
      <form>
        <div class="view-auditor-inputs">
          <div class="input-field">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <select name="auditorName" id="auditorName" [(ngModel)]="selectedAuditorNameFromSelectBox">
              <option value="select">Select</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="input-field" *ngIf="selectedAuditorNameFromSelectBox === 'other'">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <input type="text" />
          </div>
          <div class="input-field">
            <label for="auditorType">
              Auditor Type <span style="color: red">*</span>
            </label>
            <select name="auditorType" id="auditorType">
              <option value="select">Select</option>
            </select>
          </div>
          <div class="input-field">
            <label for="address2">
              Effective From Date <span style="color: red">*</span>
            </label>
            <input name="effectiveFromDate" id="effectiveFromDate" type="date" />
          </div>
          <div class="input-field">
            <label for="effectiveToDate"> Effective To Date </label>
            <input name="effectiveToDate" id="effectiveToDate" type="date" />
          </div>
        </div>
      </form>
    </div>

    <!--edit auditor-->
    <div class="inputs-field-set" *ngIf="IsEditAuditorVisible">
      <div class="view-auditor-actions">
        <h2 class="view-auditor-header">Auditor Details</h2>
        <div class="btn">
          <button class="save-btn">Save</button>
        </div>
      </div>
      <form>
        <div class="view-auditor-inputs">
          <div class="input-field">
            <label for="auditorName">
              Auditor Name <span style="color: red">*</span>
            </label>
            <select disabled name="auditorName" id="auditorName" [(ngModel)]="selectedAuditorNameFromSelectBox"
              value="{{ selectedAuditor.OtherEntityName }}">
              <option value="select">Select</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="input-field">
            <label for="auditorType">
              Auditor Type <span style="color: red">*</span>
            </label>
            <select name="auditorType" id="auditorType">
              <option value="select">Select</option>
            </select>
          </div>
          <div class="input-field">
            <label for="address2">
              Effective From Date <span style="color: red">*</span>
            </label>
            <input name="effectiveFromDate" id="effectiveFromDate" type="date" />
          </div>
          <div class="input-field">
            <label for="effectiveToDate"> Effective To Date </label>
            <input name="effectiveToDate" id="effectiveToDate" type="date" />
          </div>
        </div>
      </form>
    </div>
  </section>

  <!--Contacts-->
  <!-- <section id="Contacts" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="contacts-header">
          <h2>Contacts For</h2>
          <span>
            <input id="InactiveContacts" type="checkbox" />
            <label>Display Inactive Contacts</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty
              <th>Name</th>
              <th>Contact Type</th>
              <th>Contact Form</th>
              <th>Position/Job Title</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of FIRMContacts">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="contact" />
                  <span></span>
                </label>
              </td>
              <td>{{ contact.FullName }}</td>
              <td>{{ contact.ContactTypeDesc }}</td>
              <td>{{ contact?.ContactMethodTypeDesc }}</td>
              <td>{{ contact.JobTitle }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section> -->
  <!-- <section id="Contacts" class="edit-firm-section" [ngStyle]="{ width: dataWidth }" style="display: none">
    <div class="inputs-field-set">
      <div class="section">
        <div class="contacts-header">
          <h2>Contacts For {{ firmDetails?.FirmName }}</h2>
          <span>
            <input id="InactiveContacts" type="checkbox" />
            <label>Display Inactive Contacts</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Name</th>
              <th>Contact Type</th>
              <th>Contact Form</th>
              <th>Position/Job Title</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of FIRMContacts" (click)="onRowClick(contact)">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="contact" />
                  <span></span>
                </label>
              </td>
              <td>{{ contact.FullName }}</td>
              <td>{{ contact.ContactTypeDesc }}</td>
              <td>{{ contact?.ContactMethodTypeDesc }}</td>
              <td>{{ contact.JobTitle }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  
    <!- Popup 
    <div *ngIf="isPopupVisible" (click)="closeContactPopup()" 
      style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 242, 242, 0.2); display: flex; justify-content: center; align-items: center; z-index: 1000;">
      
      <div (click)="$event.stopPropagation()" 
        style="background-color: #ffffff; padding: 20px; border-radius: 15px; max-width: 700px; width: 90%; position: relative; border: 2px solid #6b0000;">
        
        <!- Edit Button 
        <button type="button" (click)="enableEditing()" 
          style="position: absolute; top: 10px; right: 10px; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; background-color: #cc0000; color: white; font-size: 0.9em;">
          Edit
        </button>
  
        <h3 style="margin-top: 0; color: #cc0000; text-align: center; font-size: 1.5em; border-bottom: 2px solid #cc0000; padding-bottom: 10px;">Contact Details</h3>
        
        <form style="margin-top: 10px;">
          <div style="display: flex; gap: 20px; margin-bottom: 10px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #990000;">Name:</label>
              <input [(ngModel)]="selectedContact.FullName" name="fullName" [readonly]="!isEditable"
                style="width: 85%; padding: 10px; border-radius: 5px; border: 1px solid #cc0000; font-size: 1em; background-color: #ffe6e6; color: #990000;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #990000;">Contact Type:</label>
              <input [(ngModel)]="selectedContact.ContactTypeDesc" name="contactType" [readonly]="!isEditable"
                style="width: 85%; padding: 10px; border-radius: 5px; border: 1px solid #cc0000; font-size: 1em; background-color: #ffe6e6; color: #990000;" />
            </div>
          </div>
          
          <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #990000;">Contact Form:</label>
              <input [(ngModel)]="selectedContact.ContactMethodTypeDesc" name="contactForm" [readonly]="!isEditable"
                style="width: 85%; padding: 10px; border-radius: 5px; border: 1px solid #cc0000; font-size: 1em; background-color: #ffe6e6; color: #990000;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #990000;">Position/Job Title:</label>
              <input [(ngModel)]="selectedContact.JobTitle" name="jobTitle" [readonly]="!isEditable"
                style="width: 85%; padding: 10px; border-radius: 5px; border: 1px solid #cc0000; font-size: 1em; background-color: #ffe6e6; color: #990000;" />
            </div>
          </div>
          
          <div style="margin-top: 30px; display: flex; justify-content: space-between;">
            <button type="button" (click)="saveContactPopupChanges()" 
              style="padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; background-color: #cc0000; color: white; font-size: 1em;">
              Save
            </button>
            <button type="button" (click)="closeContactPopup()" 
              style="padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; background-color: #cc0000; color: #fdfcfc; font-size: 1em;">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </section> -->
  <section #contactsSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Contatcs ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="contacts-header">
          <h2>Contacts For {{ firmDetails?.FirmName }}</h2>
          <span class="enhanced-checkbox">
            <input id="InactiveContacts" type="checkbox" (change)="onInactiveContactsToggle($event)" />
            <label for="InactiveContacts">Display Inactive Contacts</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Contact Type</th>
              <th>Contact Form</th>
              <th>Position/Job Title</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of filteredContacts" (click)="onRowClick(contact)">
              <td>{{ contact.FullName }}</td>
              <td>{{ contact.ContactTypeDesc }}</td>
              <td>{{ contact?.ContactMethodTypeDesc }}</td>
              <td>{{ contact.JobTitle }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Popup -->
    <div *ngIf="isPopupVisible" (click)="closeContactPopup()"
      style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(253, 236, 236, 0.2); display: flex; justify-content: center; align-items: center; z-index: 1000;">

      <div (click)="$event.stopPropagation()"
        style="background-color: #ffffff; padding: 15px; border-radius: 10px; width: 70%; height: 60%; box-shadow:0 0 10px rgba(146, 146, 146, 0.1); position: relative; display: flex; flex-direction: column; justify-content: space-between;">

        <!-- Title -->
        <h3
          style="margin-top: 0; color: #a51e36; font-size: 1.3em; text-align: left; border-bottom: 2px solid #a51e36; padding-bottom: 5px;">
          Contact Details For {{selectedContact.FirstName}}-{{selectedContact.FamilyName}}
        </h3>

        <!-- Form -->
        <form style="flex: 1; overflow-y: auto;">

          <!-- Contact Details Row 1 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Contact
                From:</label>
              <input [(ngModel)]="selectedContact.ContactMethodTypeDesc" name="contactFrom" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Is contact an
                approved individual?</label>
              <input [(ngModel)]="selectedContact.IsIndividualRegulated" name="isApprovedIndividual"
                [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Contact
                Type:</label>
              <input [(ngModel)]="selectedContact.ContactTypeDesc" name="contactType" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <!-- Contact Details Row 2 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">First Name:</label>
              <input [(ngModel)]="selectedContact.FirstName" name="firstName" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Second Name:</label>
              <input [(ngModel)]="selectedContact.SecondName" name="secondName" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Family Name:</label>
              <input [(ngModel)]="selectedContact.FamilyName" name="familyName" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <!-- Contact Details Row 3 -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Mobile
                Phone:</label>
              <input [(ngModel)]="selectedContact.MobileNum" name="mobilePhone" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Business
                Email:</label>
              <input [(ngModel)]="selectedContact.BusEmail" name="businessEmail" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Business
                Phone:</label>
              <input [(ngModel)]="selectedContact.BusPhone" name="businessPhone" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <!-- Addresses Section -->
          <h3
            style="margin-top: 20px; color: #a51e36; font-size: 1.3em; text-align: left; border-bottom: 2px solid #a51e36; padding-bottom: 5px;">
            Addresses
          </h3>

          <!-- Address Details -->
          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Address
                Type:</label>
              <input [(ngModel)]="selectedContact.addressType" name="addressType" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Address - Line
                1:</label>
              <input [(ngModel)]="selectedContact.addressLine1" name="addressLine1" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Address - Line
                2:</label>
              <input [(ngModel)]="selectedContact.addressLine2" name="addressLine2" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Address - Line
                3:</label>
              <input [(ngModel)]="selectedContact.addressLine3" name="addressLine3" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <div style="display: flex; gap: 20px; margin-bottom: 5px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">City:</label>
              <input [(ngModel)]="selectedContact.city" name="city" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label
                style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">State/Province:</label>
              <input [(ngModel)]="selectedContact.stateProvince" name="stateProvince" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Country:</label>
              <input [(ngModel)]="selectedContact.country" name="country" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

          <div style="display: flex; gap: 20px; margin-bottom: 10px;">
            <div style="flex: 1;">
              <label style="display: block; margin-bottom: 3px; font-weight: bold; color: #a51e36;">Zip/Postal
                Code:</label>
              <input [(ngModel)]="selectedContact.zipPostalCode" name="zipPostalCode" [readonly]="!isEditable"
                style="width: 85%; padding: 8px; border-radius: 5px; border: 1px solid #a51e36; background-color: #fffafa;" />
            </div>
          </div>

        </form>

        <!-- Save and Cancel Buttons -->
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" (click)="confirmDelete()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Delete
          </button>
          <button type="button" (click)="enableEditing()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Edit
          </button>
          <button type="button" (click)="saveContactPopupChanges()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Save
          </button>
          <button type="button" (click)="closeContactPopup()"
            style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background-color: #a51e36; color: white; font-size: 0.9em;">
            Cancel
          </button>
        </div>

      </div>
    </div>





  </section>



  <!--End Firm details sub section-->

  <!--Start Individuals sub sections-->

  <!--Individuals Details-->
  <section #individualSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Individual ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Applied For</h2>
        <table>
          <thead>
            <tr>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Applied Date</th>
              <th>Function Status</th>
              <th>RSG Assessment Completion Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Approved Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Applied Date</th>
              <th>Conditionally Approved Date</th>
              <th>Conditional Approved Expiry Date</th>
              <th>Approved Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Applied Date</td>
              <td>Conditionally Approved Date</td>
              <td>Conditional Approved Expiry Date</td>
              <td>Approved Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="inputs-field-set">
      <div class="section">
        <h2>Withdraw Functions For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <th>Individual Name</th>
              <th>Controlled Functions</th>
              <th>Form Type</th>
              <th>Previous Status</th>
              <th>Current Status</th>
              <th>Current Status Effective Date</th>
              <th>Request Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Individual Name</td>
              <td>Controlled Functions</td>
              <td>Form Type</td>
              <td>Previous Status</td>
              <td>Current Status</td>
              <td>Current Status Effective Date</td>
              <td>Request Status</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Individuals sub sections-->

  <!--Start Supervision sub sections-->

  <!--Section Supervision-->
  <!--add here the section-->
  <section #supervisionSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Supervision ? 'flex' : 'none' }">

  </section>
  <!--Supervision Reporting Schedule-->
  <section #reportingScheduleSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.ReportingSchedule ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Reporting Schedule For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Reporting Schedule From</th>
              <th>Reporting Schedule To</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dates of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ dates?.RptPeriodFromDate }}</td>
              <td>{{ dates?.RptPeriodToDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Review-->
  <section #returnReviewSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.ReturnsReview ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="return-review-header">
          <h2>Return Review For</h2>
          <span>
            <label>Report Type : </label>
            <select name="reportType" id="reportType" class="SPReview-dropdown">
              <option>All</option>
            </select>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Ver</th>
              <th>Report</th>
              <th>Report Period Start Date</th>
              <th>Report Period End Date</th>
              <th>Received Date</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Ver</td>
              <td>Report</td>
              <td>Report Period Start Date</td>
              <td>Report Period End Date</td>
              <td>Received Date</td>
              <td>Review Status Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Notices-->
  <section #noticesSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Notices ? 'flex' : 'none' }">
    <div class="inputs-field-set" style="overflow-x: scroll">
      <div class="section">
        <h2>Notices And Responses -</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Notice Type</th>
              <th>Notice Name</th>
              <th>Internal Reference Number</th>
              <th>Notice Issuer</th>
              <th>Notice Issued Date</th>
              <th>Issuer's Reference Number</th>
              <th>Subject</th>
              <th>Notice Finalized Date</th>
              <th>Date Published on Website</th>
              <th>Notice Sent Date</th>
              <th>Response Due Date</th>
              <th>Response Provided Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let notice of FIRMNotices">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ notice?.TypeOfNotice }}</td>
              <td>{{ notice?.NoticeName }}</td>
              <td>{{ notice?.InternalReferenceNumber }}</td>
              <td>{{ notice?.NoticeIssuedBy }}</td>
              <td>{{ notice?.NoticeIssuedDate }}</td>
              <td>{{ notice?.IssuersReferenceNumber }}</td>
              <td>{{ notice?.Subject }}</td>
              <td>{{ notice?.NoticeFinalizedDate }}</td>
              <td>{{ notice?.DatePublishedonWebsite }}</td>
              <td>{{ notice?.NotificationSentDate }}</td>
              <td>{{ notice?.ResponseDueDate }}</td>
              <td>{{ notice?.ResponseProvidedDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Admin Fee-->
  <section #adminFeeSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.LateAdminFee ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Admin Fees For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Report Name</th>
              <th>Report Due Date</th>
              <th>Materially Complete Report Receive Date</th>
              <th>Fee Calculated</th>
              <th>Fee Imposed</th>
              <th>Review Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fee of FirmAdminFees">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>{{ fee.RptName }}</td>
              <td>{{ fee.FirmRptDueDate }}</td>
              <td>{{ fee.FirstMateriallyCompleteRptReceivedDate }}</td>
              <td>{{ fee.CalculatedAmount }}</td>
              <td>{{ fee.ImposedAmount }}</td>
              <td>{{ fee.ObjectWFStatusTypeDesc }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision RMPs-->
  <section #rmpsSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.RMP ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>RMPs For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>RMP ID</th>
              <th>Date Created</th>
              <th>Type</th>
              <th>Date Firm Agreed</th>
              <th>Agreed By</th>
              <th>RMP Status</th>
              <th>Review Status</th>
              <th>Review Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rmp of FIRMRMP">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="rmp" />
                  <span></span>
                </label>
              </td>
              <td>{{ rmp?.FirmRMPID }}</td>
              <td>{{ rmp?.RMPCreatedDate }}</td>
              <td>{{ rmp?.FirmRMPTypeDesc }}</td>
              <td>{{ rmp?.DateFirmAgreedOn }}</td>
              <td>{{ rmp?.AgreedBy }}</td>
              <td>{{ rmp?.RMPStatus }}</td>
              <td>{{ rmp?.SignOffStatus }}</td>
              <td>{{ rmp?.SignOffDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Breaches-->
  <section #breachesSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Breach ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Breaches For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Breach Number</th>
              <th>Version</th>
              <th>Breach Type</th>
              <th>Breach Category</th>
              <th>Breach Level</th>
              <th>Date Of Breach</th>
              <th>Breach Status</th>
              <th>Last Updated By</th>
              <th>Last Updated Date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="breach" />
                  <span></span>
                </label>
              </td>
              <td>Breach Number</td>
              <td>Version</td>
              <td>Breach Type</td>
              <td>Breach Category</td>
              <td>Breach Level</td>
              <td>Date Of Breach</td>
              <td>Breach Status</td>
              <td>Last Updated By</td>
              <td>Last Updated Date</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Waivers-->
  <section #waiversSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Waiver ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>Waiver And/Or Modification For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Waiver Number</th>
              <th>Version</th>
              <th>Waiver Type</th>
              <th>Subject</th>
              <th>Waiver Status</th>
              <th>Status Date</th>
              <th>Review Date</th>
              <th>Review Decision</th>
              <th>Expiration Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let waiver of FirmWaivers">
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" name="waiver" />
                  <span></span>
                </label>
              </td>
              <td>{{ waiver?.WaiverNumber }}</td>
              <td>{{ waiver?.WaiverRevNum }}</td>
              <td>{{ waiver?.WaiverTypeDesc }}</td>
              <td>{{ waiver?.WaiverSubject }}</td>
              <td>{{ waiver?.WaiverStatusTypeDesc }}</td>
              <td>{{ waiver?.WaiverStatusDate }}</td>
              <td>{{ waiver?.ReviewMeetingDate }}</td>
              <td>{{ waiver?.WaiverDecisionTypeDesc }}</td>
              <td>{{ waiver?.WaiverExpirationDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision ENF Actions-->
  <section #enfActionSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.Enforcement ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="ENFAction-header">
          <h2>List Of Enforcement & Disciplinary Actions</h2>
          <span>
            <input id="deletedRecords" type="checkbox" />
            <label>Display Deleted Records</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Action</th>
              <th>Type Of Action</th>
              <th>Date Of Action</th>
              <th>Firm Name</th>
              <th>Approved Individual</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="radio-table">
                <label class="radioBtn">
                  <input type="radio" />
                  <span></span>
                </label>
              </td>
              <td>Action</td>
              <td>Type Of Action</td>
              <td>Date Of Action</td>
              <td>Firm Name</td>
              <td>Approved Individual</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Reg. Funds-->
  <section #regFundsSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.RegisteredFunds ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <h2>List Of Registered Funds For</h2>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Fund Number</th>
              <th>Fund Name</th>
              <th>Type Of Fund</th>
              <th>Status</th>
              <th>Status Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let fund of RegisteredFund">
              <td></td>
              <td>{{ fund.RegisteredFundNumber }}</td>
              <td>{{ fund.FundName }}</td>
              <td>{{ fund.RegisteredFundTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusTypeDesc }}</td>
              <td>{{ fund.RegisteredFundStatusDate }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--Supervision Journal-->
  <section #journalSection class="edit-firm-section"
    [ngStyle]="{ width: dataWidth, display: activeTab === FrimsObject.SupervisionJournal ? 'flex' : 'none' }">
    <div class="inputs-field-set">
      <div class="section">
        <div class="Journal-header">
          <h2>Journal Entries For</h2>
          <span>
            <input id="deletedEntries" type="checkbox" />
            <label>Display Deleted Entries</label>
          </span>
        </div>
        <table>
          <thead>
            <tr>
              <th></th>
              <!--leave it empty-->
              <th>Entry Type</th>
              <th>Title</th>
              <th>Entry Date</th>
              <th>Last Modified Date</th>
            </tr>
          </thead>
          <tbody>
            <tr></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!--End Supervision sub sections-->
</div>

<!--Popups-->
<!--Financial Year End History-->
<div *ngIf="callFYear" class="overlay show"></div>
<div *ngIf="callFYear" class="popup-wrapper">
  <i class="bi bi-x-circle close-icon" (click)="closeFYearHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Financial Year End History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Year End</th>
          <th>Financial Year Effective From</th>
          <th>Financial Year Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FR of firmFYearHistory">
          <td style="text-align: left">{{ FR?.FirmName }}</td>
          <td style="text-align: left">{{ FR?.FirmFinYearEndTypeDesc }}</td>
          <td>{{ FR?.FirmFinYearEndEffectiveFrom }}</td>
          <td>{{ firmDetails?.FirmFinYearEndEffectiveTo }}</td>
          <td style="text-align: left">{{ FR?.UserName }}</td>
          <td>{{ FR?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeFYearHistory()">
      Close
    </button>
  </div>
</div>
<!--Inactive Users-->
<div *ngIf="callInactiveUsers" class="overlay show"></div>
<div *ngIf="callInactiveUsers" class="InactiveUsersPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeInactiveUsers()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Inactive Users</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Function / Role</th>
          <th>Name</th>
          <th>Date From</th>
          <th>Date To</th>
          <th>Reason For Change</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let FYE of firmInactiveUsers">
          <td style="text-align: left">{{ FYE.FirmUserAssnTypeDesc }}</td>
          <td style="text-align: left">{{ FYE.Name }}</td>
          <td>{{ FYE.FirmUserAssnDateFrom | date : "dd/MMM/yyyy" }}</td>
          <td>{{ FYE.FirmUserAssnDateTo | date : "dd/MMM/yyyy" }}</td>
          <td>{{ FYE.FirmUserAssnReasonTypeDesc }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeInactiveUsers()">
      Close
    </button>
  </div>
</div>

<!--Accounting Standards-->
<div *ngIf="callAccStandard" class="overlay show"></div>
<div *ngIf="callAccStandard" class="accountingStandardsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeAccountingStandard()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Accounting Standards History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Firm</th>
          <th>Financial Standard</th>
          <th>Financial Standard Effective From</th>
          <th>Financial Standard Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AS of firmAccountingStandardHistory">
          <td style="text-align: left">{{ AS?.FirmName }}</td>
          <td style="text-align: left">{{ AS?.FinAccStdTypeDesc }}</td>
          <td>{{ AS?.FirmFinYearEndEffectiveFrom }}</td>
          <td>{{ firmDetails?.FirmFinYearEndEffectiveTo }}</td>
          <td style="text-align: left">{{ AS?.UserName }}</td>
          <td>{{ AS?.Column1 }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeAccountingStandard()">
      Close
    </button>
  </div>
</div>
<!--Previous Firm Name-->
<div *ngIf="callPrevFirmName" class="overlay show"></div>
<div *ngIf="callPrevFirmName" class="prevFirmNamePopUp">
  <i class="bi bi-x-circle close-icon" (click)="closePrevFirmName()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>File Name History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <th>Prev. Firm Name</th>
          <th>Date Effective To</th>
          <th>Modified By</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let PRN of firmNamesHistory">
          <td style="text-align: left">{{ PRN?.PrevFirmName }}</td>
          <td>{{ PRN?.DateEffectiveTo }}</td>
          <td style="text-align: left">{{ PRN?.LastModifiedBy }}</td>
          <td>{{ PRN?.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closePrevFirmName()">
      Close
    </button>
  </div>
</div>
<!--Application Details-->
<div *ngIf="callAppDetails" class="overlay show"></div>
<div *ngIf="callAppDetails" class="ApplicationDetailsPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeApplicationDetails()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Application Details History</h3>
    </div>
    <table>
      <thead>
        <tr>
          <td style="background: #a51e36; color: white; cursor: default" colspan="4">
            Licensed Status
          </td>
        </tr>
        <tr>
          <th>Status</th>
          <th>Status Date</th>
          <th>Last Modified By</th>
          <th>Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let LicenseDetailsHistory of firmAppDetailsLicensed">
          <td style="text-align: left">
            {{ LicenseDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td>{{ LicenseDetailsHistory.FirmApplStatusDate }}</td>
          <td>{{ LicenseDetailsHistory.LastModifiedByUser }}</td>
          <td>{{ LicenseDetailsHistory.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
    <table *ngIf="firmDetails?.AuthorisationStatusTypeID > 0">
      <thead>
        <tr>
          <td style="background: #a51e36; color: white; cursor: default" colspan="5">
            Authorisation Status
          </td>
        </tr>
        <tr>
          <th>Status</th>
          <th>Status Date</th>
          <th>Press Release</th>
          <th>Last Modified By</th>
          <th>Last Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let AuthDetailsHistory of firmAppDetailsAuthorization">
          <td style="text-align: left">
            {{ AuthDetailsHistory.FirmApplStatusTypeDesc }}
          </td>
          <td>{{ AuthDetailsHistory.FirmApplStatusDate }}</td>
          <td>{{ firmDetails?.PressReleaseLink }}</td>
          <td>{{ AuthDetailsHistory.LastModifiedByUser }}</td>
          <td>{{ AuthDetailsHistory.LastModifiedDate }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeApplicationDetails()">
      Close
    </button>
  </div>
</div>
<!--Select Document PopUp-->
<div *ngIf="callUploadDoc" class="overlay show"></div>
<div *ngIf="callUploadDoc" class="selectDocumentPopUp">
  <i class="bi bi-x-circle close-icon" (click)="closeSelectDocument()"></i>
  <div class="popup-info-place upload-container">
    <div class="popup-header">
      <h3>Upload Document</h3>
    </div>
    <div class="upload-document-body">
      <p>Please browse and upload/attach document:</p>
      <input type="file" accept=".pdf" #fileInput (change)="onFileSelected($event)" />
    </div>
    <small style="color: red" *ngIf="fileError">{{ fileError }}</small>
  </div>
  <div class="popup-operations-place">
    <button style="margin-right: 5px" class="subbutton" (click)="confirmUpload()">
      Ok
    </button>
    <button class="subbutton" (click)="closeSelectDocument()">
      Close
    </button>
  </div>
</div>
<!--Address Type History-->
<div *ngIf="callAddressType" class="overlay show"></div>
<div *ngIf="callAddressType" class="addressHistoryPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeAddressTypeHistory()"></i>
  <div class="popup-info-place">
    <div class="popup-header">
      <h3>Address History</h3>
    </div>
    <br />
    <div class="address-type-info">
      <span style="text-decoration: underline">{{
        firmAddressesTypeHistory[0]?.AddressTypeDesc
        }}</span>
      &nbsp; (<span style="color: red">history includes the deleted record for this address type.</span>)
    </div>
    <table>
      <thead>
        <tr>
          <th>Address</th>
          <th>Created Date</th>
          <th>Modified Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let addressHistory of firmAddressesTypeHistory">
          <td>{{ addressHistory?.ShortAddress }}</td>
          <td style="text-align: center">{{ addressHistory?.CreatedDate }}</td>
          <td style="text-align: center">
            {{ addressHistory?.LastModifiedDate }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="popup-operations-place">
    <button class="subbutton" (click)="closeAddressTypeHistory()">
      Close
    </button>
  </div>
</div>

<!--Scope Previous Versions for License popup-->
<div *ngIf="callLicScopePrev" class="overlay show"></div>
<div *ngIf="callLicScopePrev" class="ScopeLicPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeLicScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for License Scope</h3>
  </div>

  <div style="width: 50%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of LicPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId,2,rev.ScopeRevNum)">
          {{rev.ScopeRevNum}}
        </button>
      </li>
    </ul>
  </div>
</div>

<!--Scope Previous Versions for Authorize popup-->
<div *ngIf="callAuthScopePrev" class="overlay show"></div>
<div *ngIf="callAuthScopePrev" class="ScopeAuthPreviousVersionsPopup">
  <i class="bi bi-x-circle close-icon" (click)="closeAuthScopePreviousVersions()"></i>

  <div class="popup-header">
    <h3>Revisions for Authorize Scope</h3>
  </div>

  <div style="width: 50%" class="popup-info-place">
    <ul class="revision-list">
      <li *ngFor="let rev of AuthPrevRevNumbers">
        <button class="change-rev" (click)="fetchPreviousScopeVersions(firmId,3,rev.ScopeRevNum)">
          {{rev.ScopeRevNum}}
        </button>
      </li>
    </ul>
  </div>
</div>